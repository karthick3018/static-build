{"version":3,"sources":["types/index.ts","theme.ts","dictionary.ts","components/Flex.tsx","components/BlockMenuItem.tsx","components/Input.tsx","components/VisuallyHidden.tsx","lib/getDataTransferFiles.ts","lib/uploadPlaceholder.ts","commands/insertFiles.ts","menus/block.ts","components/BlockMenu.tsx","lib/isUrl.ts","components/ToolbarButton.tsx","components/LinkSearchResult.tsx","components/LinkEditor.tsx","components/FloatingToolbar.tsx","commands/createAndInsertLink.ts","components/LinkToolbar.tsx","lib/markdown/serializer.js","lib/markdown/mark.ts","lib/markdown/checkboxes.ts","lib/markdown/embeds.ts","lib/markdown/breaks.ts","lib/markdown/tables.ts","lib/markdown/notices.ts","lib/markdown/underlines.ts","lib/markdown/rules.ts","lib/ExtensionManager.ts","lib/ComponentView.tsx","lib/headingToSlug.ts","lib/Extension.ts","nodes/Node.ts","nodes/Doc.ts","nodes/Text.ts","queries/isNodeActive.ts","commands/toggleWrap.ts","nodes/Blockquote.ts","queries/isList.ts","commands/toggleList.ts","nodes/BulletList.ts","plugins/Prism.ts","queries/isMarkActive.ts","queries/isInCode.ts","nodes/CodeFence.ts","nodes/CodeBlock.ts","nodes/CheckboxList.ts","nodes/CheckboxItem.ts","nodes/Embed.tsx","nodes/HardBreak.ts","commands/backspaceToParagraph.ts","nodes/Heading.ts","commands/toggleBlockType.ts","nodes/HorizontalRule.ts","nodes/Image.tsx","queries/getParentListItem.ts","nodes/ListItem.ts","queries/isInList.ts","nodes/Notice.tsx","nodes/OrderedList.ts","nodes/Paragraph.ts","nodes/Table.ts","nodes/TableCell.ts","nodes/TableHeadCell.ts","nodes/TableRow.ts","lib/markInputRule.ts","marks/Mark.ts","marks/Bold.ts","marks/Code.ts","marks/Highlight.ts","marks/Italic.ts","lib/isModKey.ts","marks/Link.ts","marks/Strikethrough.ts","queries/getMarkRange.ts","marks/Placeholder.ts","marks/Underline.ts","plugins/BlockMenuTrigger.tsx","plugins/History.ts","plugins/Keys.ts","plugins/MaxLength.ts","plugins/Placeholder.ts","plugins/SmartText.ts","plugins/TrailingNode.ts","plugins/MarkdownPaste.ts","server.ts","apps.tsx","components/Tooltip.tsx","main.tsx","index.tsx"],"names":["ToastType","colors","almostBlack","lightBlack","almostWhite","white","white10","black","black10","primary","greyLight","grey","greyMid","greyDark","base","fontFamily","fontFamilyMono","fontWeight","zIndex","link","placeholder","textSecondary","textLight","textHighlight","textHighlightForeground","selected","codeComment","codePunctuation","codeNumber","codeProperty","codeTag","codeString","codeSelector","codeAttr","codeEntity","codeKeyword","codeFunction","codeStatement","codePlaceholder","codeInserted","codeImportant","blockToolbarBackground","blockToolbarTrigger","blockToolbarTriggerIcon","blockToolbarItem","blockToolbarText","blockToolbarHoverBackground","blockToolbarDivider","noticeInfoBackground","noticeInfoText","noticeTipBackground","noticeTipText","noticeWarningBackground","noticeWarningText","light","background","text","code","cursor","divider","toolbarBackground","toolbarHoverBackground","toolbarInput","toolbarItem","tableDivider","tableSelected","tableSelectedBackground","quote","codeBackground","codeBorder","horizontalRule","imageErrorBackground","scrollbarBackground","scrollbarThumb","dark","addColumnAfter","addColumnBefore","addRowAfter","addRowBefore","alignCenter","alignLeft","alignRight","bulletList","checkboxList","codeBlock","codeCopied","codeInline","createLink","createLinkError","createNewDoc","deleteColumn","deleteRow","deleteTable","deleteImage","alignImageLeft","alignImageRight","alignImageDefault","em","embedInvalidLink","findOrCreateDoc","h1","h2","h3","heading","hr","image","imageUploadError","info","infoNotice","linkCopied","mark","newLineEmpty","newLineWithSlash","noResults","openLink","orderedList","pasteLink","pasteLinkWithTitle","title","removeLink","searchOrPasteLink","strikethrough","strong","subheading","table","tip","tipNotice","warning","warningNotice","Flex","styled","div","auto","column","align","justify","MenuItem","button","props","disabled","theme","Shortcut","span","withTheme","onClick","shortcut","Icon","icon","ref","React","node","scrollIntoView","scrollMode","block","boundary","parent","id","undefined","color","Input","input","VisuallyHidden","getDataTransferFiles","event","dataTransferItemsList","dataTransfer","dt","files","length","items","target","Array","prototype","slice","call","uploadPlaceholder","Plugin","state","init","DecorationSet","empty","apply","tr","set","map","mapping","doc","action","getMeta","this","add","element","document","createElement","className","img","src","URL","createObjectURL","file","appendChild","deco","Decoration","widget","pos","remove","find","spec","decorations","getState","insertFiles","view","options","images","filter","test","type","dictionary","uploadImage","onImageUploadStart","onImageUploadStop","onShowToast","preventDefault","schema","complete","setMeta","uploadPlaceholderPlugin","dispatch","then","found","from","findPlaceholder","transaction","replaceWith","nodes","create","catch","error","console","Error","finally","warn","mod","window","navigator","platform","SSR","BlockMenu","menuRef","inputRef","left","top","bottom","isAbove","selectedIndex","insertItem","handleKeyDown","isActive","key","stopPropagation","item","filtered","onClose","ctrlKey","prevIndex","prev","setState","Math","max","name","close","total","nextIndex","next","min","triggerImagePick","triggerLinkInput","clearSearch","onLinkToolbarOpen","insertBlock","focus","handleLinkInputKeydown","href","currentTarget","value","matches","matcher","attrs","component","handleLinkInputPaste","clipboardData","getData","current","click","handleImagePicked","findParentNode","selection","insertText","textContent","addEventListener","nextProps","nextState","search","prevProps","position","calculatePosition","removeEventListener","command","commands","capitalize","getSelection","anchorNode","focusNode","range","createRange","setStart","anchorOffset","setEnd","focusOffset","getClientRects","startContainer","collapsed","selectNodeContents","rect","getBoundingClientRect","startPos","coordsAtPos","$from","offsetHeight","paragraph","domAtPos","caretPosition","scrollX","innerHeight","scrollY","embeds","keywords","Heading1Icon","level","Heading2Icon","Heading3Icon","TodoListIcon","BulletedListIcon","OrderedListIcon","TableIcon","rowsCount","colsCount","BlockQuoteIcon","CodeIcon","HorizontalRuleIcon","ImageIcon","LinkIcon","InfoIcon","style","WarningIcon","StarredIcon","getMenuItems","embedItems","embed","push","concat","defaultHidden","n","toLowerCase","includes","reduce","acc","index","positioning","Wrapper","active","LinkInputWrapper","LinkInput","onKeyDown","onPaste","autoFocus","List","Empty","onChange","accept","ol","ListItem","li","isUrl","match","err","IconWrapper","compact","Title","Subtitle","LinkSearchResult","subtitle","rest","LinkEditor","discardInputValue","initialValue","initialSelectionLength","to","previousValue","results","componentWillUnmount","trim","handleRemoveLink","save","startsWith","onSelectLink","onCreateLink","result","url","handleCreateLink","suggestedLinkTitle","moveSelectionToEnd","shiftKey","handleFocusLink","handleChange","a","trimmedValue","onSearchLink","handleOpenLink","onClickLink","onRemoveLink","removeMark","handleSelectLink","setTextSelection","selectionText","cut","Tooltip","tooltip","looksLikeUrl","showCreateLink","showResults","ToolbarButton","placement","SearchResults","onMouseOver","defaultPosition","offset","visible","usePosition","isSelectingText","width","height","size","setSize","sizeObserver","ResizeObserver","entries","forEach","clientWidth","clientHeight","observe","disconnect","useComponentSize","menuWidth","menuHeight","fromPos","toPos","$to","selectionBounds","right","isColSelection","isRowSelection","nodeDOM","getElementsByTagName","round","halfSelection","abs","centerOfSelection","innerWidth","FloatingToolbar","forwardedRef","setSelectingText","handleMouseDown","handleMouseUp","children","findPlaceholderLink","findLinks","marks","content","descendants","createAndInsertLink","nodeSize","addMark","LinkToolbar","handleClickOutside","ev","contains","handleOnCreateLink","assert","handleOnSelectLink","MarkdownSerializer","MarkdownSerializerState","renderContent","out","delim","closed","inTightList","tightLists","atBlank","delimMin","exec","i","firstDelim","f","old","write","closeBlock","flushClose","escape","lines","split","startOfLine","esc","_","render","trailing","progress","m","childCount","child","isInSet","isText","leading","some","expelEnclosingWhitespace","lead","inner","trail","withText","noEsc","len","outer","mixable","j","other","eq","keep","markString","pop","isTight","tight","prevTight","prevList","inList","wrapBlock","headerBuffer","prevTable","inTable","row","cell","para","alignment","str","replace","wrap","indexOf","open","delimCharCode","charCodeAt","md","postProcess","delimiters","startDelim","endDelim","token","loneMarkers","marker","end","tokens","tag","nesting","markup","inline","ruler","before","silent","start","scanned","scanDelims","ch","String","fromCharCode","can_open","can_close","jump","ruler2","curr","tokensMeta","tokens_meta","CHECKBOX_REGEX","looksLikeChecklist","isParagraph","markdownItCheckbox","idx","checked","attrGet","renderer","rules","checkbox_item_open","checkbox_item_close","core","after","tokenChildren","contentMatches","label","isInline","isLinkOpen","isLinkClose","isHardbreak","markdownBreakToParagraphs","Token","count","isLast","splice","BREAK_REGEX","markdownTables","inside","existing","breakParts","part","brToken","tokenAttrs","notice","customFence","validate","utils","escapeHtml","markdownUnderlines","markdownit","breaks","html","linkify","use","isEmbed","insideLink","attrSet","embedsPlugin","breakPlugin","checkboxPlugin","markPlugin","underlinesPlugin","tablesPlugin","noticesPlugin","ExtensionManager","extensions","editor","extension","bindEditor","toMarkdown","parseMarkdown","markdownToken","MarkdownParser","makeRules","plugins","allPlugins","extensionKeymaps","keys","nodeMarkKeymaps","keymap","extensionInputRules","inputRules","nodeMarkInputRules","allInputRules","allCommands","callback","editable","handle","_name","_value","isArray","Object","commandName","commandValue","ComponentView","getPos","isSelected","dom","renderElement","darkTheme","lightTheme","isEditable","ReactDOM","unmountComponentAtNode","safeSlugify","slugify","lower","headingToSlug","slugified","Extension","defaultOptions","Node","Doc","Text","group","draggable","isNodeActive","findSelectedNodeOfType","hasMarkup","toggleWrap","lift","wrapIn","Blockquote","defining","parseDOM","toDOM","class","wrappingInputRule","isList","bullet_list","ordered_list","todo_list","toggleList","listType","itemType","blockRange","parentList","depth","liftListItem","validContent","setNodeMarkup","wrapInList","BulletList","list_item","renderList","bullet","LANGUAGES","none","bash","css","clike","csharp","go","java","javascript","json","php","powershell","python","ruby","sql","typescript","cache","getDecorations","blocks","findBlockNodes","parseNodes","classNames","classes","properties","language","refractor","registered","highlight","_decorations","flattenDeep","join","decoration","Number","Prism","highlighted","PluginKey","decorationSet","oldState","nodeName","$head","previousNodeName","codeBlockChanged","docChanged","setTimeout","loaded","isMarkActive","storedMarks","rangeHasMark","isInCode","d","code_block","code_inline","register","CodeFence","handleCopyToClipboard","posAtCoords","nodeAt","copy","Info","handleLanguageChange","default","preserveWhitespace","contentElement","getAttrs","dataset","innerText","select","languageOptions","option","contentEditable","spellCheck","setBlockType","Tab","textblockTypeInputRule","ensureNewLine","tok","CodeBlock","CheckboxList","checkbox_item","CheckboxItem","Enter","splitListItem","sinkListItem","Embed","atom","getAttribute","Component","replaceSelectionWith","HardBreak","selectable","isInTable","backspaceToParagraph","resolve","Heading","handleCopyLink","anchor","parentNode","previousSibling","hash","urlWithoutHash","location","levels","repeat","renderInline","toggleType","toggleBlockType","Backspace","getAnchors","previouslySeen","slug","side","plugin","config","RegExp","HorizontalRule","InputRule","IMAGE_INPUT_REGEX","IMAGE_CLASSES","getLayoutAndTitle","tokenTitle","layoutClass","Image","$pos","setSelection","NodeSelection","deleteSelection","handleBlur","alt","handleSelect","ImageWrapper","defaultStyles","overlay","backgroundColor","shouldRespectMaxDimension","Caption","onBlur","tabIndex","role","suppressContentEditableWarning","layoutClassMatched","markdown","createImage","$cursor","insert","okay","matchedTitle","handleDOMEvents","paste","getAsFile","drop","clientX","clientY","p","getParentListItem","newState","findParentNodeClosestToPos","mouseover","closest","posAtDOM","mouseout","isInList","nodeBefore","log","newPos","delete","TextSelection","near","nodeAfter","Notice","handleStyleChange","styleOptions","OrderedList","order","hasAttribute","parseInt","maxW","space","nStr","Paragraph","Table","tableRole","isolating","createTable","resolvedPos","setColumnAttr","cells","getCellsInColumn","addRowAt","moveRow","toggleHeaderColumn","toggleHeaderRow","toggleHeaderCell","setCellAttr","fixTables","goToNextCell","renderTable","tableEditing","getElementsByClassName","parentElement","scrollWidth","shadow","TableCell","colspan","rowspan","isTableSelected","grip","onSelectTable","isRowSelected","onSelectRow","TableHeadCell","getCellsInRow","isColumnSelected","onSelectColumn","TableRow","regexp","markType","Function","markEnd","markStart","matchStart","matchEnd","textStart","lastIndexOf","textEnd","nodesBetween","getMarksBetween","excludes","removeStoredMark","Mark","toggleMark","Bold","markInputRule","backticksFor","ticks","Code","_state","_mark","Highlight","Italic","isMac","isModKey","metaKey","LINK_INPUT_REGEX","isPlainURL","Link","inclusive","rel","onKeyboardShortcut","HTMLAnchorElement","onHoverLink","onClickHashtag","Strikethrough","getMarkRange","childAfter","parentOffset","startIndex","endIndex","endPos","Placeholder","handleTextInput","template","selectionStart","selectionEnd","startOfMark","endOfMark","handleClick","HTMLSpanElement","Underline","OPEN_REGEX","CLOSE_REGEX","run","regex","handler","composing","textBefore","textBetween","BlockMenuTrigger","fill","onOpen","isEmpty","isSlash","History","undo","redo","undoInputRule","history","Keys","blur","onFocus","AllSelection","Selection","atStart","atEnd","onSave","onSaveAndExit","onCancel","MaxLength","filterTransaction","maxLength","emptyNodeClass","completelyEmpty","rightArrow","SmartText","ellipsis","smartQuotes","TrailingNode","notAfter","disabledNodes","update","lastNode","lastChild","MarkdownPaste","handlePaste","parser","parse","replaceSelection","TemplatePlaceholder","Schema","RichMarkdownEditor","serializer","isEditorFocused","selectionMenuOpen","blockMenuOpen","linkMenuOpen","blockMenuSearch","isBlurred","keymaps","nodeViews","serialize","handleSave","done","handleSaveAndExit","handleEditorBlur","handleDragEnd","handleEditorFocus","handleOpenSelectionMenu","handleCloseSelectionMenu","handleOpenLinkMenu","handleCloseLinkMenu","handleOpenBlockMenu","handleCloseBlockMenu","handleSelectRow","selectRow","handleSelectColumn","selectColumn","handleSelectTable","selectTable","focusAtStart","focusAtEnd","getHeadings","headings","memoize","providedDictionary","baseDictionary","readOnly","readOnlyWriteCheckboxes","StyledEditor","scrollTo","scrollToAnchor","resetDrag","e","setAttribute","createState","updateState","createExtensions","createNodes","createMarks","createSchema","createPlugins","createKeymaps","createSerializer","createParser","createInputRules","createNodeViews","createView","createCommands","headingsOffset","createDocument","defaultValue","EditorState","dropCursor","gapCursor","baseKeymap","isEditingCheckbox","steps","step","firstChild","EditorView","dispatchTransaction","applyTransaction","transactions","forceUpdate","querySelector","behavior","defaultProps","tableHeaderBackground","EditorRender","StrictMode","margin","padding","getElementById"],"mappings":"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","file":"static/js/main.05fb87e6.chunk.js","sourcesContent":["import * as React from \"react\";\nimport { EditorState } from \"prosemirror-state\";\n\nexport enum ToastType {\n  Error = \"error\",\n  Info = \"info\",\n}\n\nexport type MenuItem = {\n  icon?: typeof React.Component | React.FC<any>;\n  name?: string;\n  title?: string;\n  shortcut?: string;\n  keywords?: string;\n  tooltip?: string;\n  defaultHidden?: boolean;\n  attrs?: Record<string, any>;\n  visible?: boolean;\n  active?: (state: EditorState) => boolean;\n};\n\nexport type EmbedDescriptor = MenuItem & {\n  matcher: (url: string) => boolean | [] | RegExpMatchArray;\n  component: typeof React.Component | React.FC<any>;\n};\n","const colors = {\n  almostBlack: \"#181A1B\",\n  lightBlack: \"#2F3336\",\n  almostWhite: \"#E6E6E6\",\n  white: \"#FFF\",\n  white10: \"rgba(255, 255, 255, 0.1)\",\n  black: \"#000\",\n  black10: \"rgba(0, 0, 0, 0.1)\",\n  primary: \"#1AB6FF\",\n  greyLight: \"#F4F7FA\",\n  grey: \"#E8EBED\",\n  greyMid: \"#C5CCD3\",\n  greyDark: \"#DAE1E9\",\n};\n\nexport const base = {\n  ...colors,\n  fontFamily:\n    \"-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen, Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif\",\n  fontFamilyMono:\n    \"'SFMono-Regular',Consolas,'Liberation Mono', Menlo, Courier,monospace\",\n  fontWeight: 400,\n  zIndex: 100,\n  link: colors.primary,\n  placeholder: \"#B1BECC\",\n  textSecondary: \"#4E5C6E\",\n  textLight: colors.white,\n  textHighlight: \"#b3e7ff\",\n  textHighlightForeground: colors.black,\n  selected: colors.primary,\n  codeComment: \"#6a737d\",\n  codePunctuation: \"#5e6687\",\n  codeNumber: \"#d73a49\",\n  codeProperty: \"#c08b30\",\n  codeTag: \"#3d8fd1\",\n  codeString: \"#032f62\",\n  codeSelector: \"#6679cc\",\n  codeAttr: \"#c76b29\",\n  codeEntity: \"#22a2c9\",\n  codeKeyword: \"#d73a49\",\n  codeFunction: \"#6f42c1\",\n  codeStatement: \"#22a2c9\",\n  codePlaceholder: \"#3d8fd1\",\n  codeInserted: \"#202746\",\n  codeImportant: \"#c94922\",\n\n  blockToolbarBackground: colors.white,\n  blockToolbarTrigger: colors.greyMid,\n  blockToolbarTriggerIcon: colors.white,\n  blockToolbarItem: colors.almostBlack,\n  blockToolbarText: colors.almostBlack,\n  blockToolbarHoverBackground: colors.greyLight,\n  blockToolbarDivider: colors.greyMid,\n\n  noticeInfoBackground: \"#F5BE31\",\n  noticeInfoText: colors.almostBlack,\n  noticeTipBackground: \"#9E5CF7\",\n  noticeTipText: colors.white,\n  noticeWarningBackground: \"#FF5C80\",\n  noticeWarningText: colors.white,\n};\n\nexport const light = {\n  ...base,\n  background: colors.white,\n  text: colors.almostBlack,\n  code: colors.lightBlack,\n  cursor: colors.black,\n  divider: colors.greyMid,\n\n  toolbarBackground: colors.lightBlack,\n  toolbarHoverBackground: colors.black,\n  toolbarInput: colors.white10,\n  toolbarItem: colors.white,\n\n  tableDivider: colors.greyMid,\n  tableSelected: colors.primary,\n  tableSelectedBackground: \"#E5F7FF\",\n\n  quote: colors.greyDark,\n  codeBackground: colors.greyLight,\n  codeBorder: colors.grey,\n  horizontalRule: colors.greyMid,\n  imageErrorBackground: colors.greyLight,\n\n  scrollbarBackground: colors.greyLight,\n  scrollbarThumb: colors.greyMid,\n};\n\nexport const dark = {\n  ...base,\n  background: colors.almostBlack,\n  text: colors.almostWhite,\n  code: colors.almostWhite,\n  cursor: colors.white,\n  divider: \"#4E5C6E\",\n  placeholder: \"#52657A\",\n\n  toolbarBackground: colors.white,\n  toolbarHoverBackground: colors.greyMid,\n  toolbarInput: colors.black10,\n  toolbarItem: colors.lightBlack,\n\n  tableDivider: colors.lightBlack,\n  tableSelected: colors.primary,\n  tableSelectedBackground: \"#002333\",\n\n  quote: colors.greyDark,\n  codeBackground: colors.black,\n  codeBorder: colors.lightBlack,\n  codeString: \"#3d8fd1\",\n  horizontalRule: colors.lightBlack,\n  imageErrorBackground: \"rgba(0, 0, 0, 0.5)\",\n\n  scrollbarBackground: colors.black,\n  scrollbarThumb: colors.lightBlack,\n};\n\nexport default light;\n","export const base = {\n  addColumnAfter: \"Insert column after\",\n  addColumnBefore: \"Insert column before\",\n  addRowAfter: \"Insert row after\",\n  addRowBefore: \"Insert row before\",\n  alignCenter: \"Align center\",\n  alignLeft: \"Align left\",\n  alignRight: \"Align right\",\n  bulletList: \"Bulleted list\",\n  checkboxList: \"Todo list\",\n  codeBlock: \"Code block\",\n  codeCopied: \"Copied to clipboard\",\n  codeInline: \"Code\",\n  createLink: \"Create link\",\n  createLinkError: \"Sorry, an error occurred creating the link\",\n  createNewDoc: \"Create a new doc\",\n  deleteColumn: \"Delete column\",\n  deleteRow: \"Delete row\",\n  deleteTable: \"Delete table\",\n  deleteImage: \"Delete image\",\n  alignImageLeft: \"Float left half width\",\n  alignImageRight: \"Float right half width\",\n  alignImageDefault: \"Center large\",\n  em: \"Italic\",\n  embedInvalidLink: \"Sorry, that link won’t work for this embed type\",\n  findOrCreateDoc: \"Find or create a doc…\",\n  h1: \"Big heading\",\n  h2: \"Medium heading\",\n  h3: \"Small heading\",\n  heading: \"Heading\",\n  hr: \"Divider\",\n  image: \"Image\",\n  imageUploadError: \"Sorry, an error occurred uploading the image\",\n  info: \"Info\",\n  infoNotice: \"Info notice\",\n  link: \"Link\",\n  linkCopied: \"Link copied to clipboard\",\n  mark: \"Highlight\",\n  newLineEmpty: \"Type '/' to insert…\",\n  newLineWithSlash: \"Keep typing to filter…\",\n  noResults: \"No results\",\n  openLink: \"Open link\",\n  orderedList: \"Ordered list\",\n  pasteLink: \"Paste a link…\",\n  pasteLinkWithTitle: (title: string) => `Paste a ${title} link…`,\n  placeholder: \"Placeholder\",\n  quote: \"Quote\",\n  removeLink: \"Remove link\",\n  searchOrPasteLink: \"Search or paste a link…\",\n  strikethrough: \"Strikethrough\",\n  strong: \"Bold\",\n  subheading: \"Subheading\",\n  table: \"Table\",\n  tip: \"Tip\",\n  tipNotice: \"Tip notice\",\n  warning: \"Warning\",\n  warningNotice: \"Warning notice\",\n};\n\nexport default base;\n","import * as React from \"react\";\nimport styled from \"styled-components\";\n\ntype JustifyValues =\n  | \"center\"\n  | \"space-around\"\n  | \"space-between\"\n  | \"flex-start\"\n  | \"flex-end\";\n\ntype AlignValues =\n  | \"stretch\"\n  | \"center\"\n  | \"baseline\"\n  | \"flex-start\"\n  | \"flex-end\";\n\ntype Props = {\n  style?: Record<string, string>;\n  column?: boolean;\n  align?: AlignValues;\n  justify?: JustifyValues;\n  auto?: boolean;\n  className?: string;\n  children?: React.ReactNode;\n};\n\nconst Flex = styled.div<Props>`\n  display: flex;\n  flex: ${({ auto }: Props) => (auto ? \"1 1 auto\" : \"initial\")};\n  flex-direction: ${({ column }: Props) => (column ? \"column\" : \"row\")};\n  align-items: ${({ align }: Props) => align};\n  justify-content: ${({ justify }: Props) => justify};\n`;\n\nexport default Flex;\n","import * as React from \"react\";\nimport scrollIntoView from \"smooth-scroll-into-view-if-needed\";\nimport styled, { withTheme } from \"styled-components\";\nimport theme from \"../theme\";\n\ntype Props = {\n  selected: boolean;\n  disabled?: boolean;\n  onClick: () => void;\n  theme: typeof theme;\n  icon: typeof React.Component | React.FC<any>;\n  title: string;\n  shortcut?: string;\n};\n\nfunction BlockMenuItem({\n  selected,\n  disabled,\n  onClick,\n  title,\n  shortcut,\n  icon,\n}: Props) {\n  const Icon = icon;\n\n  const ref = React.useCallback(\n    node => {\n      if (selected && node) {\n        scrollIntoView(node, {\n          scrollMode: \"if-needed\",\n          block: \"center\",\n          boundary: parent => {\n            // All the parent elements of your target are checked until they\n            // reach the #block-menu-container. Prevents body and other parent\n            // elements from being scrolled\n            return parent.id !== \"block-menu-container\";\n          },\n        });\n      }\n    },\n    [selected]\n  );\n\n  return (\n    <MenuItem\n      selected={selected}\n      onClick={disabled ? undefined : onClick}\n      ref={ref}\n    >\n      <Icon color={selected ? theme.black : undefined} />\n      &nbsp;&nbsp;{title}\n      <Shortcut>{shortcut}</Shortcut>\n    </MenuItem>\n  );\n}\n\nconst MenuItem = styled.button<{\n  selected: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 1;\n  width: 100%;\n  height: 36px;\n  cursor: pointer;\n  border: none;\n  opacity: ${props => (props.disabled ? \".5\" : \"1\")};\n  color: ${props =>\n    props.selected ? props.theme.black : props.theme.blockToolbarText};\n  background: ${props =>\n    props.selected ? props.theme.blockToolbarTrigger : \"none\"};\n  padding: 0 16px;\n  outline: none;\n\n  &:hover,\n  &:active {\n    color: ${props => props.theme.black};\n    background: ${props =>\n      props.selected\n        ? props.theme.blockToolbarTrigger\n        : props.theme.blockToolbarHoverBackground};\n  }\n`;\n\nconst Shortcut = styled.span`\n  color: ${props => props.theme.textSecondary};\n  flex-grow: 1;\n  text-align: right;\n`;\n\nexport default withTheme(BlockMenuItem);\n","import styled from \"styled-components\";\n\nconst Input = styled.input`\n  font-size: 15px;\n  background: ${props => props.theme.toolbarInput};\n  color: ${props => props.theme.toolbarItem};\n  border-radius: 2px;\n  padding: 3px 8px;\n  border: 0;\n  margin: 0;\n  outline: none;\n  flex-grow: 1;\n`;\n\nexport default Input;\n","import styled from \"styled-components\";\n\nconst VisuallyHidden = styled.span`\n  position: absolute !important;\n  height: 1px;\n  width: 1px;\n  overflow: hidden;\n  clip: rect(1px 1px 1px 1px); /* IE6, IE7 */\n  clip: rect(1px, 1px, 1px, 1px);\n`;\n\nexport default VisuallyHidden;\n","export default function getDataTransferFiles(event) {\n  let dataTransferItemsList = [];\n\n  if (event.dataTransfer) {\n    const dt = event.dataTransfer;\n    if (dt.files && dt.files.length) {\n      dataTransferItemsList = dt.files;\n    } else if (dt.items && dt.items.length) {\n      // During the drag even the dataTransfer.files is null\n      // but Chrome implements some drag store, which is accesible via dataTransfer.items\n      dataTransferItemsList = dt.items;\n    }\n  } else if (event.target && event.target.files) {\n    dataTransferItemsList = event.target.files;\n  }\n  // Convert from DataTransferItemsList to the native Array\n  return Array.prototype.slice.call(dataTransferItemsList);\n}\n","import { Plugin } from \"prosemirror-state\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\n\n// based on the example at: https://prosemirror.net/examples/upload/\nconst uploadPlaceholder = new Plugin({\n  state: {\n    init() {\n      return DecorationSet.empty;\n    },\n    apply(tr, set) {\n      // Adjust decoration positions to changes made by the transaction\n      set = set.map(tr.mapping, tr.doc);\n\n      // See if the transaction adds or removes any placeholders\n      const action = tr.getMeta(this);\n\n      if (action && action.add) {\n        const element = document.createElement(\"div\");\n        element.className = \"image placeholder\";\n\n        const img = document.createElement(\"img\");\n        img.src = URL.createObjectURL(action.add.file);\n\n        element.appendChild(img);\n\n        const deco = Decoration.widget(action.add.pos, element, {\n          id: action.add.id,\n        });\n        set = set.add(tr.doc, [deco]);\n      } else if (action && action.remove) {\n        set = set.remove(\n          set.find(null, null, spec => spec.id === action.remove.id)\n        );\n      }\n      return set;\n    },\n  },\n  props: {\n    decorations(state) {\n      return this.getState(state);\n    },\n  },\n});\n\nexport default uploadPlaceholder;\n\nexport function findPlaceholder(state, id) {\n  const decos = uploadPlaceholder.getState(state);\n  const found = decos.find(null, null, spec => spec.id === id);\n  return found.length ? found[0].from : null;\n}\n","import uploadPlaceholderPlugin, {\n  findPlaceholder,\n} from \"../lib/uploadPlaceholder\";\nimport { ToastType } from \"../types\";\n\nconst insertFiles = function(view, event, pos, files, options) {\n  // filter to only include image files\n  const images = files.filter(file => /image/i.test(file.type));\n  if (images.length === 0) return;\n\n  const {\n    dictionary,\n    uploadImage,\n    onImageUploadStart,\n    onImageUploadStop,\n    onShowToast,\n  } = options;\n\n  if (!uploadImage) {\n    console.warn(\n      \"uploadImage callback must be defined to handle image uploads.\"\n    );\n    return;\n  }\n\n  // okay, we have some dropped images and a handler – lets stop this\n  // event going any further up the stack\n  event.preventDefault();\n\n  // let the user know we're starting to process the images\n  if (onImageUploadStart) onImageUploadStart();\n\n  const { schema } = view.state;\n\n  // we'll use this to track of how many images have succeeded or failed\n  let complete = 0;\n\n  // the user might have dropped multiple images at once, we need to loop\n  for (const file of images) {\n    // Use an object to act as the ID for this upload, clever.\n    const id = {};\n\n    const { tr } = view.state;\n\n    // insert a placeholder at this position\n    tr.setMeta(uploadPlaceholderPlugin, {\n      add: { id, file, pos },\n    });\n    view.dispatch(tr);\n\n    // start uploading the image file to the server. Using \"then\" syntax\n    // to allow all placeholders to be entered at once with the uploads\n    // happening in the background in parallel.\n    uploadImage(file)\n      .then(src => {\n        const pos = findPlaceholder(view.state, id);\n\n        // if the content around the placeholder has been deleted\n        // then forget about inserting this image\n        if (pos === null) return;\n\n        // otherwise, insert it at the placeholder's position, and remove\n        // the placeholder itself\n        const transaction = view.state.tr\n          .replaceWith(pos, pos, schema.nodes.image.create({ src }))\n          .setMeta(uploadPlaceholderPlugin, { remove: { id } });\n\n        view.dispatch(transaction);\n      })\n      .catch(error => {\n        console.error(error);\n\n        // cleanup the placeholder if there is a failure\n        const transaction = view.state.tr.setMeta(uploadPlaceholderPlugin, {\n          remove: { id },\n        });\n        view.dispatch(transaction);\n\n        // let the user know\n        if (onShowToast) {\n          onShowToast(dictionary.imageUploadError, ToastType.Error);\n        }\n      })\n      // eslint-disable-next-line no-loop-func\n      .finally(() => {\n        complete++;\n\n        // once everything is done, let the user know\n        if (complete === images.length) {\n          if (onImageUploadStop) onImageUploadStop();\n        }\n      });\n  }\n};\n\nexport default insertFiles;\n","import {\n  BlockQuoteIcon,\n  BulletedListIcon,\n  CodeIcon,\n  Heading1Icon,\n  Heading2Icon,\n  Heading3Icon,\n  HorizontalRuleIcon,\n  OrderedListIcon,\n  TableIcon,\n  TodoListIcon,\n  ImageIcon,\n  StarredIcon,\n  WarningIcon,\n  InfoIcon,\n  LinkIcon,\n} from \"outline-icons\";\nimport { MenuItem } from \"../types\";\nimport baseDictionary from \"../dictionary\";\n\nconst SSR = typeof window === \"undefined\";\nconst isMac = !SSR && window.navigator.platform === \"MacIntel\";\nconst mod = isMac ? \"⌘\" : \"ctrl\";\n\nexport default function blockMenuItems(\n  dictionary: typeof baseDictionary\n): MenuItem[] {\n  return [\n    {\n      name: \"heading\",\n      title: dictionary.h1,\n      keywords: \"h1 heading1 title\",\n      icon: Heading1Icon,\n      shortcut: \"^ ⇧ 1\",\n      attrs: { level: 1 },\n    },\n    {\n      name: \"heading\",\n      title: dictionary.h2,\n      keywords: \"h2 heading2\",\n      icon: Heading2Icon,\n      shortcut: \"^ ⇧ 2\",\n      attrs: { level: 2 },\n    },\n    {\n      name: \"heading\",\n      title: dictionary.h3,\n      keywords: \"h3 heading3\",\n      icon: Heading3Icon,\n      shortcut: \"^ ⇧ 3\",\n      attrs: { level: 3 },\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"checkbox_list\",\n      title: dictionary.checkboxList,\n      icon: TodoListIcon,\n      keywords: \"checklist checkbox task\",\n      shortcut: \"^ ⇧ 7\",\n    },\n    {\n      name: \"bullet_list\",\n      title: dictionary.bulletList,\n      icon: BulletedListIcon,\n      shortcut: \"^ ⇧ 8\",\n    },\n    {\n      name: \"ordered_list\",\n      title: dictionary.orderedList,\n      icon: OrderedListIcon,\n      shortcut: \"^ ⇧ 9\",\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"table\",\n      title: dictionary.table,\n      icon: TableIcon,\n      attrs: { rowsCount: 3, colsCount: 3 },\n    },\n    {\n      name: \"blockquote\",\n      title: dictionary.quote,\n      icon: BlockQuoteIcon,\n      shortcut: `${mod} ]`,\n    },\n    {\n      name: \"code_block\",\n      title: dictionary.codeBlock,\n      icon: CodeIcon,\n      shortcut: \"^ ⇧ \\\\\",\n      keywords: \"script\",\n    },\n    {\n      name: \"hr\",\n      title: dictionary.hr,\n      icon: HorizontalRuleIcon,\n      shortcut: `${mod} _`,\n      keywords: \"horizontal rule break line\",\n    },\n    {\n      name: \"image\",\n      title: dictionary.image,\n      icon: ImageIcon,\n      keywords: \"picture photo\",\n    },\n    {\n      name: \"link\",\n      title: dictionary.link,\n      icon: LinkIcon,\n      shortcut: `${mod} k`,\n      keywords: \"link url uri href\",\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"container_notice\",\n      title: dictionary.infoNotice,\n      icon: InfoIcon,\n      keywords: \"container_notice card information\",\n      attrs: { style: \"info\" },\n    },\n    {\n      name: \"container_notice\",\n      title: dictionary.warningNotice,\n      icon: WarningIcon,\n      keywords: \"container_notice card error\",\n      attrs: { style: \"warning\" },\n    },\n    {\n      name: \"container_notice\",\n      title: dictionary.tipNotice,\n      icon: StarredIcon,\n      keywords: \"container_notice card suggestion\",\n      attrs: { style: \"tip\" },\n    },\n  ];\n}\n","import * as React from \"react\";\nimport capitalize from \"lodash/capitalize\";\nimport { Portal } from \"react-portal\";\nimport { EditorView } from \"prosemirror-view\";\nimport { findParentNode } from \"prosemirror-utils\";\nimport styled from \"styled-components\";\nimport { EmbedDescriptor, MenuItem, ToastType } from \"../types\";\nimport BlockMenuItem from \"./BlockMenuItem\";\nimport Input from \"./Input\";\nimport VisuallyHidden from \"./VisuallyHidden\";\nimport getDataTransferFiles from \"../lib/getDataTransferFiles\";\nimport insertFiles from \"../commands/insertFiles\";\nimport getMenuItems from \"../menus/block\";\nimport baseDictionary from \"../dictionary\";\n\nconst SSR = typeof window === \"undefined\";\n\ntype Props = {\n  isActive: boolean;\n  commands: Record<string, any>;\n  dictionary: typeof baseDictionary;\n  view: EditorView;\n  search: string;\n  uploadImage?: (file: File) => Promise<string>;\n  onImageUploadStart?: () => void;\n  onImageUploadStop?: () => void;\n  onShowToast?: (message: string, id: string) => void;\n  onLinkToolbarOpen: () => void;\n  onClose: () => void;\n  embeds: EmbedDescriptor[];\n};\n\ntype State = {\n  insertItem?: EmbedDescriptor;\n  left?: number;\n  top?: number;\n  bottom?: number;\n  isAbove: boolean;\n  selectedIndex: number;\n};\n\nclass BlockMenu extends React.Component<Props, State> {\n  menuRef = React.createRef<HTMLDivElement>();\n  inputRef = React.createRef<HTMLInputElement>();\n\n  state: State = {\n    left: -1000,\n    top: 0,\n    bottom: undefined,\n    isAbove: false,\n    selectedIndex: 0,\n    insertItem: undefined,\n  };\n\n  componentDidMount() {\n    if (!SSR) {\n      window.addEventListener(\"keydown\", this.handleKeyDown);\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return (\n      nextProps.search !== this.props.search ||\n      nextProps.isActive !== this.props.isActive ||\n      nextState !== this.state\n    );\n  }\n\n  componentDidUpdate(prevProps) {\n    if (!prevProps.isActive && this.props.isActive) {\n      const position = this.calculatePosition(this.props);\n\n      this.setState({\n        insertItem: undefined,\n        selectedIndex: 0,\n        ...position,\n      });\n    } else if (prevProps.search !== this.props.search) {\n      this.setState({ selectedIndex: 0 });\n    }\n  }\n\n  componentWillUnmount() {\n    if (!SSR) {\n      window.removeEventListener(\"keydown\", this.handleKeyDown);\n    }\n  }\n\n  handleKeyDown = (event: KeyboardEvent) => {\n    if (!this.props.isActive) return;\n\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const item = this.filtered[this.state.selectedIndex];\n\n      if (item) {\n        this.insertItem(item);\n      } else {\n        this.props.onClose();\n      }\n    }\n\n    if (event.key === \"ArrowUp\" || (event.ctrlKey && event.key === \"p\")) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (this.filtered.length) {\n        const prevIndex = this.state.selectedIndex - 1;\n        const prev = this.filtered[prevIndex];\n\n        this.setState({\n          selectedIndex: Math.max(\n            0,\n            prev && prev.name === \"separator\" ? prevIndex - 1 : prevIndex\n          ),\n        });\n      } else {\n        this.close();\n      }\n    }\n\n    if (\n      event.key === \"ArrowDown\" ||\n      event.key === \"Tab\" ||\n      (event.ctrlKey && event.key === \"n\")\n    ) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (this.filtered.length) {\n        const total = this.filtered.length - 1;\n        const nextIndex = this.state.selectedIndex + 1;\n        const next = this.filtered[nextIndex];\n\n        this.setState({\n          selectedIndex: Math.min(\n            next && next.name === \"separator\" ? nextIndex + 1 : nextIndex,\n            total\n          ),\n        });\n      } else {\n        this.close();\n      }\n    }\n\n    if (event.key === \"Escape\") {\n      this.close();\n    }\n  };\n\n  insertItem = item => {\n    switch (item.name) {\n      case \"image\":\n        return this.triggerImagePick();\n      case \"embed\":\n        return this.triggerLinkInput(item);\n      case \"link\": {\n        this.clearSearch();\n        this.props.onClose();\n        this.props.onLinkToolbarOpen();\n        return;\n      }\n      default:\n        this.insertBlock(item);\n    }\n  };\n\n  close = () => {\n    this.props.onClose();\n    this.props.view.focus();\n  };\n\n  handleLinkInputKeydown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (!this.props.isActive) return;\n    if (!this.state.insertItem) return;\n\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const href = event.currentTarget.value;\n      const matches = this.state.insertItem.matcher(href);\n\n      if (!matches && this.props.onShowToast) {\n        this.props.onShowToast(\n          this.props.dictionary.embedInvalidLink,\n          ToastType.Error\n        );\n        return;\n      }\n\n      this.insertBlock({\n        name: \"embed\",\n        attrs: {\n          href,\n          component: this.state.insertItem.component,\n          matches,\n        },\n      });\n    }\n\n    if (event.key === \"Escape\") {\n      this.props.onClose();\n      this.props.view.focus();\n    }\n  };\n\n  handleLinkInputPaste = (event: React.ClipboardEvent<HTMLInputElement>) => {\n    if (!this.props.isActive) return;\n    if (!this.state.insertItem) return;\n\n    const href = event.clipboardData.getData(\"text/plain\");\n    const matches = this.state.insertItem.matcher(href);\n\n    if (matches) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      this.insertBlock({\n        name: \"embed\",\n        attrs: {\n          href,\n          component: this.state.insertItem.component,\n          matches,\n        },\n      });\n    }\n  };\n\n  triggerImagePick = () => {\n    if (this.inputRef.current) {\n      this.inputRef.current.click();\n    }\n  };\n\n  triggerLinkInput = item => {\n    this.setState({ insertItem: item });\n  };\n\n  handleImagePicked = event => {\n    const files = getDataTransferFiles(event);\n\n    const {\n      view,\n      uploadImage,\n      onImageUploadStart,\n      onImageUploadStop,\n      onShowToast,\n    } = this.props;\n    const { state, dispatch } = view;\n    const parent = findParentNode(node => !!node)(state.selection);\n\n    if (parent) {\n      dispatch(\n        state.tr.insertText(\n          \"\",\n          parent.pos,\n          parent.pos + parent.node.textContent.length + 1\n        )\n      );\n\n      insertFiles(view, event, parent.pos, files, {\n        uploadImage,\n        onImageUploadStart,\n        onImageUploadStop,\n        onShowToast,\n        dictionary: this.props.dictionary,\n      });\n    }\n\n    if (this.inputRef.current) {\n      this.inputRef.current.value = \"\";\n    }\n\n    this.props.onClose();\n  };\n\n  clearSearch() {\n    const { state, dispatch } = this.props.view;\n    const parent = findParentNode(node => !!node)(state.selection);\n\n    if (parent) {\n      dispatch(\n        state.tr.insertText(\n          \"\",\n          parent.pos,\n          parent.pos + parent.node.textContent.length + 1\n        )\n      );\n    }\n  }\n\n  insertBlock(item) {\n    this.clearSearch();\n\n    const command = this.props.commands[item.name];\n    if (command) {\n      command(item.attrs);\n    } else {\n      this.props.commands[`create${capitalize(item.name)}`](item.attrs);\n    }\n\n    this.props.onClose();\n  }\n\n  get caretPosition(): { top: number; left: number } {\n    const selection = window.document.getSelection();\n    if (!selection || !selection.anchorNode || !selection.focusNode) {\n      return {\n        top: 0,\n        left: 0,\n      };\n    }\n\n    const range = window.document.createRange();\n    range.setStart(selection.anchorNode, selection.anchorOffset);\n    range.setEnd(selection.focusNode, selection.focusOffset);\n\n    // This is a workaround for an edgecase where getBoundingClientRect will\n    // return zero values if the selection is collapsed at the start of a newline\n    // see reference here: https://stackoverflow.com/a/59780954\n    const rects = range.getClientRects();\n    if (rects.length === 0) {\n      // probably buggy newline behavior, explicitly select the node contents\n      if (range.startContainer && range.collapsed) {\n        range.selectNodeContents(range.startContainer);\n      }\n    }\n\n    const rect = range.getBoundingClientRect();\n    return {\n      top: rect.top,\n      left: rect.left,\n    };\n  }\n\n  calculatePosition(props) {\n    const { view } = props;\n    const { selection } = view.state;\n    const startPos = view.coordsAtPos(selection.$from.pos);\n    const ref = this.menuRef.current;\n    const offsetHeight = ref ? ref.offsetHeight : 0;\n    const paragraph = view.domAtPos(selection.$from.pos);\n\n    if (\n      !props.isActive ||\n      !paragraph.node ||\n      !paragraph.node.getBoundingClientRect ||\n      SSR\n    ) {\n      return {\n        left: -1000,\n        top: 0,\n        bottom: undefined,\n        isAbove: false,\n      };\n    }\n\n    const { left } = this.caretPosition;\n    const { top, bottom } = paragraph.node.getBoundingClientRect();\n    const margin = 24;\n\n    if (startPos.top - offsetHeight > margin) {\n      return {\n        left: left + window.scrollX,\n        top: undefined,\n        bottom: window.innerHeight - top - window.scrollY,\n        isAbove: false,\n      };\n    } else {\n      return {\n        left: left + window.scrollX,\n        top: bottom + window.scrollY,\n        bottom: undefined,\n        isAbove: true,\n      };\n    }\n  }\n\n  get filtered() {\n    const { dictionary, embeds, search = \"\", uploadImage } = this.props;\n    let items: (EmbedDescriptor | MenuItem)[] = getMenuItems(dictionary);\n    const embedItems: EmbedDescriptor[] = [];\n\n    for (const embed of embeds) {\n      if (embed.title && embed.icon) {\n        embedItems.push({\n          ...embed,\n          name: \"embed\",\n        });\n      }\n    }\n\n    if (embedItems.length) {\n      items.push({\n        name: \"separator\",\n      });\n      items = items.concat(embedItems);\n    }\n\n    const filtered = items.filter(item => {\n      if (item.name === \"separator\") return true;\n\n      // If no image upload callback has been passed, filter the image block out\n      if (!uploadImage && item.name === \"image\") return false;\n\n      // some items (defaultHidden) are not visible until a search query exists\n      if (!search) return !item.defaultHidden;\n\n      const n = search.toLowerCase();\n      return (\n        (item.title || \"\").toLowerCase().includes(n) ||\n        (item.keywords || \"\").toLowerCase().includes(n)\n      );\n    });\n\n    // this block literally just trims unneccessary separators from the results\n    return filtered.reduce((acc, item, index) => {\n      // trim separators from start / end\n      if (item.name === \"separator\" && index === 0) return acc;\n      if (item.name === \"separator\" && index === filtered.length - 1)\n        return acc;\n\n      // trim double separators looking ahead / behind\n      const prev = filtered[index - 1];\n      if (prev && prev.name === \"separator\" && item.name === \"separator\")\n        return acc;\n\n      const next = filtered[index + 1];\n      if (next && next.name === \"separator\" && item.name === \"separator\")\n        return acc;\n\n      // otherwise, continue\n      return [...acc, item];\n    }, []);\n  }\n\n  render() {\n    const { dictionary, isActive, uploadImage } = this.props;\n    const items = this.filtered;\n    const { insertItem, ...positioning } = this.state;\n\n    return (\n      <Portal>\n        <Wrapper\n          id=\"block-menu-container\"\n          active={isActive}\n          ref={this.menuRef}\n          {...positioning}\n        >\n          {insertItem ? (\n            <LinkInputWrapper>\n              <LinkInput\n                type=\"text\"\n                placeholder={\n                  insertItem.title\n                    ? dictionary.pasteLinkWithTitle(insertItem.title)\n                    : dictionary.pasteLink\n                }\n                onKeyDown={this.handleLinkInputKeydown}\n                onPaste={this.handleLinkInputPaste}\n                autoFocus\n              />\n            </LinkInputWrapper>\n          ) : (\n            <List>\n              {items.map((item, index) => {\n                if (item.name === \"separator\") {\n                  return (\n                    <ListItem key={index}>\n                      <hr />\n                    </ListItem>\n                  );\n                }\n                const selected = index === this.state.selectedIndex && isActive;\n\n                if (!item.title || !item.icon) {\n                  return null;\n                }\n\n                return (\n                  <ListItem key={index}>\n                    <BlockMenuItem\n                      onClick={() => this.insertItem(item)}\n                      selected={selected}\n                      icon={item.icon}\n                      title={item.title}\n                      shortcut={item.shortcut}\n                    ></BlockMenuItem>\n                  </ListItem>\n                );\n              })}\n              {items.length === 0 && (\n                <ListItem>\n                  <Empty>{dictionary.noResults}</Empty>\n                </ListItem>\n              )}\n            </List>\n          )}\n          {uploadImage && (\n            <VisuallyHidden>\n              <input\n                type=\"file\"\n                ref={this.inputRef}\n                onChange={this.handleImagePicked}\n                accept=\"image/*\"\n              />\n            </VisuallyHidden>\n          )}\n        </Wrapper>\n      </Portal>\n    );\n  }\n}\n\nconst LinkInputWrapper = styled.div`\n  margin: 8px;\n`;\n\nconst LinkInput = styled(Input)`\n  height: 36px;\n  width: 100%;\n  color: ${props => props.theme.blockToolbarText};\n`;\n\nconst List = styled.ol`\n  list-style: none;\n  text-align: left;\n  height: 100%;\n  padding: 8px 0;\n  margin: 0;\n`;\n\nconst ListItem = styled.li`\n  padding: 0;\n  margin: 0;\n`;\n\nconst Empty = styled.div`\n  display: flex;\n  align-items: center;\n  color: ${props => props.theme.textSecondary};\n  font-weight: 500;\n  font-size: 14px;\n  height: 36px;\n  padding: 0 16px;\n`;\n\nexport const Wrapper = styled.div<{\n  active: boolean;\n  top?: number;\n  bottom?: number;\n  left?: number;\n  isAbove: boolean;\n}>`\n  color: ${props => props.theme.text};\n  font-family: ${props => props.theme.fontFamily};\n  position: absolute;\n  z-index: ${props => {\n    return props.theme.zIndex + 100;\n  }};\n  ${props => props.top !== undefined && `top: ${props.top}px`};\n  ${props => props.bottom !== undefined && `bottom: ${props.bottom}px`};\n  left: ${props => props.left}px;\n  background-color: ${props => props.theme.blockToolbarBackground};\n  border-radius: 4px;\n  box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px,\n    rgba(0, 0, 0, 0.08) 0px 4px 8px, rgba(0, 0, 0, 0.08) 0px 2px 4px;\n  opacity: 0;\n  transform: scale(0.95);\n  transition: opacity 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275),\n    transform 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275);\n  transition-delay: 150ms;\n  line-height: 0;\n  box-sizing: border-box;\n  pointer-events: none;\n  white-space: nowrap;\n  width: 300px;\n  max-height: 224px;\n  overflow: hidden;\n  overflow-y: auto;\n\n  * {\n    box-sizing: border-box;\n  }\n\n  hr {\n    border: 0;\n    height: 0;\n    border-top: 1px solid ${props => props.theme.blockToolbarDivider};\n  }\n\n  ${({ active, isAbove }) =>\n    active &&\n    `\n    transform: translateY(${isAbove ? \"6px\" : \"-6px\"}) scale(1);\n    pointer-events: all;\n    opacity: 1;\n  `};\n\n  @media print {\n    display: none;\n  }\n`;\n\nexport default BlockMenu;\n","export default function isUrl(text: string) {\n  if (text.match(/\\n/)) {\n    return false;\n  }\n\n  try {\n    new URL(text);\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n","import styled from \"styled-components\";\n\ntype Props = { active?: boolean; disabled?: boolean };\n\nexport default styled.button<Props>`\n  display: inline-block;\n  flex: 0;\n  width: 24px;\n  height: 24px;\n  cursor: pointer;\n  margin-left: 10px;\n  border: none;\n  background: none;\n  transition: opacity 100ms ease-in-out;\n  padding: 0;\n  opacity: 0.7;\n  outline: none;\n\n  &:first-child {\n    margin-left: 0;\n  }\n\n  &:hover {\n    opacity: 1;\n  }\n\n  &:disabled {\n    opacity: 0.3;\n    cursor: default;\n  }\n\n  ${props => props.active && \"opacity: 1;\"};\n`;\n","import * as React from \"react\";\nimport scrollIntoView from \"smooth-scroll-into-view-if-needed\";\nimport styled from \"styled-components\";\n\ntype Props = {\n  onClick: (event: React.MouseEvent) => void;\n  onMouseOver: (event: React.MouseEvent) => void;\n  icon: React.ReactNode;\n  selected: boolean;\n  title: string;\n  subtitle?: string;\n};\n\nfunction LinkSearchResult({ title, subtitle, selected, icon, ...rest }: Props) {\n  const ref = React.useCallback(\n    node => {\n      if (selected && node) {\n        scrollIntoView(node, {\n          scrollMode: \"if-needed\",\n          block: \"center\",\n          boundary: parent => {\n            // All the parent elements of your target are checked until they\n            // reach the #link-search-results. Prevents body and other parent\n            // elements from being scrolled\n            return parent.id !== \"link-search-results\";\n          },\n        });\n      }\n    },\n    [selected]\n  );\n\n  return (\n    <ListItem ref={ref} compact={!subtitle} selected={selected} {...rest}>\n      <IconWrapper>{icon}</IconWrapper>\n      <div>\n        <Title>{title}</Title>\n        {subtitle ? <Subtitle selected={selected}>{subtitle}</Subtitle> : null}\n      </div>\n    </ListItem>\n  );\n}\n\nconst IconWrapper = styled.span`\n  flex-shrink: 0;\n  margin-right: 4px;\n  opacity: 0.8;\n`;\n\nconst ListItem = styled.li<{\n  selected: boolean;\n  compact: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  padding: 8px;\n  border-radius: 2px;\n  color: ${props => props.theme.toolbarItem};\n  background: ${props =>\n    props.selected ? props.theme.toolbarHoverBackground : \"transparent\"};\n  font-family: ${props => props.theme.fontFamily};\n  text-decoration: none;\n  overflow: hidden;\n  white-space: nowrap;\n  cursor: pointer;\n  user-select: none;\n  line-height: ${props => (props.compact ? \"inherit\" : \"1.2\")};\n  height: ${props => (props.compact ? \"28px\" : \"auto\")};\n`;\n\nconst Title = styled.div`\n  font-size: 14px;\n  font-weight: 500;\n`;\n\nconst Subtitle = styled.div<{\n  selected: boolean;\n}>`\n  font-size: 13px;\n  opacity: ${props => (props.selected ? 0.75 : 0.5)};\n`;\n\nexport default LinkSearchResult;\n","import * as React from \"react\";\nimport { setTextSelection } from \"prosemirror-utils\";\nimport { EditorView } from \"prosemirror-view\";\nimport { Mark } from \"prosemirror-model\";\nimport {\n  DocumentIcon,\n  CloseIcon,\n  PlusIcon,\n  TrashIcon,\n  OpenIcon,\n} from \"outline-icons\";\nimport styled, { withTheme } from \"styled-components\";\nimport isUrl from \"../lib/isUrl\";\nimport theme from \"../theme\";\nimport Flex from \"./Flex\";\nimport Input from \"./Input\";\nimport ToolbarButton from \"./ToolbarButton\";\nimport LinkSearchResult from \"./LinkSearchResult\";\nimport baseDictionary from \"../dictionary\";\n\nexport type SearchResult = {\n  title: string;\n  subtitle?: string;\n  url: string;\n};\n\ntype Props = {\n  mark?: Mark;\n  from: number;\n  to: number;\n  tooltip: typeof React.Component | React.FC<any>;\n  dictionary: typeof baseDictionary;\n  onRemoveLink?: () => void;\n  onCreateLink?: (title: string) => Promise<void>;\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  onSelectLink: (options: {\n    href: string;\n    title?: string;\n    from: number;\n    to: number;\n  }) => void;\n  onClickLink: (href: string, event: MouseEvent) => void;\n  onShowToast?: (message: string, code: string) => void;\n  view: EditorView;\n  theme: typeof theme;\n};\n\ntype State = {\n  results: {\n    [keyword: string]: SearchResult[];\n  };\n  value: string;\n  previousValue: string;\n  selectedIndex: number;\n};\n\nclass LinkEditor extends React.Component<Props, State> {\n  discardInputValue = false;\n  initialValue = this.href;\n  initialSelectionLength = this.props.to - this.props.from;\n\n  state: State = {\n    selectedIndex: -1,\n    value: this.href,\n    previousValue: \"\",\n    results: {},\n  };\n\n  get href(): string {\n    return this.props.mark ? this.props.mark.attrs.href : \"\";\n  }\n\n  get suggestedLinkTitle(): string {\n    const { state } = this.props.view;\n    const { value } = this.state;\n    const selectionText = state.doc.cut(\n      state.selection.from,\n      state.selection.to\n    ).textContent;\n\n    return value.trim() || selectionText.trim();\n  }\n\n  componentWillUnmount = () => {\n    // If we discarded the changes then nothing to do\n    if (this.discardInputValue) {\n      return;\n    }\n\n    // If the link is the same as it was when the editor opened, nothing to do\n    if (this.state.value === this.initialValue) {\n      return;\n    }\n\n    // If the link is totally empty or only spaces then remove the mark\n    const href = (this.state.value || \"\").trim();\n    if (!href) {\n      return this.handleRemoveLink();\n    }\n\n    this.save(href, href);\n  };\n\n  save = (href: string, title?: string): void => {\n    href = href.trim();\n\n    if (href.length === 0) return;\n\n    this.discardInputValue = true;\n    const { from, to } = this.props;\n\n    // If the input doesn't start with a protocol or relative slash, make sure\n    // a protocol is added to the beginning\n    if (!isUrl(href) && !href.startsWith(\"/\")) {\n      href = `https://${href}`;\n    }\n\n    this.props.onSelectLink({ href, title, from, to });\n  };\n\n  handleKeyDown = (event: React.KeyboardEvent): void => {\n    switch (event.key) {\n      case \"Enter\": {\n        event.preventDefault();\n        const { selectedIndex, value } = this.state;\n        const results = this.state.results[value] || [];\n        const { onCreateLink } = this.props;\n\n        if (selectedIndex >= 0) {\n          const result = results[selectedIndex];\n          if (result) {\n            this.save(result.url, result.title);\n          } else if (onCreateLink && selectedIndex === results.length) {\n            this.handleCreateLink(this.suggestedLinkTitle);\n          }\n        } else {\n          // saves the raw input as href\n          this.save(value, value);\n        }\n\n        if (this.initialSelectionLength) {\n          this.moveSelectionToEnd();\n        }\n\n        return;\n      }\n\n      case \"Escape\": {\n        event.preventDefault();\n\n        if (this.initialValue) {\n          this.setState({ value: this.initialValue }, this.moveSelectionToEnd);\n        } else {\n          this.handleRemoveLink();\n        }\n        return;\n      }\n\n      case \"ArrowUp\": {\n        if (event.shiftKey) return;\n        event.preventDefault();\n        event.stopPropagation();\n        const prevIndex = this.state.selectedIndex - 1;\n\n        this.setState({\n          selectedIndex: Math.max(-1, prevIndex),\n        });\n        return;\n      }\n\n      case \"ArrowDown\":\n        if (event.shiftKey) return;\n      case \"Tab\": {\n        event.preventDefault();\n        event.stopPropagation();\n        const { selectedIndex, value } = this.state;\n        const results = this.state.results[value] || [];\n        const total = results.length;\n        const nextIndex = selectedIndex + 1;\n\n        this.setState({\n          selectedIndex: Math.min(nextIndex, total),\n        });\n        return;\n      }\n    }\n  };\n\n  handleFocusLink = (selectedIndex: number) => {\n    this.setState({ selectedIndex });\n  };\n\n  handleChange = async (event): Promise<void> => {\n    const value = event.target.value;\n\n    this.setState({\n      value,\n      selectedIndex: -1,\n    });\n\n    const trimmedValue = value.trim();\n\n    if (trimmedValue && this.props.onSearchLink) {\n      try {\n        const results = await this.props.onSearchLink(trimmedValue);\n        this.setState(state => ({\n          results: {\n            ...state.results,\n            [trimmedValue]: results,\n          },\n          previousValue: trimmedValue,\n        }));\n      } catch (error) {\n        console.error(error);\n      }\n    }\n  };\n\n  handleOpenLink = (event): void => {\n    event.preventDefault();\n    this.props.onClickLink(this.href, event);\n  };\n\n  handleCreateLink = (value: string) => {\n    this.discardInputValue = true;\n    const { onCreateLink } = this.props;\n\n    value = value.trim();\n    if (value.length === 0) return;\n\n    if (onCreateLink) return onCreateLink(value);\n  };\n\n  handleRemoveLink = (): void => {\n    this.discardInputValue = true;\n\n    const { from, to, mark, view, onRemoveLink } = this.props;\n    const { state, dispatch } = this.props.view;\n\n    if (mark) {\n      dispatch(state.tr.removeMark(from, to, mark));\n    }\n\n    if (onRemoveLink) {\n      onRemoveLink();\n    }\n\n    view.focus();\n  };\n\n  handleSelectLink = (url: string, title: string) => event => {\n    event.preventDefault();\n    this.save(url, title);\n\n    if (this.initialSelectionLength) {\n      this.moveSelectionToEnd();\n    }\n  };\n\n  moveSelectionToEnd = () => {\n    const { to, view } = this.props;\n    const { state, dispatch } = view;\n    dispatch(setTextSelection(to)(state.tr));\n    view.focus();\n  };\n\n  render() {\n    const { dictionary, theme } = this.props;\n    const { value, selectedIndex } = this.state;\n    const results =\n      this.state.results[value.trim()] ||\n      this.state.results[this.state.previousValue] ||\n      [];\n\n    const Tooltip = this.props.tooltip;\n    const looksLikeUrl = value.match(/^https?:\\/\\//i);\n\n    const suggestedLinkTitle = this.suggestedLinkTitle;\n\n    const showCreateLink =\n      !!this.props.onCreateLink &&\n      !(suggestedLinkTitle === this.initialValue) &&\n      suggestedLinkTitle.length > 0 &&\n      !looksLikeUrl;\n\n    const showResults =\n      !!suggestedLinkTitle && (showCreateLink || results.length > 0);\n\n    return (\n      <Wrapper>\n        <Input\n          value={value}\n          placeholder={\n            showCreateLink\n              ? dictionary.findOrCreateDoc\n              : dictionary.searchOrPasteLink\n          }\n          onKeyDown={this.handleKeyDown}\n          onChange={this.handleChange}\n          autoFocus={this.href === \"\"}\n        />\n\n        <ToolbarButton onClick={this.handleOpenLink} disabled={!value}>\n          <Tooltip tooltip={dictionary.openLink} placement=\"top\">\n            <OpenIcon color={theme.toolbarItem} />\n          </Tooltip>\n        </ToolbarButton>\n        <ToolbarButton onClick={this.handleRemoveLink}>\n          <Tooltip tooltip={dictionary.removeLink} placement=\"top\">\n            {this.initialValue ? (\n              <TrashIcon color={theme.toolbarItem} />\n            ) : (\n              <CloseIcon color={theme.toolbarItem} />\n            )}\n          </Tooltip>\n        </ToolbarButton>\n\n        {showResults && (\n          <SearchResults id=\"link-search-results\">\n            {results.map((result, index) => (\n              <LinkSearchResult\n                key={result.url}\n                title={result.title}\n                subtitle={result.subtitle}\n                icon={<DocumentIcon color={theme.toolbarItem} />}\n                onMouseOver={() => this.handleFocusLink(index)}\n                onClick={this.handleSelectLink(result.url, result.title)}\n                selected={index === selectedIndex}\n              />\n            ))}\n\n            {showCreateLink && (\n              <LinkSearchResult\n                key=\"create\"\n                title={suggestedLinkTitle}\n                subtitle={dictionary.createNewDoc}\n                icon={<PlusIcon color={theme.toolbarItem} />}\n                onMouseOver={() => this.handleFocusLink(results.length)}\n                onClick={() => {\n                  this.handleCreateLink(suggestedLinkTitle);\n\n                  if (this.initialSelectionLength) {\n                    this.moveSelectionToEnd();\n                  }\n                }}\n                selected={results.length === selectedIndex}\n              />\n            )}\n          </SearchResults>\n        )}\n      </Wrapper>\n    );\n  }\n}\n\nconst Wrapper = styled(Flex)`\n  margin-left: -8px;\n  margin-right: -8px;\n  min-width: 336px;\n`;\n\nconst SearchResults = styled.ol`\n  background: ${props => props.theme.toolbarBackground};\n  position: absolute;\n  top: 100%;\n  width: 100%;\n  height: auto;\n  left: 0;\n  padding: 4px 8px 8px;\n  margin: 0;\n  margin-top: -3px;\n  margin-bottom: 0;\n  border-radius: 0 0 4px 4px;\n  overflow-y: auto;\n  max-height: 25vh;\n`;\n\nexport default withTheme(LinkEditor);\n","import ResizeObserver from \"resize-observer-polyfill\";\nimport * as React from \"react\";\nimport { Portal } from \"react-portal\";\nimport { EditorView } from \"prosemirror-view\";\nimport styled from \"styled-components\";\n\nconst SSR = typeof window === \"undefined\";\n\ntype Props = {\n  active?: boolean;\n  view: EditorView;\n  children: React.ReactNode;\n  forwardedRef?: React.RefObject<HTMLDivElement> | null;\n};\n\nconst defaultPosition = {\n  left: -1000,\n  top: 0,\n  offset: 0,\n  visible: false,\n};\n\nconst useComponentSize = ref => {\n  const [size, setSize] = React.useState({\n    width: 0,\n    height: 0,\n  });\n\n  React.useEffect(() => {\n    const sizeObserver = new ResizeObserver(entries => {\n      entries.forEach(({ target }) => {\n        if (\n          size.width !== target.clientWidth ||\n          size.height !== target.clientHeight\n        ) {\n          setSize({ width: target.clientWidth, height: target.clientHeight });\n        }\n      });\n    });\n    sizeObserver.observe(ref.current);\n\n    return () => sizeObserver.disconnect();\n  }, [ref]);\n\n  return size;\n};\n\nfunction usePosition({ menuRef, isSelectingText, props }) {\n  const { view, active } = props;\n  const { selection } = view.state;\n  const { width: menuWidth, height: menuHeight } = useComponentSize(menuRef);\n\n  if (!active || !menuWidth || !menuHeight || SSR || isSelectingText) {\n    return defaultPosition;\n  }\n\n  // based on the start and end of the selection calculate the position at\n  // the center top\n  const fromPos = view.coordsAtPos(selection.$from.pos);\n  const toPos = view.coordsAtPos(selection.$to.pos);\n\n  // ensure that start < end for the menu to be positioned correctly\n  const selectionBounds = {\n    top: Math.min(fromPos.top, toPos.top),\n    bottom: Math.max(fromPos.bottom, toPos.bottom),\n    left: Math.min(fromPos.left, toPos.left),\n    right: Math.max(fromPos.right, toPos.right),\n  };\n\n  // tables are an oddity, and need their own positioning logic\n  const isColSelection = selection.isColSelection && selection.isColSelection();\n  const isRowSelection = selection.isRowSelection && selection.isRowSelection();\n\n  if (isColSelection) {\n    const { node: element } = view.domAtPos(selection.$from.pos);\n    const { width } = element.getBoundingClientRect();\n    selectionBounds.top -= 20;\n    selectionBounds.right = selectionBounds.left + width;\n  }\n\n  if (isRowSelection) {\n    selectionBounds.right = selectionBounds.left = selectionBounds.left - 18;\n  }\n\n  const isImageSelection =\n    selection.node && selection.node.type.name === \"image\";\n  // Images need their own positioning to get the toolbar in the center\n  if (isImageSelection) {\n    const element = view.nodeDOM(selection.from);\n\n    // Images are wrapped which impacts positioning - need to traverse through\n    // p > span > div.image\n    const imageElement = element.getElementsByTagName(\"img\")[0];\n    const { left, top, width } = imageElement.getBoundingClientRect();\n\n    return {\n      left: Math.round(left + width / 2 + window.scrollX - menuWidth / 2),\n      top: Math.round(top + window.scrollY - menuHeight),\n      offset: 0,\n      visible: true,\n    };\n  } else {\n    // calcluate the horizontal center of the selection\n    const halfSelection =\n      Math.abs(selectionBounds.right - selectionBounds.left) / 2;\n    const centerOfSelection = selectionBounds.left + halfSelection;\n\n    // position the menu so that it is centered over the selection except in\n    // the cases where it would extend off the edge of the screen. In these\n    // instances leave a margin\n    const margin = 12;\n    const left = Math.min(\n      window.innerWidth - menuWidth - margin,\n      Math.max(margin, centerOfSelection - menuWidth / 2)\n    );\n    const top = Math.min(\n      window.innerHeight - menuHeight - margin,\n      Math.max(margin, selectionBounds.top - menuHeight)\n    );\n\n    // if the menu has been offset to not extend offscreen then we should adjust\n    // the position of the triangle underneath to correctly point to the center\n    // of the selection still\n    const offset = left - (centerOfSelection - menuWidth / 2);\n    return {\n      left: Math.round(left + window.scrollX),\n      top: Math.round(top + window.scrollY),\n      offset: Math.round(offset),\n      visible: true,\n    };\n  }\n}\n\nfunction FloatingToolbar(props) {\n  const menuRef = props.forwardedRef || React.createRef<HTMLDivElement>();\n  const [isSelectingText, setSelectingText] = React.useState(false);\n  const position = usePosition({\n    menuRef,\n    isSelectingText,\n    props,\n  });\n\n  React.useEffect(() => {\n    const handleMouseDown = () => {\n      if (!props.active) {\n        setSelectingText(true);\n      }\n    };\n\n    const handleMouseUp = () => {\n      setSelectingText(false);\n    };\n\n    window.addEventListener(\"mousedown\", handleMouseDown);\n    window.addEventListener(\"mouseup\", handleMouseUp);\n\n    return () => {\n      window.removeEventListener(\"mousedown\", handleMouseDown);\n      window.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, [props.active]);\n\n  // only render children when state is updated to visible\n  // to prevent gaining input focus before calculatePosition runs\n  return (\n    <Portal>\n      <Wrapper\n        active={props.active && position.visible}\n        ref={menuRef}\n        offset={position.offset}\n        style={{\n          top: `${position.top}px`,\n          left: `${position.left}px`,\n        }}\n      >\n        {position.visible && props.children}\n      </Wrapper>\n    </Portal>\n  );\n}\n\nconst Wrapper = styled.div<{\n  active?: boolean;\n  offset: number;\n}>`\n  will-change: opacity, transform;\n  padding: 8px 16px;\n  position: absolute;\n  z-index: ${props => props.theme.zIndex + 100};\n  opacity: 0;\n  background-color: ${props => props.theme.toolbarBackground};\n  border-radius: 4px;\n  transform: scale(0.95);\n  transition: opacity 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275),\n    transform 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275);\n  transition-delay: 150ms;\n  line-height: 0;\n  height: 40px;\n  box-sizing: border-box;\n  pointer-events: none;\n  white-space: nowrap;\n\n  &::before {\n    content: \"\";\n    display: block;\n    width: 24px;\n    height: 24px;\n    transform: translateX(-50%) rotate(45deg);\n    background: ${props => props.theme.toolbarBackground};\n    border-radius: 3px;\n    z-index: -1;\n    position: absolute;\n    bottom: -2px;\n    left: calc(50% - ${props => props.offset || 0}px);\n  }\n\n  * {\n    box-sizing: border-box;\n  }\n\n  ${({ active }) =>\n    active &&\n    `\n    transform: translateY(-6px) scale(1);\n    pointer-events: all;\n    opacity: 1;\n  `};\n\n  @media print {\n    display: none;\n  }\n`;\n\nexport default React.forwardRef(function FloatingToolbarWithForwardedRef(\n  props: Props,\n  ref: React.RefObject<HTMLDivElement>\n) {\n  return <FloatingToolbar {...props} forwardedRef={ref} />;\n});\n","import { EditorView } from \"prosemirror-view\";\nimport baseDictionary from \"../dictionary\";\nimport { ToastType } from \"../types\";\n\nfunction findPlaceholderLink(doc, href) {\n  let result;\n\n  function findLinks(node, pos = 0) {\n    // get text nodes\n    if (node.type.name === \"text\") {\n      // get marks for text nodes\n      node.marks.forEach(mark => {\n        // any of the marks links?\n        if (mark.type.name === \"link\") {\n          // any of the links to other docs?\n          if (mark.attrs.href === href) {\n            result = { node, pos };\n            if (result) return false;\n          }\n        }\n      });\n    }\n\n    if (!node.content.size) {\n      return;\n    }\n\n    node.descendants(findLinks);\n  }\n\n  findLinks(doc);\n  return result;\n}\n\nconst createAndInsertLink = async function(\n  view: EditorView,\n  title: string,\n  href: string,\n  options: {\n    dictionary: typeof baseDictionary;\n    onCreateLink: (title: string) => Promise<string>;\n    onShowToast?: (message: string, code: string) => void;\n  }\n) {\n  const { dispatch, state } = view;\n  const { onCreateLink, onShowToast } = options;\n\n  try {\n    const url = await onCreateLink(title);\n    const result = findPlaceholderLink(view.state.doc, href);\n\n    if (!result) return;\n\n    dispatch(\n      view.state.tr\n        .removeMark(\n          result.pos,\n          result.pos + result.node.nodeSize,\n          state.schema.marks.link\n        )\n        .addMark(\n          result.pos,\n          result.pos + result.node.nodeSize,\n          state.schema.marks.link.create({ href: url })\n        )\n    );\n  } catch (err) {\n    const result = findPlaceholderLink(view.state.doc, href);\n    if (!result) return;\n\n    dispatch(\n      view.state.tr.removeMark(\n        result.pos,\n        result.pos + result.node.nodeSize,\n        state.schema.marks.link\n      )\n    );\n\n    // let the user know\n    if (onShowToast) {\n      onShowToast(options.dictionary.createLinkError, ToastType.Error);\n    }\n  }\n};\n\nexport default createAndInsertLink;\n","import assert from \"assert\";\nimport * as React from \"react\";\nimport { EditorView } from \"prosemirror-view\";\nimport LinkEditor, { SearchResult } from \"./LinkEditor\";\nimport FloatingToolbar from \"./FloatingToolbar\";\nimport createAndInsertLink from \"../commands/createAndInsertLink\";\nimport baseDictionary from \"../dictionary\";\n\ntype Props = {\n  isActive: boolean;\n  view: EditorView;\n  tooltip: typeof React.Component | React.FC<any>;\n  dictionary: typeof baseDictionary;\n  onCreateLink?: (title: string) => Promise<string>;\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  onClickLink: (href: string, event: MouseEvent) => void;\n  onShowToast?: (msg: string, code: string) => void;\n  onClose: () => void;\n};\n\nfunction isActive(props: Props) {\n  const { view } = props;\n  const { selection } = view.state;\n\n  try {\n    const paragraph = view.domAtPos(selection.from);\n    return props.isActive && !!paragraph.node;\n  } catch (err) {\n    return false;\n  }\n}\n\nexport default class LinkToolbar extends React.Component<Props> {\n  menuRef = React.createRef<HTMLDivElement>();\n\n  state = {\n    left: -1000,\n    top: undefined,\n  };\n\n  componentDidMount() {\n    window.addEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  handleClickOutside = ev => {\n    if (\n      ev.target &&\n      this.menuRef.current &&\n      this.menuRef.current.contains(ev.target)\n    ) {\n      return;\n    }\n\n    this.props.onClose();\n  };\n\n  handleOnCreateLink = async (title: string) => {\n    const { dictionary, onCreateLink, view, onClose, onShowToast } = this.props;\n\n    onClose();\n    this.props.view.focus();\n\n    if (!onCreateLink) {\n      return;\n    }\n\n    const { dispatch, state } = view;\n    const { from, to } = state.selection;\n    assert(from === to);\n\n    const href = `creating#${title}…`;\n\n    // Insert a placeholder link\n    dispatch(\n      view.state.tr\n        .insertText(title, from, to)\n        .addMark(\n          from,\n          to + title.length,\n          state.schema.marks.link.create({ href })\n        )\n    );\n\n    createAndInsertLink(view, title, href, {\n      onCreateLink,\n      onShowToast,\n      dictionary,\n    });\n  };\n\n  handleOnSelectLink = ({\n    href,\n    title,\n  }: {\n    href: string;\n    title: string;\n    from: number;\n    to: number;\n  }) => {\n    const { view, onClose } = this.props;\n\n    onClose();\n    this.props.view.focus();\n\n    const { dispatch, state } = view;\n    const { from, to } = state.selection;\n    assert(from === to);\n\n    dispatch(\n      view.state.tr\n        .insertText(title, from, to)\n        .addMark(\n          from,\n          to + title.length,\n          state.schema.marks.link.create({ href })\n        )\n    );\n  };\n\n  render() {\n    const { onCreateLink, onClose, ...rest } = this.props;\n    const { selection } = this.props.view.state;\n    const active = isActive(this.props);\n\n    return (\n      <FloatingToolbar ref={this.menuRef} active={active} {...rest}>\n        {active && (\n          <LinkEditor\n            from={selection.from}\n            to={selection.to}\n            onCreateLink={onCreateLink ? this.handleOnCreateLink : undefined}\n            onSelectLink={this.handleOnSelectLink}\n            onRemoveLink={onClose}\n            {...rest}\n          />\n        )}\n      </FloatingToolbar>\n    );\n  }\n}\n","/* eslint-disable @typescript-eslint/no-use-before-define */\n// https://raw.githubusercontent.com/ProseMirror/prosemirror-markdown/master/src/to_markdown.js\n// forked for table support\n\n// ::- A specification for serializing a ProseMirror document as\n// Markdown/CommonMark text.\nexport class MarkdownSerializer {\n  // :: (Object<(state: MarkdownSerializerState, node: Node, parent: Node, index: number)>, Object)\n  // Construct a serializer with the given configuration. The `nodes`\n  // object should map node names in a given schema to function that\n  // take a serializer state and such a node, and serialize the node.\n  //\n  // The `marks` object should hold objects with `open` and `close`\n  // properties, which hold the strings that should appear before and\n  // after a piece of text marked that way, either directly or as a\n  // function that takes a serializer state and a mark, and returns a\n  // string. `open` and `close` can also be functions, which will be\n  // called as\n  //\n  //     (state: MarkdownSerializerState, mark: Mark,\n  //      parent: Fragment, index: number) → string\n  //\n  // Where `parent` and `index` allow you to inspect the mark's\n  // context to see which nodes it applies to.\n  //\n  // Mark information objects can also have a `mixable` property\n  // which, when `true`, indicates that the order in which the mark's\n  // opening and closing syntax appears relative to other mixable\n  // marks can be varied. (For example, you can say `**a *b***` and\n  // `*a **b***`, but not `` `a *b*` ``.)\n  //\n  // To disable character escaping in a mark, you can give it an\n  // `escape` property of `false`. Such a mark has to have the highest\n  // precedence (must always be the innermost mark).\n  //\n  // The `expelEnclosingWhitespace` mark property causes the\n  // serializer to move enclosing whitespace from inside the marks to\n  // outside the marks. This is necessary for emphasis marks as\n  // CommonMark does not permit enclosing whitespace inside emphasis\n  // marks, see: http://spec.commonmark.org/0.26/#example-330\n  constructor(nodes, marks) {\n    // :: Object<(MarkdownSerializerState, Node)> The node serializer\n    // functions for this serializer.\n    this.nodes = nodes;\n    // :: Object The mark serializer info.\n    this.marks = marks;\n  }\n\n  // :: (Node, ?Object) → string\n  // Serialize the content of the given node to\n  // [CommonMark](http://commonmark.org/).\n  serialize(content, options) {\n    const state = new MarkdownSerializerState(this.nodes, this.marks, options);\n    state.renderContent(content);\n    return state.out;\n  }\n}\n\n// ::- This is an object used to track state and expose\n// methods related to markdown serialization. Instances are passed to\n// node and mark serialization methods (see `toMarkdown`).\nexport class MarkdownSerializerState {\n  constructor(nodes, marks, options) {\n    this.nodes = nodes;\n    this.marks = marks;\n    this.delim = this.out = \"\";\n    this.closed = false;\n    this.inTightList = false;\n    // :: Object\n    // The options passed to the serializer.\n    //   tightLists:: ?bool\n    //   Whether to render lists in a tight style. This can be overridden\n    //   on a node level by specifying a tight attribute on the node.\n    //   Defaults to false.\n    this.options = options || {};\n    if (typeof this.options.tightLists === \"undefined\")\n      this.options.tightLists = true;\n  }\n\n  flushClose(size) {\n    if (this.closed) {\n      if (!this.atBlank()) this.out += \"\\n\";\n      if (size === null || size === undefined) size = 2;\n      if (size > 1) {\n        let delimMin = this.delim;\n        const trim = /\\s+$/.exec(delimMin);\n        if (trim)\n          delimMin = delimMin.slice(0, delimMin.length - trim[0].length);\n        for (let i = 1; i < size; i++) this.out += delimMin + \"\\n\";\n      }\n      this.closed = false;\n    }\n  }\n\n  // :: (string, ?string, Node, ())\n  // Render a block, prefixing each line with `delim`, and the first\n  // line in `firstDelim`. `node` should be the node that is closed at\n  // the end of the block, and `f` is a function that renders the\n  // content of the block.\n  wrapBlock(delim, firstDelim, node, f) {\n    const old = this.delim;\n    this.write(firstDelim || delim);\n    this.delim += delim;\n    f();\n    this.delim = old;\n    this.closeBlock(node);\n  }\n\n  atBlank() {\n    return /(^|\\n)$/.test(this.out);\n  }\n\n  // :: ()\n  // Ensure the current content ends with a newline.\n  ensureNewLine() {\n    if (!this.atBlank()) this.out += \"\\n\";\n  }\n\n  // :: (?string)\n  // Prepare the state for writing output (closing closed paragraphs,\n  // adding delimiters, and so on), and then optionally add content\n  // (unescaped) to the output.\n  write(content) {\n    this.flushClose();\n    if (this.delim && this.atBlank()) this.out += this.delim;\n    if (content) this.out += content;\n  }\n\n  // :: (Node)\n  // Close the block for the given node.\n  closeBlock(node) {\n    this.closed = node;\n  }\n\n  // :: (string, ?bool)\n  // Add the given text to the document. When escape is not `false`,\n  // it will be escaped.\n  text(text, escape) {\n    const lines = text.split(\"\\n\");\n    for (let i = 0; i < lines.length; i++) {\n      const startOfLine = this.atBlank() || this.closed;\n      this.write();\n      this.out += escape !== false ? this.esc(lines[i], startOfLine) : lines[i];\n      if (i !== lines.length - 1) this.out += \"\\n\";\n    }\n  }\n\n  // :: (Node)\n  // Render the given node as a block.\n  render(node, parent, index) {\n    if (typeof parent === \"number\") throw new Error(\"!\");\n    this.nodes[node.type.name](this, node, parent, index);\n  }\n\n  // :: (Node)\n  // Render the contents of `parent` as block nodes.\n  renderContent(parent) {\n    parent.forEach((node, _, i) => this.render(node, parent, i));\n  }\n\n  // :: (Node)\n  // Render the contents of `parent` as inline content.\n  renderInline(parent) {\n    const active = [];\n    let trailing = \"\";\n    const progress = (node, _, index) => {\n      let marks = node ? node.marks : [];\n\n      // Remove marks from `hard_break` that are the last node inside\n      // that mark to prevent parser edge cases with new lines just\n      // before closing marks.\n      // (FIXME it'd be nice if we had a schema-agnostic way to\n      // identify nodes that serialize as hard breaks)\n      if (node && node.type.name === \"hard_break\")\n        marks = marks.filter(m => {\n          if (index + 1 === parent.childCount) return false;\n          const next = parent.child(index + 1);\n          return (\n            m.isInSet(next.marks) && (!next.isText || /\\S/.test(next.text))\n          );\n        });\n\n      let leading = trailing;\n      trailing = \"\";\n      // If whitespace has to be expelled from the node, adjust\n      // leading and trailing accordingly.\n      if (\n        node &&\n        node.isText &&\n        marks.some(mark => {\n          const info = this.marks[mark.type.name];\n          return info && info.expelEnclosingWhitespace;\n        })\n      ) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars, no-unused-vars\n        const [_, lead, inner, trail] = /^(\\s*)(.*?)(\\s*)$/m.exec(node.text);\n        leading += lead;\n        trailing = trail;\n        if (lead || trail) {\n          node = inner ? node.withText(inner) : null;\n          if (!node) marks = active;\n        }\n      }\n\n      const inner = marks.length && marks[marks.length - 1],\n        noEsc = inner && this.marks[inner.type.name].escape === false;\n      const len = marks.length - (noEsc ? 1 : 0);\n\n      // Try to reorder 'mixable' marks, such as em and strong, which\n      // in Markdown may be opened and closed in different order, so\n      // that order of the marks for the token matches the order in\n      // active.\n      outer: for (let i = 0; i < len; i++) {\n        const mark = marks[i];\n        if (!this.marks[mark.type.name].mixable) break;\n        for (let j = 0; j < active.length; j++) {\n          const other = active[j];\n          if (!this.marks[other.type.name].mixable) break;\n          if (mark.eq(other)) {\n            if (i > j)\n              marks = marks\n                .slice(0, j)\n                .concat(mark)\n                .concat(marks.slice(j, i))\n                .concat(marks.slice(i + 1, len));\n            else if (j > i)\n              marks = marks\n                .slice(0, i)\n                .concat(marks.slice(i + 1, j))\n                .concat(mark)\n                .concat(marks.slice(j, len));\n            continue outer;\n          }\n        }\n      }\n\n      // Find the prefix of the mark set that didn't change\n      let keep = 0;\n      while (\n        keep < Math.min(active.length, len) &&\n        marks[keep].eq(active[keep])\n      )\n        ++keep;\n\n      // Close the marks that need to be closed\n      while (keep < active.length)\n        this.text(this.markString(active.pop(), false, parent, index), false);\n\n      // Output any previously expelled trailing whitespace outside the marks\n      if (leading) this.text(leading);\n\n      // Open the marks that need to be opened\n      if (node) {\n        while (active.length < len) {\n          const add = marks[active.length];\n          active.push(add);\n          this.text(this.markString(add, true, parent, index), false);\n        }\n\n        // Render the node. Special case code marks, since their content\n        // may not be escaped.\n        if (noEsc && node.isText)\n          this.text(\n            this.markString(inner, true, parent, index) +\n              node.text +\n              this.markString(inner, false, parent, index + 1),\n            false\n          );\n        else this.render(node, parent, index);\n      }\n    };\n    parent.forEach(progress);\n    progress(null, null, parent.childCount);\n  }\n\n  // :: (Node, string, (number) → string)\n  // Render a node's content as a list. `delim` should be the extra\n  // indentation added to all lines except the first in an item,\n  // `firstDelim` is a function going from an item index to a\n  // delimiter for the first line of the item.\n  renderList(node, delim, firstDelim) {\n    if (this.closed && this.closed.type === node.type) this.flushClose(3);\n    else if (this.inTightList) this.flushClose(1);\n\n    const isTight =\n      typeof node.attrs.tight !== \"undefined\"\n        ? node.attrs.tight\n        : this.options.tightLists;\n    const prevTight = this.inTightList;\n    const prevList = this.inList;\n    this.inList = true;\n    this.inTightList = isTight;\n    node.forEach((child, _, i) => {\n      if (i && isTight) this.flushClose(1);\n      this.wrapBlock(delim, firstDelim(i), node, () =>\n        this.render(child, node, i)\n      );\n    });\n    this.inList = prevList;\n    this.inTightList = prevTight;\n  }\n\n  renderTable(node) {\n    this.flushClose(1);\n\n    let headerBuffer = \"\";\n    const prevTable = this.inTable;\n    this.inTable = true;\n\n    // ensure there is an empty newline above all tables\n    this.out += \"\\n\";\n\n    // rows\n    node.forEach((row, _, i) => {\n      if (headerBuffer) {\n        this.out += `${headerBuffer}|\\n`;\n        headerBuffer = undefined;\n      }\n\n      // cols\n      row.forEach((cell, _, j) => {\n        this.out += j === 0 ? \"| \" : \" | \";\n\n        cell.forEach(para => {\n          // just padding the output so that empty cells take up the same space\n          // as headings.\n          // TODO: Ideally we'd calc the longest cell length and use that\n          // to pad all the others.\n          if (para.textContent === \"\") {\n            this.out += \"  \";\n          } else {\n            this.closed = false;\n            this.render(para, row, j);\n          }\n        });\n\n        if (i === 0) {\n          if (cell.attrs.alignment === \"center\") {\n            headerBuffer += \"|:---:\";\n          } else if (cell.attrs.alignment === \"left\") {\n            headerBuffer += \"|:---\";\n          } else if (cell.attrs.alignment === \"right\") {\n            headerBuffer += \"|---:\";\n          } else {\n            headerBuffer += \"|----\";\n          }\n        }\n      });\n\n      this.out += \" |\\n\";\n    });\n\n    this.inTable = prevTable;\n  }\n\n  // :: (string, ?bool) → string\n  // Escape the given string so that it can safely appear in Markdown\n  // content. If `startOfLine` is true, also escape characters that\n  // has special meaning only at the start of the line.\n  esc(str, startOfLine) {\n    str = str.replace(/[`*\\\\~\\[\\]]/g, \"\\\\$&\");\n    if (startOfLine) {\n      str = str.replace(/^[:#\\-*+]/, \"\\\\$&\").replace(/^(\\d+)\\./, \"$1\\\\.\");\n    }\n\n    if (this.inTable) {\n      str = str.replace(/\\|/gi, \"\\\\$&\");\n    }\n\n    return str;\n  }\n\n  quote(str) {\n    const wrap =\n      str.indexOf('\"') === -1 ? '\"\"' : str.indexOf(\"'\") === -1 ? \"''\" : \"()\";\n    return wrap[0] + str + wrap[1];\n  }\n\n  // :: (string, number) → string\n  // Repeat the given string `n` times.\n  repeat(str, n) {\n    let out = \"\";\n    for (let i = 0; i < n; i++) out += str;\n    return out;\n  }\n\n  // : (Mark, bool, string?) → string\n  // Get the markdown string for a given opening or closing mark.\n  markString(mark, open, parent, index) {\n    const info = this.marks[mark.type.name];\n    const value = open ? info.open : info.close;\n    return typeof value === \"string\" ? value : value(this, mark, parent, index);\n  }\n\n  // :: (string) → { leading: ?string, trailing: ?string }\n  // Get leading and trailing whitespace from a string. Values of\n  // leading or trailing property of the return object will be undefined\n  // if there is no match.\n  getEnclosingWhitespace(text) {\n    return {\n      leading: (text.match(/^(\\s+)/) || [])[0],\n      trailing: (text.match(/(\\s+)$/) || [])[0],\n    };\n  }\n}\n","// Adapted from:\n// https://github.com/markdown-it/markdown-it-mark/blob/master/index.js\n\nexport default function(options: { delim: string; mark: string }) {\n  const delimCharCode = options.delim.charCodeAt(0);\n\n  return function emphasisPlugin(md) {\n    function tokenize(state, silent) {\n      let i, token;\n\n      const start = state.pos,\n        marker = state.src.charCodeAt(start);\n\n      if (silent) {\n        return false;\n      }\n\n      if (marker !== delimCharCode) {\n        return false;\n      }\n\n      const scanned = state.scanDelims(state.pos, true);\n      const ch = String.fromCharCode(marker);\n      let len = scanned.length;\n\n      if (len < 2) {\n        return false;\n      }\n\n      if (len % 2) {\n        token = state.push(\"text\", \"\", 0);\n        token.content = ch;\n        len--;\n      }\n\n      for (i = 0; i < len; i += 2) {\n        token = state.push(\"text\", \"\", 0);\n        token.content = ch + ch;\n\n        if (!scanned.can_open && !scanned.can_close) {\n          continue;\n        }\n\n        state.delimiters.push({\n          marker,\n          length: 0, // disable \"rule of 3\" length checks meant for emphasis\n          jump: i,\n          token: state.tokens.length - 1,\n          end: -1,\n          open: scanned.can_open,\n          close: scanned.can_close,\n        });\n      }\n\n      state.pos += scanned.length;\n      return true;\n    }\n\n    // Walk through delimiter list and replace text tokens with tags\n    //\n    function postProcess(state, delimiters) {\n      let i, j, startDelim, endDelim, token;\n      const loneMarkers: number[] = [],\n        max = delimiters.length;\n\n      for (i = 0; i < max; i++) {\n        startDelim = delimiters[i];\n\n        if (startDelim.marker !== delimCharCode) {\n          continue;\n        }\n\n        if (startDelim.end === -1) {\n          continue;\n        }\n\n        endDelim = delimiters[startDelim.end];\n\n        token = state.tokens[startDelim.token];\n        token.type = `${options.mark}_open`;\n        token.tag = \"span\";\n        token.attrs = [[\"class\", options.mark]];\n        token.nesting = 1;\n        token.markup = options.delim;\n        token.content = \"\";\n\n        token = state.tokens[endDelim.token];\n        token.type = `${options.mark}_close`;\n        token.tag = \"span\";\n        token.nesting = -1;\n        token.markup = options.delim;\n        token.content = \"\";\n\n        if (\n          state.tokens[endDelim.token - 1].type === \"text\" &&\n          state.tokens[endDelim.token - 1].content === options.delim[0]\n        ) {\n          loneMarkers.push(endDelim.token - 1);\n        }\n      }\n\n      // If a marker sequence has an odd number of characters, it's split\n      // like this: `~~~~~` -> `~` + `~~` + `~~`, leaving one marker at the\n      // start of the sequence.\n      //\n      // So, we have to move all those markers after subsequent s_close tags.\n      while (loneMarkers.length) {\n        i = loneMarkers.pop();\n        j = i + 1;\n\n        while (\n          j < state.tokens.length &&\n          state.tokens[j].type === `${options.mark}_close`\n        ) {\n          j++;\n        }\n\n        j--;\n\n        if (i !== j) {\n          token = state.tokens[j];\n          state.tokens[j] = state.tokens[i];\n          state.tokens[i] = token;\n        }\n      }\n    }\n\n    md.inline.ruler.before(\"emphasis\", options.mark, tokenize);\n    md.inline.ruler2.before(\"emphasis\", options.mark, function(state) {\n      let curr;\n      const tokensMeta = state.tokens_meta,\n        max = (state.tokens_meta || []).length;\n\n      postProcess(state, state.delimiters);\n\n      for (curr = 0; curr < max; curr++) {\n        if (tokensMeta[curr] && tokensMeta[curr].delimiters) {\n          postProcess(state, tokensMeta[curr].delimiters);\n        }\n      }\n    });\n  };\n}\n","import MarkdownIt from \"markdown-it\";\nimport Token from \"markdown-it/lib/token\";\n\nconst CHECKBOX_REGEX = /\\[(X|\\s|_|-)\\]\\s(.*)?/i;\n\nfunction matches(token: Token) {\n  return token.content.match(CHECKBOX_REGEX);\n}\n\nfunction isInline(token: Token): boolean {\n  return token.type === \"inline\";\n}\nfunction isParagraph(token: Token): boolean {\n  return token.type === \"paragraph_open\";\n}\n\nfunction looksLikeChecklist(tokens: Token[], index: number) {\n  return (\n    isInline(tokens[index]) &&\n    isParagraph(tokens[index - 1]) &&\n    matches(tokens[index])\n  );\n}\n\nexport default function markdownItCheckbox(md: MarkdownIt): void {\n  function render(tokens, idx) {\n    const token = tokens[idx];\n    const checked = !!token.attrGet(\"checked\");\n\n    if (token.nesting === 1) {\n      // opening tag\n      return `<li><span class=\"checkbox\">${checked ? \"[x]\" : \"[ ]\"}</span>`;\n    } else {\n      // closing tag\n      return \"</li>\\n\";\n    }\n  }\n\n  md.renderer.rules.checkbox_item_open = render;\n  md.renderer.rules.checkbox_item_close = render;\n\n  // insert a new rule after the \"inline\" rules are parsed\n  md.core.ruler.after(\"inline\", \"checkboxes\", state => {\n    const tokens = state.tokens;\n\n    // work backwards through the tokens and find text that looks like a checkbox\n    for (let i = tokens.length - 1; i > 0; i--) {\n      const matches = looksLikeChecklist(tokens, i);\n      if (matches) {\n        const value = matches[1];\n        const checked = value.toLowerCase() === \"x\";\n\n        // convert surrounding list tokens\n        if (tokens[i - 3].type === \"bullet_list_open\") {\n          tokens[i - 3].type = \"checkbox_list_open\";\n        }\n\n        if (tokens[i + 3].type === \"bullet_list_close\") {\n          tokens[i + 3].type = \"checkbox_list_close\";\n        }\n\n        // remove [ ] [x] from list item label – must use the content from the\n        // child for escaped characters to be unescaped correctly.\n        const tokenChildren = tokens[i].children;\n        if (tokenChildren) {\n          const contentMatches = tokenChildren[0].content.match(CHECKBOX_REGEX);\n\n          if (contentMatches) {\n            const label = contentMatches[2];\n\n            tokens[i].content = label;\n            tokenChildren[0].content = label;\n          }\n        }\n\n        // open list item and ensure checked state is transferred\n        tokens[i - 2].type = \"checkbox_item_open\";\n\n        if (checked === true) {\n          tokens[i - 2].attrs = [[\"checked\", \"true\"]];\n        }\n\n        // close the list item\n        let j = i;\n        while (tokens[j].type !== \"list_item_close\") {\n          j++;\n        }\n        tokens[j].type = \"checkbox_item_close\";\n      }\n    }\n\n    return false;\n  });\n}\n","import MarkdownIt from \"markdown-it\";\nimport Token from \"markdown-it/lib/token\";\n\nfunction isParagraph(token: Token) {\n  return token.type === \"paragraph_open\";\n}\n\nfunction isInline(token: Token) {\n  return token.type === \"inline\" && token.level === 1;\n}\n\nfunction isLinkOpen(token: Token) {\n  return token.type === \"link_open\";\n}\n\nfunction isLinkClose(token: Token) {\n  return token.type === \"link_close\";\n}\n\nexport default function(embeds) {\n  function isEmbed(token: Token, link: Token) {\n    const href = link.attrs ? link.attrs[0][1] : \"\";\n    const simpleLink = href === token.content;\n\n    if (!simpleLink) return false;\n    if (!embeds) return false;\n\n    for (const embed of embeds) {\n      const matches = embed.matcher(href);\n      if (matches) {\n        return {\n          ...embed,\n          matches,\n        };\n      }\n    }\n  }\n\n  return function markdownEmbeds(md: MarkdownIt) {\n    md.core.ruler.after(\"inline\", \"embeds\", state => {\n      const tokens = state.tokens;\n      let insideLink;\n\n      for (let i = 0; i < tokens.length - 1; i++) {\n        // once we find an inline token look through it's children for links\n        if (isInline(tokens[i]) && isParagraph(tokens[i - 1])) {\n          const tokenChildren = tokens[i].children || [];\n\n          for (let j = 0; j < tokenChildren.length - 1; j++) {\n            const current = tokenChildren[j];\n            if (!current) continue;\n\n            if (isLinkOpen(current)) {\n              insideLink = current;\n              continue;\n            }\n\n            if (isLinkClose(current)) {\n              insideLink = null;\n              continue;\n            }\n\n            // of hey, we found a link – lets check to see if it should be\n            // considered to be an embed\n            if (insideLink) {\n              const result = isEmbed(current, insideLink);\n              if (result) {\n                const { content } = current;\n\n                // convert to embed token\n                const token = new Token(\"embed\", \"iframe\", 0);\n                token.attrSet(\"href\", content);\n                token.attrSet(\"matches\", result.matches);\n\n                // delete the inline link – this makes the assumption that the\n                // embed is the only thing in the para.\n                // TODO: double check this\n                tokens.splice(i - 1, 3, token);\n                break;\n              }\n            }\n          }\n        }\n      }\n\n      return false;\n    });\n  };\n}\n","import MarkdownIt from \"markdown-it\";\nimport Token from \"markdown-it/lib/token\";\n\nfunction isHardbreak(token: Token) {\n  return (\n    token.type === \"hardbreak\" ||\n    (token.type === \"text\" && token.content === \"\\\\\")\n  );\n}\n\nexport default function markdownBreakToParagraphs(md: MarkdownIt) {\n  // insert a new rule after the \"inline\" rules are parsed\n  md.core.ruler.after(\"inline\", \"breaks\", state => {\n    const { Token } = state;\n    const tokens = state.tokens;\n\n    // work backwards through the tokens and find text that looks like a br\n    for (let i = tokens.length - 1; i > 0; i--) {\n      const tokenChildren = tokens[i].children || [];\n      const matches = tokenChildren.filter(isHardbreak);\n\n      if (matches.length) {\n        let token;\n\n        const nodes: Token[] = [];\n        const children = tokenChildren.filter(child => !isHardbreak(child));\n\n        let count = matches.length;\n        if (!!children.length) count++;\n\n        for (let i = 0; i < count; i++) {\n          const isLast = i === count - 1;\n\n          token = new Token(\"paragraph_open\", \"p\", 1);\n          nodes.push(token);\n\n          const text = new Token(\"text\", \"\", 0);\n          text.content = \"\";\n\n          token = new Token(\"inline\", \"\", 0);\n          token.level = 1;\n          token.children = isLast ? [text, ...children] : [text];\n          token.content = \"\";\n          nodes.push(token);\n\n          token = new Token(\"paragraph_close\", \"p\", -1);\n          nodes.push(token);\n        }\n\n        tokens.splice(i - 1, 3, ...nodes);\n      }\n    }\n\n    return false;\n  });\n}\n","import MarkdownIt from \"markdown-it\";\nimport Token from \"markdown-it/lib/token\";\n\nconst BREAK_REGEX = /(?:^|[^\\\\])\\\\n/;\n\nexport default function markdownTables(md: MarkdownIt) {\n  // insert a new rule after the \"inline\" rules are parsed\n  md.core.ruler.after(\"inline\", \"tables-pm\", state => {\n    const tokens = state.tokens;\n    let inside = false;\n\n    for (let i = tokens.length - 1; i > 0; i--) {\n      if (inside) {\n        tokens[i].level--;\n      }\n\n      // convert unescaped \\n in the text into real br tag\n      if (tokens[i].type === \"inline\" && tokens[i].content.match(BREAK_REGEX)) {\n        const existing = tokens[i].children || [];\n        tokens[i].children = [];\n\n        existing.forEach(child => {\n          const breakParts = child.content.split(BREAK_REGEX);\n\n          // a schema agnostic way to know if a node is inline code would be\n          // great, for now we are stuck checking the node type.\n          if (breakParts.length > 1 && child.type !== \"code_inline\") {\n            breakParts.forEach((part, index) => {\n              const token = new Token(\"text\", \"\", 1);\n              token.content = part.trim();\n              tokens[i].children?.push(token);\n\n              if (index < breakParts.length - 1) {\n                const brToken = new Token(\"br\", \"br\", 1);\n                tokens[i].children?.push(brToken);\n              }\n            });\n          } else {\n            tokens[i].children?.push(child);\n          }\n        });\n      }\n\n      // filter out incompatible tokens from markdown-it that we don't need\n      // in prosemirror. thead/tbody do nothing.\n      if (\n        [\"thead_open\", \"thead_close\", \"tbody_open\", \"tbody_close\"].includes(\n          tokens[i].type\n        )\n      ) {\n        inside = !inside;\n        tokens.splice(i, 1);\n      }\n\n      if ([\"th_open\", \"td_open\"].includes(tokens[i].type)) {\n        // markdown-it table parser does not return paragraphs inside the cells\n        // but prosemirror requires them, so we add 'em in here.\n        tokens.splice(i + 1, 0, new Token(\"paragraph_open\", \"p\", 1));\n\n        // markdown-it table parser stores alignment as html styles, convert\n        // to a simple string here\n        const tokenAttrs = tokens[i].attrs;\n        if (tokenAttrs) {\n          const style = tokenAttrs[0][1];\n          tokens[i].info = style.split(\":\")[1];\n        }\n      }\n\n      if ([\"th_close\", \"td_close\"].includes(tokens[i].type)) {\n        tokens.splice(i, 0, new Token(\"paragraph_close\", \"p\", -1));\n      }\n    }\n\n    return false;\n  });\n}\n","import customFence from \"markdown-it-container\";\n\nexport default function notice(md): void {\n  return customFence(md, \"notice\", {\n    marker: \":\",\n    validate: () => true,\n    render: function(tokens, idx) {\n      const { info } = tokens[idx];\n\n      if (tokens[idx].nesting === 1) {\n        // opening tag\n        return `<div class=\"notice notice-${md.utils.escapeHtml(info)}\">\\n`;\n      } else {\n        // closing tag\n        return \"</div>\\n\";\n      }\n    },\n  });\n}\n","import MarkdownIt from \"markdown-it\";\n\nexport default function markdownUnderlines(md: MarkdownIt) {\n  md.inline.ruler2.after(\"emphasis\", \"underline\", state => {\n    const tokens = state.tokens;\n\n    for (let i = tokens.length - 1; i > 0; i--) {\n      const token = tokens[i];\n\n      if (token.markup === \"__\") {\n        if (token.type === \"strong_open\") {\n          tokens[i].tag = \"underline\";\n          tokens[i].type = \"underline_open\";\n        }\n        if (token.type === \"strong_close\") {\n          tokens[i].tag = \"underline\";\n          tokens[i].type = \"underline_close\";\n        }\n      }\n    }\n\n    return false;\n  });\n}\n","import markdownit from \"markdown-it\";\nimport markPlugin from \"./mark\";\nimport checkboxPlugin from \"./checkboxes\";\nimport embedsPlugin from \"./embeds\";\nimport breakPlugin from \"./breaks\";\nimport tablesPlugin from \"./tables\";\nimport noticesPlugin from \"./notices\";\nimport underlinesPlugin from \"./underlines\";\n\nexport default function rules({ embeds }) {\n  return markdownit(\"default\", {\n    breaks: false,\n    html: false,\n    linkify: true,\n  })\n    .use(embedsPlugin(embeds))\n    .use(breakPlugin)\n    .use(checkboxPlugin)\n    .use(markPlugin({ delim: \"==\", mark: \"highlight\" }))\n    .use(markPlugin({ delim: \"!!\", mark: \"placeholder\" }))\n    .use(underlinesPlugin)\n    .use(tablesPlugin)\n    .use(noticesPlugin);\n}\n","import { Schema } from \"prosemirror-model\";\nimport { keymap } from \"prosemirror-keymap\";\nimport { MarkdownParser } from \"prosemirror-markdown\";\nimport { MarkdownSerializer } from \"./markdown/serializer\";\nimport Editor from \"../apps\";\nimport Extension from \"./Extension\";\nimport makeRules from \"./markdown/rules\";\nimport Node from \"../nodes/Node\";\nimport Mark from \"../marks/Mark\";\n\nexport default class ExtensionManager {\n  extensions: Extension[];\n  embeds;\n\n  constructor(extensions: Extension[] = [], editor?: Editor) {\n    if (editor) {\n      extensions.forEach(extension => {\n        extension.bindEditor(editor);\n      });\n    }\n\n    this.extensions = extensions;\n    this.embeds = editor ? editor.props.embeds : undefined;\n  }\n\n  get nodes() {\n    return this.extensions\n      .filter(extension => extension.type === \"node\")\n      .reduce(\n        (nodes, node: Node) => ({\n          ...nodes,\n          [node.name]: node.schema,\n        }),\n        {}\n      );\n  }\n\n  serializer() {\n    const nodes = this.extensions\n      .filter(extension => extension.type === \"node\")\n      .reduce(\n        (nodes, extension: Node) => ({\n          ...nodes,\n          [extension.name]: extension.toMarkdown,\n        }),\n        {}\n      );\n\n    const marks = this.extensions\n      .filter(extension => extension.type === \"mark\")\n      .reduce(\n        (marks, extension: Mark) => ({\n          ...marks,\n          [extension.name]: extension.toMarkdown,\n        }),\n        {}\n      );\n\n    return new MarkdownSerializer(nodes, marks);\n  }\n\n  parser({ schema }) {\n    const tokens: Record<string, any> = this.extensions\n      .filter(\n        extension => extension.type === \"mark\" || extension.type === \"node\"\n      )\n      .reduce((nodes, extension: Node | Mark) => {\n        const md = extension.parseMarkdown();\n        if (!md) return nodes;\n\n        return {\n          ...nodes,\n          [extension.markdownToken || extension.name]: md,\n        };\n      }, {});\n\n    return new MarkdownParser(\n      schema,\n      makeRules({ embeds: this.embeds }),\n      tokens\n    );\n  }\n\n  get marks() {\n    return this.extensions\n      .filter(extension => extension.type === \"mark\")\n      .reduce(\n        (marks, { name, schema }: Mark) => ({\n          ...marks,\n          [name]: schema,\n        }),\n        {}\n      );\n  }\n\n  get plugins() {\n    return this.extensions\n      .filter(extension => extension.plugins)\n      .reduce((allPlugins, { plugins }) => [...allPlugins, ...plugins], []);\n  }\n\n  keymaps({ schema }: { schema: Schema }) {\n    const extensionKeymaps = this.extensions\n      .filter(extension => [\"extension\"].includes(extension.type))\n      .filter(extension => extension.keys)\n      .map(extension => extension.keys({ schema }));\n\n    const nodeMarkKeymaps = this.extensions\n      .filter(extension => [\"node\", \"mark\"].includes(extension.type))\n      .filter(extension => extension.keys)\n      .map(extension =>\n        extension.keys({\n          type: schema[`${extension.type}s`][extension.name],\n          schema,\n        })\n      );\n\n    return [\n      ...extensionKeymaps,\n      ...nodeMarkKeymaps,\n    ].map((keys: Record<string, any>) => keymap(keys));\n  }\n\n  inputRules({ schema }: { schema: Schema }) {\n    const extensionInputRules = this.extensions\n      .filter(extension => [\"extension\"].includes(extension.type))\n      .filter(extension => extension.inputRules)\n      .map(extension => extension.inputRules({ schema }));\n\n    const nodeMarkInputRules = this.extensions\n      .filter(extension => [\"node\", \"mark\"].includes(extension.type))\n      .filter(extension => extension.inputRules)\n      .map(extension =>\n        extension.inputRules({\n          type: schema[`${extension.type}s`][extension.name],\n          schema,\n        })\n      );\n\n    return [...extensionInputRules, ...nodeMarkInputRules].reduce(\n      (allInputRules, inputRules) => [...allInputRules, ...inputRules],\n      []\n    );\n  }\n\n  commands({ schema, view }) {\n    return this.extensions\n      .filter(extension => extension.commands)\n      .reduce((allCommands, extension) => {\n        const { name, type } = extension;\n        const commands = {};\n        const value = extension.commands({\n          schema,\n          ...([\"node\", \"mark\"].includes(type)\n            ? {\n                type: schema[`${type}s`][name],\n              }\n            : {}),\n        });\n\n        const apply = (callback, attrs) => {\n          if (!view.editable) {\n            return false;\n          }\n          view.focus();\n          return callback(attrs)(view.state, view.dispatch, view);\n        };\n\n        const handle = (_name, _value) => {\n          if (Array.isArray(_value)) {\n            commands[_name] = attrs =>\n              _value.forEach(callback => apply(callback, attrs));\n          } else if (typeof _value === \"function\") {\n            commands[_name] = attrs => apply(_value, attrs);\n          }\n        };\n\n        if (typeof value === \"object\") {\n          Object.entries(value).forEach(([commandName, commandValue]) => {\n            handle(commandName, commandValue);\n          });\n        } else {\n          handle(name, value);\n        }\n\n        return {\n          ...allCommands,\n          ...commands,\n        };\n      }, {});\n  }\n}\n","import * as React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ThemeProvider } from \"styled-components\";\nimport { EditorView, Decoration } from \"prosemirror-view\";\nimport Extension from \"../lib/Extension\";\nimport Node from \"../nodes/Node\";\nimport { light as lightTheme, dark as darkTheme } from \"../theme\";\nimport Editor from \"../apps\";\n\ntype Component = (options: {\n  node: Node;\n  theme: typeof lightTheme;\n  isSelected: boolean;\n  isEditable: boolean;\n  getPos: () => number;\n}) => React.ReactElement;\n\nexport default class ComponentView {\n  component: Component;\n  editor: Editor;\n  extension: Extension;\n  node: Node;\n  view: EditorView;\n  getPos: () => number;\n  decorations: Decoration<{ [key: string]: any }>[];\n  isSelected = false;\n  dom: HTMLElement | null;\n\n  // See https://prosemirror.net/docs/ref/#view.NodeView\n  constructor(\n    component,\n    { editor, extension, node, view, getPos, decorations }\n  ) {\n    this.component = component;\n    this.editor = editor;\n    this.extension = extension;\n    this.getPos = getPos;\n    this.decorations = decorations;\n    this.node = node;\n    this.view = view;\n    this.dom = node.type.spec.inline\n      ? document.createElement(\"span\")\n      : document.createElement(\"div\");\n\n    this.renderElement();\n  }\n\n  renderElement() {\n    const { dark } = this.editor.props;\n    const theme = this.editor.props.theme || (dark ? darkTheme : lightTheme);\n\n    const children = this.component({\n      theme,\n      node: this.node,\n      isSelected: this.isSelected,\n      isEditable: this.view.editable,\n      getPos: this.getPos,\n    });\n\n    ReactDOM.render(\n      <ThemeProvider theme={theme}>{children}</ThemeProvider>,\n      this.dom\n    );\n  }\n\n  update(node) {\n    if (node.type !== this.node.type) {\n      return false;\n    }\n\n    this.node = node;\n    this.renderElement();\n    return true;\n  }\n\n  selectNode() {\n    if (this.view.editable) {\n      this.isSelected = true;\n      this.renderElement();\n    }\n  }\n\n  deselectNode() {\n    if (this.view.editable) {\n      this.isSelected = false;\n      this.renderElement();\n    }\n  }\n\n  stopEvent() {\n    return true;\n  }\n\n  destroy() {\n    if (this.dom) {\n      ReactDOM.unmountComponentAtNode(this.dom);\n    }\n    this.dom = null;\n  }\n\n  ignoreMutation() {\n    return true;\n  }\n}\n","import { Node } from \"prosemirror-model\";\nimport escape from \"lodash/escape\";\nimport slugify from \"slugify\";\n\n// Slugify, escape, and remove periods from headings so that they are\n// compatible with both url hashes AND dom ID's (querySelector does not like\n// ID's that begin with a number or a period, for example).\nfunction safeSlugify(text: string) {\n  return `h-${escape(\n    slugify(text, {\n      remove: /[!\"#$%&'\\.()*+,\\/:;<=>?@\\[\\]\\\\^_`{|}~]/g,\n      lower: true,\n    })\n  )}`;\n}\n\n// calculates a unique slug for this heading based on it's text and position\n// in the document that is as stable as possible\nexport default function headingToSlug(node: Node, index = 0) {\n  const slugified = safeSlugify(node.textContent);\n  if (index === 0) return slugified;\n  return `${slugified}-${index}`;\n}\n","/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { InputRule } from \"prosemirror-inputrules\";\nimport { Plugin } from \"prosemirror-state\";\nimport Editor from \"../apps\";\n\ntype Command = (attrs) => (state, dispatch) => any;\n\nexport default class Extension {\n  options: Record<string, any>;\n  editor: Editor;\n\n  constructor(options: Record<string, any> = {}) {\n    this.options = {\n      ...this.defaultOptions,\n      ...options,\n    };\n  }\n\n  bindEditor(editor: Editor) {\n    this.editor = editor;\n  }\n\n  get type() {\n    return \"extension\";\n  }\n\n  get name() {\n    return \"\";\n  }\n\n  get plugins(): Plugin[] {\n    return [];\n  }\n\n  keys(options) {\n    return {};\n  }\n\n  inputRules(options): InputRule[] {\n    return [];\n  }\n\n  commands(options): Record<string, Command> | Command {\n    return attrs => () => false;\n  }\n\n  get defaultOptions() {\n    return {};\n  }\n}\n","import { MarkdownSerializerState } from \"prosemirror-markdown\";\nimport { Node as ProsemirrorNode } from \"prosemirror-model\";\nimport Extension from \"../lib/Extension\";\n\nexport default abstract class Node extends Extension {\n  get type() {\n    return \"node\";\n  }\n\n  abstract get schema();\n\n  get markdownToken(): string {\n    return \"\";\n  }\n\n  toMarkdown(state: MarkdownSerializerState, node: ProsemirrorNode) {\n    console.error(\"toMarkdown not implemented\", state, node);\n  }\n\n  parseMarkdown() {\n    return;\n  }\n}\n","import Node from \"./Node\";\n\nexport default class Doc extends Node {\n  get name() {\n    return \"doc\";\n  }\n\n  get schema() {\n    return {\n      content: \"block+\",\n    };\n  }\n}\n","import Node from \"./Node\";\n\nexport default class Text extends Node {\n  get name() {\n    return \"text\";\n  }\n\n  get schema() {\n    return {\n      group: \"inline\",\n      draggable: true\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.text(node.text);\n  }\n}\n","import { findParentNode, findSelectedNodeOfType } from \"prosemirror-utils\";\n\nconst isNodeActive = (type, attrs: Record<string, any> = {}) => state => {\n  const node =\n    findSelectedNodeOfType(type)(state.selection) ||\n    findParentNode(node => node.type === type)(state.selection);\n\n  if (!Object.keys(attrs).length || !node) {\n    return !!node;\n  }\n\n  return node.node.hasMarkup(type, { ...node.node.attrs, ...attrs });\n};\n\nexport default isNodeActive;\n","import { wrapIn, lift } from \"prosemirror-commands\";\nimport isNodeActive from \"../queries/isNodeActive\";\n\nexport default function toggleWrap(type, attrs?: Record<string, any>) {\n  return (state, dispatch) => {\n    const isActive = isNodeActive(type)(state);\n\n    if (isActive) {\n      return lift(state, dispatch);\n    }\n\n    return wrapIn(type, attrs)(state, dispatch);\n  };\n}\n","import { wrappingInputRule } from \"prosemirror-inputrules\";\nimport Node from \"./Node\";\nimport toggleWrap from \"../commands/toggleWrap\";\n\nexport default class Blockquote extends Node {\n  get name() {\n    return \"blockquote\";\n  }\n\n  get schema() {\n    return {\n      content: \"block+\",\n      group: \"block\",\n      defining: true,\n      draggable : true,\n      parseDOM: [{ tag: \"blockquote\" },{tag:\"span\"}],\n      toDOM: () => [[\"blockquote\"],[\"span\",{class:\"blockquote-icon\"},0]],\n    };\n  }\n\n  inputRules({ type }) {\n    return [wrappingInputRule(/^\\s*>\\s$/, type)];\n  }\n\n  commands({ type }) {\n    return () => toggleWrap(type);\n  }\n\n  keys({ type }) {\n    return {\n      \"Ctrl->\": toggleWrap(type),\n      \"Mod-]\": toggleWrap(type),\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.wrapBlock(\"> \", null, node, () => state.renderContent(node));\n  }\n\n  parseMarkdown() {\n    return { block: \"blockquote\" };\n  }\n}\n","export default function isList(node, schema) {\n  return (\n    node.type === schema.nodes.bullet_list ||\n    node.type === schema.nodes.ordered_list ||\n    node.type === schema.nodes.todo_list\n  );\n}\n","import { NodeType } from \"prosemirror-model\";\nimport { EditorState, Transaction } from \"prosemirror-state\";\nimport { wrapInList, liftListItem } from \"prosemirror-schema-list\";\nimport { findParentNode } from \"prosemirror-utils\";\nimport isList from \"../queries/isList\";\n\nexport default function toggleList(listType: NodeType, itemType: NodeType) {\n  return (state: EditorState, dispatch: (tr: Transaction) => void) => {\n    const { schema, selection } = state;\n    const { $from, $to } = selection;\n    const range = $from.blockRange($to);\n\n    if (!range) {\n      return false;\n    }\n\n    const parentList = findParentNode(node => isList(node, schema))(selection);\n\n    if (range.depth >= 1 && parentList && range.depth - parentList.depth <= 1) {\n      if (parentList.node.type === listType) {\n        return liftListItem(itemType)(state, dispatch);\n      }\n\n      if (\n        isList(parentList.node, schema) &&\n        listType.validContent(parentList.node.content)\n      ) {\n        const { tr } = state;\n        tr.setNodeMarkup(parentList.pos, listType);\n\n        if (dispatch) {\n          dispatch(tr);\n        }\n\n        return false;\n      }\n    }\n\n    return wrapInList(listType)(state, dispatch);\n  };\n}\n","import { wrappingInputRule } from \"prosemirror-inputrules\";\nimport toggleList from \"../commands/toggleList\";\nimport Node from \"./Node\";\n\nexport default class BulletList extends Node {\n  get name() {\n    return \"bullet_list\";\n  }\n\n  get schema() {\n    return {\n      content: \"list_item+\",\n      group: \"block\",\n      parseDOM: [{ tag: \"ul\" }],\n      toDOM: () => [\"ul\", 0],\n    };\n  }\n\n  commands({ type, schema }) {\n    return () => toggleList(type, schema.nodes.list_item);\n  }\n\n  keys({ type, schema }) {\n    return {\n      \"Shift-Ctrl-8\": toggleList(type, schema.nodes.list_item),\n    };\n  }\n\n  inputRules({ type }) {\n    return [wrappingInputRule(/^\\s*([-+*])\\s$/, type)];\n  }\n\n  toMarkdown(state, node) {\n    state.renderList(node, \"  \", () => (node.attrs.bullet || \"*\") + \" \");\n  }\n\n  parseMarkdown() {\n    return { block: \"bullet_list\" };\n  }\n}\n","import refractor from \"refractor/core\";\nimport flattenDeep from \"lodash/flattenDeep\";\nimport { Plugin, PluginKey } from \"prosemirror-state\";\nimport { Node } from \"prosemirror-model\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\nimport { findBlockNodes } from \"prosemirror-utils\";\n\nexport const LANGUAGES = {\n  none: \"None\", // additional entry to disable highlighting\n  bash: \"Bash\",\n  css: \"CSS\",\n  clike: \"C\",\n  csharp: \"C#\",\n  go: \"Go\",\n  markup: \"HTML\",\n  java: \"Java\",\n  javascript: \"JavaScript\",\n  json: \"JSON\",\n  php: \"PHP\",\n  powershell: \"Powershell\",\n  python: \"Python\",\n  ruby: \"Ruby\",\n  sql: \"SQL\",\n  typescript: \"TypeScript\",\n};\n\ntype ParsedNode = {\n  text: string;\n  classes: string[];\n};\n\nconst cache: Record<number, { node: Node; decorations: Decoration[] }> = {};\n\nfunction getDecorations({ doc, name }: { doc: Node; name: string }) {\n  const decorations: Decoration[] = [];\n  const blocks: { node: Node; pos: number }[] = findBlockNodes(doc).filter(\n    item => item.node.type.name === name\n  );\n\n  function parseNodes(\n    nodes: refractor.RefractorNode[],\n    classNames: string[] = []\n  ): any {\n    return nodes.map(node => {\n      if (node.type === \"element\") {\n        const classes = [...classNames, ...(node.properties.className || [])];\n        return parseNodes(node.children, classes);\n      }\n\n      return {\n        text: node.value,\n        classes: classNames,\n      };\n    });\n  }\n\n  blocks.forEach(block => {\n    let startPos = block.pos + 1;\n    const language = block.node.attrs.language;\n    if (!language || language === \"none\" || !refractor.registered(language)) {\n      return;\n    }\n\n    if (!cache[block.pos] || !cache[block.pos].node.eq(block.node)) {\n      const nodes = refractor.highlight(block.node.textContent, language);\n      const _decorations = flattenDeep(parseNodes(nodes))\n        .map((node: ParsedNode) => {\n          const from = startPos;\n          const to = from + node.text.length;\n\n          startPos = to;\n\n          return {\n            ...node,\n            from,\n            to,\n          };\n        })\n        .map(node => {\n          return Decoration.inline(node.from, node.to, {\n            class: (node.classes || []).join(\" \"),\n          });\n        });\n\n      cache[block.pos] = {\n        node: block.node,\n        decorations: _decorations,\n      };\n    }\n    cache[block.pos].decorations.forEach(decoration => {\n      decorations.push(decoration);\n    });\n  });\n\n  Object.keys(cache)\n    .filter(pos => !blocks.find(block => block.pos === Number(pos)))\n    .forEach(pos => {\n      delete cache[Number(pos)];\n    });\n\n  return DecorationSet.create(doc, decorations);\n}\n\nexport default function Prism({ name }) {\n  let highlighted = false;\n\n  return new Plugin({\n    key: new PluginKey(\"prism\"),\n    state: {\n      init: (_: Plugin, { doc }) => {\n        return DecorationSet.create(doc, []);\n      },\n      apply: (transaction, decorationSet, oldState, state) => {\n        const nodeName = state.selection.$head.parent.type.name;\n        const previousNodeName = oldState.selection.$head.parent.type.name;\n        const codeBlockChanged =\n          transaction.docChanged && [nodeName, previousNodeName].includes(name);\n\n        if (!highlighted || codeBlockChanged) {\n          highlighted = true;\n          return getDecorations({ doc: transaction.doc, name });\n        }\n\n        return decorationSet.map(transaction.mapping, transaction.doc);\n      },\n    },\n    view: view => {\n      if (!highlighted) {\n        // we don't highlight code blocks on the first render as part of mounting\n        // as it's expensive (relative to the rest of the document). Instead let\n        // it render un-highlighted and then trigger a defered render of Prism\n        // by updating the plugins metadata\n        setTimeout(() => {\n          view.dispatch(view.state.tr.setMeta(\"prism\", { loaded: true }));\n        }, 10);\n      }\n      return {};\n    },\n    props: {\n      decorations(state) {\n        return this.getState(state);\n      },\n    },\n  });\n}\n","import { EditorState } from \"prosemirror-state\";\n\nconst isMarkActive = type => (state: EditorState): boolean => {\n  const { from, $from, to, empty } = state.selection;\n\n  return empty\n    ? type.isInSet(state.storedMarks || $from.marks())\n    : state.doc.rangeHasMark(from, to, type);\n};\n\nexport default isMarkActive;\n","import isMarkActive from \"./isMarkActive\";\n\nexport default function isInCode(state) {\n  const $head = state.selection.$head;\n  for (let d = $head.depth; d > 0; d--) {\n    if ($head.node(d).type === state.schema.nodes.code_block) {\n      return true;\n    }\n  }\n\n  return isMarkActive(state.schema.marks.code_inline)(state);\n}\n","import refractor from \"refractor/core\";\nimport bash from \"refractor/lang/bash\";\nimport css from \"refractor/lang/css\";\nimport clike from \"refractor/lang/clike\";\nimport csharp from \"refractor/lang/csharp\";\nimport go from \"refractor/lang/go\";\nimport java from \"refractor/lang/java\";\nimport javascript from \"refractor/lang/javascript\";\nimport json from \"refractor/lang/json\";\nimport markup from \"refractor/lang/markup\";\nimport php from \"refractor/lang/php\";\nimport python from \"refractor/lang/python\";\nimport powershell from \"refractor/lang/powershell\";\nimport ruby from \"refractor/lang/ruby\";\nimport sql from \"refractor/lang/sql\";\nimport typescript from \"refractor/lang/typescript\";\nimport { setBlockType } from \"prosemirror-commands\";\nimport { textblockTypeInputRule } from \"prosemirror-inputrules\";\nimport copy from \"copy-to-clipboard\";\nimport Prism, { LANGUAGES } from \"../plugins/Prism\";\nimport isInCode from \"../queries/isInCode\";\nimport Node from \"./Node\";\nimport { ToastType } from \"../types\";\n\n[\n  bash,\n  css,\n  clike,\n  csharp,\n  go,\n  java,\n  javascript,\n  json,\n  markup,\n  php,\n  python,\n  powershell,\n  ruby,\n  sql,\n  typescript,\n].forEach(refractor.register);\n\nexport default class CodeFence extends Node {\n  get languageOptions() {\n    return Object.entries(LANGUAGES);\n  }\n\n  get name() {\n    return \"code_fence\";\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        language: {\n          default: \"javascript\",\n        },\n      },\n      content: \"text*\",\n      marks: \"\",\n      group: \"block\",\n      code: true,\n      defining: true,\n      draggable: true,\n      parseDOM: [\n        { tag: \"pre\", preserveWhitespace: \"full\" },\n        {\n          tag: \".code-block\",\n          preserveWhitespace: \"full\",\n          contentElement: \"code\",\n          getAttrs: (dom: HTMLDivElement) => {\n            return {\n              language: dom.dataset.language,\n            };\n          },\n        },\n      ],\n      toDOM: node => {\n        const button = document.createElement(\"button\");\n        button.innerText = \"Copy\";\n        button.type = \"button\";\n        button.addEventListener(\"click\", this.handleCopyToClipboard);\n\n        const select = document.createElement(\"select\");\n        select.addEventListener(\"change\", this.handleLanguageChange);\n\n        this.languageOptions.forEach(([key, label]) => {\n          const option = document.createElement(\"option\");\n          const value = key === \"none\" ? \"\" : key;\n          option.value = value;\n          option.innerText = label;\n          option.selected = node.attrs.language === value;\n          select.appendChild(option);\n        });\n\n        return [\n          \"div\",\n          { class: \"code-block\", \"data-language\": node.attrs.language },\n          [\"div\", { contentEditable: false }, select, button],\n          [\"pre\", [\"code\", { spellCheck: false }, 0]],\n        ];\n      },\n    };\n  }\n\n  commands({ type }) {\n    return () => setBlockType(type);\n  }\n\n  keys({ type }) {\n    return {\n      \"Shift-Ctrl-\\\\\": setBlockType(type),\n      \"Shift-Enter\": (state, dispatch) => {\n        if (!isInCode(state)) return false;\n\n        const { tr, selection } = state;\n        dispatch(tr.insertText(\"\\n\", selection.from, selection.to));\n        return true;\n      },\n      Tab: (state, dispatch) => {\n        if (!isInCode(state)) return false;\n\n        const { tr, selection } = state;\n        dispatch(tr.insertText(\"  \", selection.from, selection.to));\n        return true;\n      },\n    };\n  }\n\n  handleCopyToClipboard = event => {\n    const { view } = this.editor;\n    const element = event.target;\n    const { top, left } = element.getBoundingClientRect();\n    const result = view.posAtCoords({ top, left });\n\n    if (result) {\n      const node = view.state.doc.nodeAt(result.pos);\n      if (node) {\n        copy(node.textContent);\n        if (this.options.onShowToast) {\n          this.options.onShowToast(\n            this.options.dictionary.codeCopied,\n            ToastType.Info\n          );\n        }\n      }\n    }\n  };\n\n  handleLanguageChange = event => {\n    const { view } = this.editor;\n    const { tr } = view.state;\n    const element = event.target;\n    const { top, left } = element.getBoundingClientRect();\n    const result = view.posAtCoords({ top, left });\n\n    if (result) {\n      const transaction = tr.setNodeMarkup(result.inside, undefined, {\n        language: element.value,\n      });\n      view.dispatch(transaction);\n    }\n  };\n\n  get plugins() {\n    return [Prism({ name: this.name })];\n  }\n\n  inputRules({ type }) {\n    return [textblockTypeInputRule(/^```$/, type)];\n  }\n\n  toMarkdown(state, node) {\n    state.write(\"```\" + (node.attrs.language || \"\") + \"\\n\");\n    state.text(node.textContent, false);\n    state.ensureNewLine();\n    state.write(\"```\");\n    state.closeBlock(node);\n  }\n\n  get markdownToken() {\n    return \"fence\";\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"code_block\",\n      getAttrs: tok => ({ language: tok.info }),\n    };\n  }\n}\n","import CodeFence from \"./CodeFence\";\n\nexport default class CodeBlock extends CodeFence {\n  get name() {\n    return \"code_block\";\n  }\n\n  get markdownToken() {\n    return \"code_block\";\n  }\n}\n","import { wrappingInputRule } from \"prosemirror-inputrules\";\nimport toggleList from \"../commands/toggleList\";\nimport Node from \"./Node\";\n\nexport default class CheckboxList extends Node {\n  get name() {\n    return \"checkbox_list\";\n  }\n\n  get schema() {\n    return {\n      group: \"block\",\n      content: \"checkbox_item+\",\n      toDOM: () => [\"ul\", { class: this.name }, 0],\n      parseDOM: [\n        {\n          tag: `[class=\"${this.name}\"]`,\n        },\n      ],\n    };\n  }\n\n  keys({ type, schema }) {\n    return {\n      \"Shift-Ctrl-7\": toggleList(type, schema.nodes.checkbox_item),\n    };\n  }\n\n  commands({ type, schema }) {\n    return () => toggleList(type, schema.nodes.checkbox_item);\n  }\n\n  inputRules({ type }) {\n    return [wrappingInputRule(/^-?\\s*(\\[ \\])\\s$/i, type)];\n  }\n\n  toMarkdown(state, node) {\n    state.renderList(node, \"  \", () => \"- \");\n  }\n\n  parseMarkdown() {\n    return { block: \"checkbox_list\" };\n  }\n}\n","import {\n  splitListItem,\n  sinkListItem,\n  liftListItem,\n} from \"prosemirror-schema-list\";\nimport Node from \"./Node\";\n\nexport default class CheckboxItem extends Node {\n  get name() {\n    return \"checkbox_item\";\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        checked: {\n          default: false,\n        },\n      },\n      content: \"paragraph block*\",\n      defining: true,\n      draggable: true,\n      parseDOM: [\n        {\n          tag: `li[data-type=\"${this.name}\"]`,\n          getAttrs: (dom: HTMLLIElement) => ({\n            checked: dom.className.includes(\"checked\"),\n          }),\n        },\n      ],\n      toDOM: node => {\n        const input = document.createElement(\"input\");\n        input.type = \"checkbox\";\n        input.addEventListener(\"change\", this.handleChange);\n\n        if (node.attrs.checked) {\n          input.checked = true;\n        }\n\n        return [\n          \"li\",\n          {\n            \"data-type\": this.name,\n            class: node.attrs.checked ? \"checked\" : undefined,\n          },\n          [\n            \"span\",\n            {\n              contentEditable: false,\n            },\n            input,\n          ],\n          [\"div\", 0],\n        ];\n      },\n    };\n  }\n\n  handleChange = event => {\n    const { view } = this.editor;\n    const { tr } = view.state;\n    const { top, left } = event.target.getBoundingClientRect();\n    const result = view.posAtCoords({ top, left });\n\n    if (result) {\n      const transaction = tr.setNodeMarkup(result.inside, undefined, {\n        checked: event.target.checked,\n      });\n      view.dispatch(transaction);\n    }\n  };\n\n  keys({ type }) {\n    return {\n      Enter: splitListItem(type),\n      Tab: sinkListItem(type),\n      \"Shift-Tab\": liftListItem(type),\n      \"Mod-]\": sinkListItem(type),\n      \"Mod-[\": liftListItem(type),\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.write(node.attrs.checked ? \"[x] \" : \"[ ] \");\n    state.renderContent(node);\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"checkbox_item\",\n      getAttrs: tok => ({\n        checked: tok.attrGet(\"checked\") ? true : undefined,\n      }),\n    };\n  }\n}\n","import * as React from \"react\";\nimport Node from \"./Node\";\n\nconst cache = {};\n\nexport default class Embed extends Node {\n  get name() {\n    return \"embed\";\n  }\n\n  get schema() {\n    return {\n      content: \"inline*\",\n      group: \"block\",\n      atom: true,\n      attrs: {\n        href: {},\n        matches: {},\n      },\n      parseDOM: [\n        {\n          tag: \"iframe[class=embed]\",\n          getAttrs: (dom: HTMLIFrameElement) => {\n            const { embeds } = this.editor.props;\n            const href = dom.getAttribute(\"src\") || \"\";\n\n            if (embeds) {\n              for (const embed of embeds) {\n                const matches = embed.matcher(href);\n                if (matches) {\n                  return {\n                    href,\n                    matches,\n                  };\n                }\n              }\n            }\n\n            return {};\n          },\n        },\n      ],\n      toDOM: node => [\n        \"iframe\",\n        { class: \"embed\", src: node.attrs.href, contentEditable: false },\n        0,\n      ],\n    };\n  }\n\n  component({ isEditable, isSelected, theme, node }) {\n    const { embeds } = this.editor.props;\n\n    // matches are cached in module state to avoid re running loops and regex\n    // here. Unfortuantely this function is not compatible with React.memo or\n    // we would use that instead.\n    let Component = cache[node.attrs.href];\n\n    if (!Component) {\n      for (const embed of embeds) {\n        const matches = embed.matcher(node.attrs.href);\n        if (matches) {\n          Component = cache[node.attrs.href] = embed.component;\n        }\n      }\n    }\n\n    if (!Component) {\n      return null;\n    }\n\n    return (\n      <Component\n        attrs={node.attrs}\n        isEditable={isEditable}\n        isSelected={isSelected}\n        theme={theme}\n      />\n    );\n  }\n\n  commands({ type }) {\n    return attrs => (state, dispatch) => {\n      dispatch(\n        state.tr.replaceSelectionWith(type.create(attrs)).scrollIntoView()\n      );\n      return true;\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.ensureNewLine();\n    state.write(\n      \"[\" + state.esc(node.attrs.href) + \"](\" + state.esc(node.attrs.href) + \")\"\n    );\n    state.write(\"\\n\\n\");\n  }\n\n  parseMarkdown() {\n    return {\n      node: \"embed\",\n      getAttrs: token => ({\n        href: token.attrGet(\"href\"),\n        matches: token.attrGet(\"matches\"),\n      }),\n    };\n  }\n}\n","import Node from \"./Node\";\nimport { isInTable } from \"prosemirror-tables\";\n\nexport default class HardBreak extends Node {\n  get name() {\n    return \"br\";\n  }\n\n  get schema() {\n    return {\n      inline: true,\n      group: \"inline\",\n      selectable: false,\n      parseDOM: [{ tag: \"br\" }],\n      toDOM() {\n        return [\"br\"];\n      },\n    };\n  }\n\n  commands({ type }) {\n    return () => (state, dispatch) => {\n      dispatch(state.tr.replaceSelectionWith(type.create()).scrollIntoView());\n      return true;\n    };\n  }\n\n  keys({ type }) {\n    return {\n      \"Shift-Enter\": (state, dispatch) => {\n        if (!isInTable(state)) return false;\n        dispatch(state.tr.replaceSelectionWith(type.create()).scrollIntoView());\n        return true;\n      },\n    };\n  }\n\n  toMarkdown(state) {\n    state.write(\" \\\\n \");\n  }\n\n  parseMarkdown() {\n    return { node: \"br\" };\n  }\n}\n","export default function backspaceToParagraph(type) {\n  return (state, dispatch) => {\n    const { $from, from, to, empty } = state.selection;\n\n    // if the selection has anything in it then use standard delete behavior\n    if (!empty) return null;\n\n    // check we're in a matching node\n    if ($from.parent.type !== type) return null;\n\n    // check if we're at the beginning of the heading\n    const $pos = state.doc.resolve(from - 1);\n    if ($pos.parent === $from.parent) return null;\n\n    // okay, replace it with a paragraph\n    dispatch(\n      state.tr\n        .setBlockType(from, to, type.schema.nodes.paragraph)\n        .scrollIntoView()\n    );\n    return true;\n  };\n}\n","import { Plugin } from \"prosemirror-state\";\nimport copy from \"copy-to-clipboard\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\nimport { Node as ProsemirrorNode, NodeType } from \"prosemirror-model\";\nimport { textblockTypeInputRule } from \"prosemirror-inputrules\";\nimport { setBlockType } from \"prosemirror-commands\";\nimport { MarkdownSerializerState } from \"prosemirror-markdown\";\nimport backspaceToParagraph from \"../commands/backspaceToParagraph\";\nimport toggleBlockType from \"../commands/toggleBlockType\";\nimport headingToSlug from \"../lib/headingToSlug\";\nimport Node from \"./Node\";\nimport { ToastType } from \"../types\";\nimport { SortableHandle } from 'react-sortable-hoc';\n\n\nexport default class Heading extends Node {\n  className = \"heading-name\";\n\n  get name() {\n    return \"heading\";\n  }\n\n  get defaultOptions() {\n    return {\n      levels: [1, 2, 3, 4],\n    };\n  }\n\n\n\n  get schema() {\n    return {\n      attrs: {\n        level: {\n          default: 1,\n        },\n      },\n      content: \"inline*\",\n      group: \"block\",\n      defining: true,\n      draggable: true,\n      parseDOM: this.options.levels.map(level => ({\n        tag: `h${level}`,\n        attrs: { level },\n        draggable: true,\n        contentElement: \"span\",\n      })),\n       toDOM: () => [\"h1\",{draggable:true},0]\n    };\n  }\n\n  \n\n  toMarkdown(state: MarkdownSerializerState, node: ProsemirrorNode) {\n    state.write(state.repeat(\"#\", node.attrs.level) + \" \");\n    state.renderInline(node);\n    state.closeBlock(node);\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"heading\",\n      getAttrs: (token: Record<string, any>) => ({\n        level: +token.tag.slice(1),\n      }),\n    };\n  }\n\n  commands({ type, schema }) {\n    return (attrs: Record<string, any>) => {\n      return toggleBlockType(type, schema.nodes.paragraph, attrs);\n    };\n  }\n\n\n  handleCopyLink = () => {\n    return event => {\n      // this is unfortunate but appears to be the best way to grab the anchor\n      // as it's added directly to the dom by a decoration.\n      const anchor = event.currentTarget.parentNode.previousSibling;\n      if (!anchor.className.includes(this.className)) {\n        throw new Error(\"Did not find anchor as previous sibling of heading\");\n      }\n      const hash = `#${anchor.id}`;\n\n      // the existing url might contain a hash already, lets make sure to remove\n      // that rather than appending another one.\n      const urlWithoutHash = window.location.href.split(\"#\")[0];\n      copy(urlWithoutHash + hash);\n\n      if (this.options.onShowToast) {\n        this.options.onShowToast(\n          this.options.dictionary.linkCopied,\n          ToastType.Info\n        );\n      }\n    };\n  };\n\n  keys({ type }: { type: NodeType }) {\n    const options = this.options.levels.reduce(\n      (items, level) => ({\n        ...items,\n        ...{\n          [`Shift-Ctrl-${level}`]: setBlockType(type, { level }),\n        },\n      }),\n      {}\n    );\n\n    return {\n      ...options,\n      Backspace: backspaceToParagraph(type),\n    };\n  }\n\n  get plugins() {\n    const getAnchors = doc => {\n      const decorations: Decoration[] = [];\n      const previouslySeen = {};\n\n      doc.descendants((node, pos) => {\n        if (node.type.name !== this.name) return;\n\n        // calculate the optimal id\n        const slug = headingToSlug(node);\n        let id = slug;\n\n        // check if we've already used it, and if so how many times?\n        // Make the new id based on that number ensuring that we have\n        // unique ID's even when headings are identical\n        if (previouslySeen[slug] > 0) {\n          id = headingToSlug(node, previouslySeen[slug]);\n        }\n\n        // record that we've seen this slug for the next loop\n        previouslySeen[slug] =\n          previouslySeen[slug] !== undefined ? previouslySeen[slug] + 1 : 1;\n\n        decorations.push(\n          Decoration.widget(\n            pos,\n            () => {\n              const anchor = document.createElement(\"a\");\n              anchor.id = id;\n              anchor.className = this.className;\n              return anchor;\n            },\n            {\n              side: -1,\n              key: id,\n            }\n          )\n        );\n      });\n\n      return DecorationSet.create(doc, decorations);\n    };\n\n    const plugin = new Plugin({\n      state: {\n        init: (config, state) => {\n          return getAnchors(state.doc);\n        },\n        apply: (tr, oldState) => {\n          return tr.docChanged ? getAnchors(tr.doc) : oldState;\n        },\n      },\n      props: {\n        decorations: state => plugin.getState(state),\n      },\n    });\n\n    return [plugin];\n  }\n\n  inputRules({ type }: { type: NodeType }) {\n    return this.options.levels.map(level =>\n      textblockTypeInputRule(new RegExp(`^(#{1,${level}})\\\\s$`), type, () => ({\n        level,\n      }))\n    );\n  }\n}\n","import { setBlockType } from \"prosemirror-commands\";\nimport isNodeActive from \"../queries/isNodeActive\";\n\nexport default function toggleBlockType(type, toggleType, attrs = {}) {\n  return (state, dispatch) => {\n    const isActive = isNodeActive(type, attrs)(state);\n\n    if (isActive) {\n      return setBlockType(toggleType)(state, dispatch);\n    }\n\n    return setBlockType(type, attrs)(state, dispatch);\n  };\n}\n","import { InputRule } from \"prosemirror-inputrules\";\nimport Node from \"./Node\";\n\nexport default class HorizontalRule extends Node {\n  get name() {\n    return \"hr\";\n  }\n\n  get schema() {\n    return {\n      group: \"block\",\n      draggable: true,\n      parseDOM: [{ tag: \"hr\" }],\n      toDOM() {\n        return [\"hr\"];\n      },\n    };\n  }\n\n  commands({ type }) {\n    return () => (state, dispatch) => {\n      dispatch(state.tr.replaceSelectionWith(type.create()).scrollIntoView());\n      return true;\n    };\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-_\": (state, dispatch) => {\n        dispatch(state.tr.replaceSelectionWith(type.create()).scrollIntoView());\n        return true;\n      },\n    };\n  }\n\n  inputRules({ type }) {\n    return [\n      new InputRule(/^(?:---|___\\s|\\*\\*\\*\\s)$/, (state, match, start, end) => {\n        const { tr } = state;\n\n        if (match[0]) {\n          tr.replaceWith(start - 1, end, type.create({}));\n        }\n\n        return tr;\n      }),\n    ];\n  }\n\n  toMarkdown(state, node) {\n    state.write(node.attrs.markup || \"\\n---\");\n    state.closeBlock(node);\n  }\n\n  parseMarkdown() {\n    return { node: \"hr\" };\n  }\n}\n","import * as React from \"react\";\nimport { Plugin, NodeSelection } from \"prosemirror-state\";\nimport { InputRule } from \"prosemirror-inputrules\";\nimport { setTextSelection } from \"prosemirror-utils\";\nimport styled from \"styled-components\";\nimport ImageZoom from \"react-medium-image-zoom\";\nimport getDataTransferFiles from \"../lib/getDataTransferFiles\";\nimport uploadPlaceholderPlugin from \"../lib/uploadPlaceholder\";\nimport insertFiles from \"../commands/insertFiles\";\nimport Node from \"./Node\";\n\n/**\n * Matches following attributes in Markdown-typed image: [, alt, src, class]\n *\n * Example:\n * ![Lorem](image.jpg) -> [, \"Lorem\", \"image.jpg\"]\n * ![](image.jpg \"class\") -> [, \"\", \"image.jpg\", \"small\"]\n * ![Lorem](image.jpg \"class\") -> [, \"Lorem\", \"image.jpg\", \"small\"]\n */\nconst IMAGE_INPUT_REGEX = /!\\[(?<alt>.*?)]\\((?<filename>.*?)(?=\\“|\\))\\“?(?<layoutclass>[^\\”]+)?\\”?\\)/;\n\nconst uploadPlugin = options =>\n  new Plugin({\n    props: {\n      handleDOMEvents: {\n        paste(view, event: ClipboardEvent): boolean {\n          if (\n            (view.props.editable && !view.props.editable(view.state)) ||\n            !options.uploadImage\n          ) {\n            return false;\n          }\n\n          if (!event.clipboardData) return false;\n\n          // check if we actually pasted any files\n          const files = Array.prototype.slice\n            .call(event.clipboardData.items)\n            .map(dt => dt.getAsFile())\n            .filter(file => file);\n\n          if (files.length === 0) return false;\n\n          const { tr } = view.state;\n          if (!tr.selection.empty) {\n            tr.deleteSelection();\n          }\n          const pos = tr.selection.from;\n\n          insertFiles(view, event, pos, files, options);\n          return true;\n        },\n        drop(view, event: DragEvent): boolean {\n          if (\n            (view.props.editable && !view.props.editable(view.state)) ||\n            !options.uploadImage\n          ) {\n            return false;\n          }\n\n          // filter to only include image files\n          const files = getDataTransferFiles(event).filter(file =>\n            /image/i.test(file.type)\n          );\n          if (files.length === 0) {\n            return false;\n          }\n\n          // grab the position in the document for the cursor\n          const result = view.posAtCoords({\n            left: event.clientX,\n            top: event.clientY,\n          });\n\n          if (result) {\n            insertFiles(view, event, result.pos, files, options);\n            return true;\n          }\n\n          return false;\n        },\n      },\n    },\n  });\n\nconst IMAGE_CLASSES = [\"right-50\", \"left-50\"];\nconst getLayoutAndTitle = tokenTitle => {\n  if (!tokenTitle) return {};\n  if (IMAGE_CLASSES.includes(tokenTitle)) {\n    return {\n      layoutClass: tokenTitle,\n    };\n  } else {\n    return {\n      title: tokenTitle,\n    };\n  }\n};\n\nexport default class Image extends Node {\n  get name() {\n    return \"image\";\n  }\n\n  get schema() {\n    return {\n      inline: true,\n      attrs: {\n        src: {},\n        alt: {\n          default: null,\n        },\n        layoutClass: {\n          default: null,\n        },\n        title: {\n          default: null,\n        },\n      },\n      content: \"text*\",\n      marks: \"\",\n      group: \"inline\",\n      selectable: true,\n      draggable: true,\n      parseDOM: [\n        {\n          tag: \"div[class~=image]\",\n          getAttrs: (dom: HTMLDivElement) => {\n            const img = dom.getElementsByTagName(\"img\")[0];\n            const className = dom.className;\n            const layoutClassMatched =\n              className && className.match(/image-(.*)$/);\n            const layoutClass = layoutClassMatched\n              ? layoutClassMatched[1]\n              : null;\n            return {\n              src: img.getAttribute(\"src\"),\n              alt: img.getAttribute(\"alt\"),\n              title: img.getAttribute(\"title\"),\n              layoutClass: layoutClass,\n            };\n          },\n        },\n      ],\n      toDOM: node => {\n        const className = node.attrs.layoutClass\n          ? `image image-${node.attrs.layoutClass}`\n          : \"image\";\n        return [\n          \"div\",\n          {\n            class: className,\n          },\n          [\"img\", { ...node.attrs, contentEditable: false }],\n          [\"p\", { class: \"caption\" }, 0],\n        ];\n      },\n    };\n  }\n\n  handleKeyDown = ({ node, getPos }) => event => {\n    // Pressing Enter in the caption field should move the cursor/selection\n    // below the image\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n\n      const { view } = this.editor;\n      const pos = getPos() + node.nodeSize;\n      view.focus();\n      view.dispatch(setTextSelection(pos)(view.state.tr));\n      return;\n    }\n\n    // Pressing Backspace in an an empty caption field should remove the entire\n    // image, leaving an empty paragraph\n    if (event.key === \"Backspace\" && event.target.innerText === \"\") {\n      const { view } = this.editor;\n      const $pos = view.state.doc.resolve(getPos());\n      const tr = view.state.tr.setSelection(new NodeSelection($pos));\n      view.dispatch(tr.deleteSelection());\n      view.focus();\n      return;\n    }\n  };\n\n  handleBlur = ({ node, getPos }) => event => {\n    const alt = event.target.innerText;\n    const { src, title, layoutClass } = node.attrs;\n\n    if (alt === node.attrs.alt) return;\n\n    const { view } = this.editor;\n    const { tr } = view.state;\n\n    // update meta on object\n    const pos = getPos();\n    const transaction = tr.setNodeMarkup(pos, undefined, {\n      src,\n      alt,\n      title,\n      layoutClass,\n    });\n    view.dispatch(transaction);\n  };\n\n  handleSelect = ({ getPos }) => event => {\n    event.preventDefault();\n\n    const { view } = this.editor;\n    const $pos = view.state.doc.resolve(getPos());\n    const transaction = view.state.tr.setSelection(new NodeSelection($pos));\n    view.dispatch(transaction);\n  };\n\n  component = props => {\n    const { theme, isSelected } = props;\n    const { alt, src, title, layoutClass } = props.node.attrs;\n    const className = layoutClass ? `image image-${layoutClass}` : \"image\";\n\n    return (\n      <div contentEditable={false} className={className}>\n        <ImageWrapper\n          className={isSelected ? \"ProseMirror-selectednode\" : \"\"}\n          onClick={this.handleSelect(props)}\n        >\n          <ImageZoom\n            image={{\n              src,\n              alt,\n              title,\n            }}\n            defaultStyles={{\n              overlay: {\n                backgroundColor: theme.background,\n              },\n            }}\n            shouldRespectMaxDimension\n          />\n        </ImageWrapper>\n        <Caption\n          onKeyDown={this.handleKeyDown(props)}\n          onBlur={this.handleBlur(props)}\n          className=\"caption\"\n          tabIndex={-1}\n          role=\"textbox\"\n          contentEditable\n          suppressContentEditableWarning\n        >\n          {alt}\n        </Caption>\n      </div>\n    );\n  };\n\n  toMarkdown(state, node) {\n    let markdown =\n      \" ![\" +\n      state.esc((node.attrs.alt || \"\").replace(\"\\n\", \"\") || \"\") +\n      \"](\" +\n      state.esc(node.attrs.src);\n    if (node.attrs.layoutClass) {\n      markdown += ' \"' + state.esc(node.attrs.layoutClass) + '\"';\n    } else if (node.attrs.title) {\n      markdown += ' \"' + state.esc(node.attrs.title) + '\"';\n    }\n    markdown += \")\";\n    state.write(markdown);\n  }\n\n  parseMarkdown() {\n    return {\n      node: \"image\",\n      getAttrs: token => {\n        return {\n          src: token.attrGet(\"src\"),\n          alt: (token.children[0] && token.children[0].content) || null,\n          ...getLayoutAndTitle(token.attrGet(\"title\")),\n        };\n      },\n    };\n  }\n\n  commands({ type }) {\n    return {\n      deleteImage: () => (state, dispatch) => {\n        dispatch(state.tr.deleteSelection());\n        return true;\n      },\n      alignRight: () => (state, dispatch) => {\n        const attrs = {\n          ...state.selection.node.attrs,\n          title: null,\n          layoutClass: \"right-50\",\n        };\n        const { selection } = state;\n        dispatch(state.tr.setNodeMarkup(selection.$from.pos, undefined, attrs));\n        return true;\n      },\n      alignLeft: () => (state, dispatch) => {\n        const attrs = {\n          ...state.selection.node.attrs,\n          title: null,\n          layoutClass: \"left-50\",\n        };\n        const { selection } = state;\n        dispatch(state.tr.setNodeMarkup(selection.$from.pos, undefined, attrs));\n        return true;\n      },\n      alignCenter: () => (state, dispatch) => {\n        const attrs = { ...state.selection.node.attrs, layoutClass: null };\n        const { selection } = state;\n        dispatch(state.tr.setNodeMarkup(selection.$from.pos, undefined, attrs));\n        return true;\n      },\n      createImage: attrs => (state, dispatch) => {\n        const { selection } = state;\n        const position = selection.$cursor\n          ? selection.$cursor.pos\n          : selection.$to.pos;\n        const node = type.create(attrs);\n        const transaction = state.tr.insert(position, node);\n        dispatch(transaction);\n        return true;\n      },\n    };\n  }\n\n  inputRules({ type }) {\n    return [\n      new InputRule(IMAGE_INPUT_REGEX, (state, match, start, end) => {\n        const [okay, alt, src, matchedTitle] = match;\n        const { tr } = state;\n        if (okay) {\n          tr.replaceWith(\n            start - 1,\n            end,\n            type.create({\n              src,\n              alt,\n              ...getLayoutAndTitle(matchedTitle),\n            })\n          );\n        }\n\n        return tr;\n      }),\n    ];\n  }\n\n  get plugins() {\n    return [uploadPlaceholderPlugin, uploadPlugin(this.options)];\n  }\n}\n\nconst ImageWrapper = styled.span`\n  line-height: 0;\n  display: inline-block;\n`;\n\nconst Caption = styled.p`\n  border: 0;\n  display: block;\n  font-size: 13px;\n  font-style: italic;\n  color: ${props => props.theme.textSecondary};\n  padding: 2px 0;\n  line-height: 16px;\n  text-align: center;\n  min-height: 1em;\n  outline: none;\n  background: none;\n  resize: none;\n  user-select: text;\n  cursor: text;\n\n  &:empty:before {\n    color: ${props => props.theme.placeholder};\n    content: \"Write a caption\";\n    pointer-events: none;\n  }\n`;\n","import { Node } from \"prosemirror-model\";\nimport { EditorState } from \"prosemirror-state\";\n\nexport default function getParentListItem(\n  state: EditorState\n): [Node, number] | void {\n  const $head = state.selection.$head;\n  for (let d = $head.depth; d > 0; d--) {\n    const node = $head.node(d);\n    if ([\"list_item\", \"checkbox_item\"].includes(node.type.name)) {\n      return [node, $head.before(d)];\n    }\n  }\n}\n","import {\n  splitListItem,\n  sinkListItem,\n  liftListItem,\n} from \"prosemirror-schema-list\";\nimport {\n  Transaction,\n  EditorState,\n  Plugin,\n  TextSelection,\n} from \"prosemirror-state\";\nimport { DecorationSet, Decoration } from \"prosemirror-view\";\nimport { findParentNodeClosestToPos } from \"prosemirror-utils\";\n\nimport Node from \"./Node\";\nimport isInList from \"../queries/isInList\";\nimport getParentListItem from \"../queries/getParentListItem\";\n\nexport default class ListItem extends Node {\n  get name() {\n    return \"list_item\";\n  }\n\n  get schema() {\n    return {\n      content: \"paragraph block*\",\n      defining: true,\n      draggable: true,\n      parseDOM: [{ tag: \"li\" }],\n      toDOM: () => [\"li\", 0],\n    };\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        state: {\n          init() {\n            return DecorationSet.empty;\n          },\n          apply: (\n            tr: Transaction,\n            set: DecorationSet,\n            oldState: EditorState,\n            newState: EditorState\n          ) => {\n            const action = tr.getMeta(\"li\");\n            if (!action && !tr.docChanged) {\n              return set;\n            }\n\n            // Adjust decoration positions to changes made by the transaction\n            set = set.map(tr.mapping, tr.doc);\n\n            switch (action?.event) {\n              case \"mouseover\": {\n                const result = findParentNodeClosestToPos(\n                  newState.doc.resolve(action.pos),\n                  node =>\n                    node.type.name === this.name ||\n                    node.type.name === \"checkbox_item\"\n                );\n\n                if (!result) {\n                  return set;\n                }\n\n                return DecorationSet.create(tr.doc, [\n                  Decoration.node(\n                    result.pos,\n                    result.pos + result.node.nodeSize,\n                    {\n                      class: \"hovering\",\n                    }\n                  ),\n                ]);\n              }\n              case \"mouseout\": {\n                const result = findParentNodeClosestToPos(\n                  newState.doc.resolve(action.pos),\n                  node =>\n                    node.type.name === this.name ||\n                    node.type.name === \"checkbox_item\"\n                );\n\n                if (!result) {\n                  return set;\n                }\n\n                return set.remove(\n                  set.find(result.pos, result.pos + result.node.nodeSize)\n                );\n              }\n              default:\n            }\n\n            return set;\n          },\n        },\n        props: {\n          decorations(state) {\n            return this.getState(state);\n          },\n          handleDOMEvents: {\n            mouseover: (view, event) => {\n              const { state, dispatch } = view;\n              const target = event.target as HTMLElement;\n              const li = target?.closest(\"li\");\n\n              if (!li) {\n                return false;\n              }\n              if (!view.dom.contains(li)) {\n                return false;\n              }\n              const pos = view.posAtDOM(li, 0);\n              if (!pos) {\n                return false;\n              }\n\n              dispatch(\n                state.tr.setMeta(\"li\", {\n                  event: \"mouseover\",\n                  pos,\n                })\n              );\n              return false;\n            },\n            mouseout: (view, event) => {\n              const { state, dispatch } = view;\n              const target = event.target as HTMLElement;\n              const li = target?.closest(\"li\");\n\n              if (!li) {\n                return false;\n              }\n              if (!view.dom.contains(li)) {\n                return false;\n              }\n              const pos = view.posAtDOM(li, 0);\n              if (!pos) {\n                return false;\n              }\n\n              dispatch(\n                state.tr.setMeta(\"li\", {\n                  event: \"mouseout\",\n                  pos,\n                })\n              );\n              return false;\n            },\n          },\n        },\n      }),\n    ];\n  }\n\n  keys({ type }) {\n    return {\n      Enter: splitListItem(type),\n      Tab: sinkListItem(type),\n      \"Shift-Tab\": liftListItem(type),\n      \"Mod-]\": sinkListItem(type),\n      \"Mod-[\": liftListItem(type),\n      \"Shift-Enter\": (state, dispatch) => {\n        if (!isInList(state)) return false;\n        if (!state.selection.empty) return false;\n\n        const { tr, selection } = state;\n        dispatch(tr.split(selection.to));\n        return true;\n      },\n      \"Alt-ArrowUp\": (state, dispatch) => {\n        if (!state.selection.empty) return false;\n        const result = getParentListItem(state);\n        if (!result) return false;\n\n        const [li, pos] = result;\n        const $pos = state.doc.resolve(pos);\n\n        if (\n          !$pos.nodeBefore ||\n          ![\"list_item\", \"checkbox_item\"].includes($pos.nodeBefore.type.name)\n        ) {\n          console.log(\"Node before not a list item\");\n          return false;\n        }\n\n        const { tr } = state;\n        const newPos = pos - $pos.nodeBefore.nodeSize;\n\n        dispatch(\n          tr\n            .delete(pos, pos + li.nodeSize)\n            .insert(newPos, li)\n            .setSelection(TextSelection.near(tr.doc.resolve(newPos)))\n        );\n        return true;\n      },\n      \"Alt-ArrowDown\": (state, dispatch) => {\n        if (!state.selection.empty) return false;\n        const result = getParentListItem(state);\n        if (!result) return false;\n\n        const [li, pos] = result;\n        const $pos = state.doc.resolve(pos + li.nodeSize);\n\n        if (\n          !$pos.nodeAfter ||\n          ![\"list_item\", \"checkbox_item\"].includes($pos.nodeAfter.type.name)\n        ) {\n          console.log(\"Node after not a list item\");\n          return false;\n        }\n\n        const { tr } = state;\n        const newPos = pos + li.nodeSize + $pos.nodeAfter.nodeSize;\n\n        dispatch(\n          tr\n            .insert(newPos, li)\n            .setSelection(TextSelection.near(tr.doc.resolve(newPos)))\n            .delete(pos, pos + li.nodeSize)\n        );\n        return true;\n      },\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.renderContent(node);\n  }\n\n  parseMarkdown() {\n    return { block: \"list_item\" };\n  }\n}\n","export default function isInList(state) {\n  const $head = state.selection.$head;\n  for (let d = $head.depth; d > 0; d--) {\n    if (\n      [\"ordered_list\", \"bullet_list\", \"checkbox_list\"].includes(\n        $head.node(d).type.name\n      )\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","import { wrappingInputRule } from \"prosemirror-inputrules\";\nimport toggleWrap from \"../commands/toggleWrap\";\nimport { WarningIcon, InfoIcon, StarredIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Node from \"./Node\";\n\nexport default class Notice extends Node {\n  get styleOptions() {\n    return Object.entries({\n      info: this.options.dictionary.info,\n      warning: this.options.dictionary.warning,\n      tip: this.options.dictionary.tip,\n    });\n  }\n\n  get name() {\n    return \"container_notice\";\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        style: {\n          default: \"info\",\n        },\n      },\n      content: \"block+\",\n      group: \"block\",\n      defining: true,\n      draggable: true,\n      parseDOM: [\n        {\n          tag: \"div.notice-block\",\n          preserveWhitespace: \"full\",\n          contentElement: \"div:last-child\",\n          getAttrs: (dom: HTMLDivElement) => ({\n            style: dom.className.includes(\"tip\")\n              ? \"tip\"\n              : dom.className.includes(\"warning\")\n              ? \"warning\"\n              : undefined,\n          }),\n        },\n      ],\n      toDOM: node => {\n        const select = document.createElement(\"select\");\n        select.addEventListener(\"change\", this.handleStyleChange);\n\n        this.styleOptions.forEach(([key, label]) => {\n          const option = document.createElement(\"option\");\n          option.value = key;\n          option.innerText = label;\n          option.selected = node.attrs.style === key;\n          select.appendChild(option);\n        });\n\n        let component;\n\n        if (node.attrs.style === \"tip\") {\n          component = <StarredIcon color=\"currentColor\" />;\n        } else if (node.attrs.style === \"warning\") {\n          component = <WarningIcon color=\"currentColor\" />;\n        } else {\n          component = <InfoIcon color=\"currentColor\" />;\n        }\n\n        const icon = document.createElement(\"div\");\n        icon.className = \"icon\";\n        ReactDOM.render(component, icon);\n\n        return [\n          \"div\",\n          { class: `notice-block ${node.attrs.style}` },\n          icon,\n          [\"div\", { contentEditable: false }, select],\n          [\"div\", { class: \"content\" }, 0],\n        ];\n      },\n    };\n  }\n\n  commands({ type }) {\n    return attrs => toggleWrap(type, attrs);\n  }\n\n  handleStyleChange = event => {\n    const { view } = this.editor;\n    const { tr } = view.state;\n    const element = event.target;\n    const { top, left } = element.getBoundingClientRect();\n    const result = view.posAtCoords({ top, left });\n\n    if (result) {\n      const transaction = tr.setNodeMarkup(result.inside, undefined, {\n        style: element.value,\n      });\n      view.dispatch(transaction);\n    }\n  };\n\n  inputRules({ type }) {\n    return [wrappingInputRule(/^:::$/, type)];\n  }\n\n  toMarkdown(state, node) {\n    state.write(\"\\n:::\" + (node.attrs.style || \"info\") + \"\\n\");\n    state.renderContent(node);\n    state.ensureNewLine();\n    state.write(\":::\");\n    state.closeBlock(node);\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"container_notice\",\n      getAttrs: tok => ({ style: tok.info }),\n    };\n  }\n}\n","import { wrappingInputRule } from \"prosemirror-inputrules\";\nimport toggleList from \"../commands/toggleList\";\nimport Node from \"./Node\";\n\nexport default class OrderedList extends Node {\n  get name() {\n    return \"ordered_list\";\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        order: {\n          default: 1,\n        },\n      },\n      content: \"list_item+\",\n      group: \"block\",\n      parseDOM: [\n        {\n          tag: \"ol\",\n          getAttrs: (dom: HTMLOListElement) => ({\n            order: dom.hasAttribute(\"start\")\n              ? parseInt(dom.getAttribute(\"start\") || \"1\", 10)\n              : 1,\n          }),\n        },\n      ],\n      toDOM: node =>\n        node.attrs.order === 1\n          ? [\"ol\", 0]\n          : [\"ol\", { start: node.attrs.order }, 0],\n    };\n  }\n\n  commands({ type, schema }) {\n    return () => toggleList(type, schema.nodes.list_item);\n  }\n\n  keys({ type, schema }) {\n    return {\n      \"Shift-Ctrl-9\": toggleList(type, schema.nodes.list_item),\n    };\n  }\n\n  inputRules({ type }) {\n    return [\n      wrappingInputRule(\n        /^(\\d+)\\.\\s$/,\n        type,\n        match => ({ order: +match[1] }),\n        (match, node) => node.childCount + node.attrs.order === +match[1]\n      ),\n    ];\n  }\n\n  toMarkdown(state, node) {\n    const start = node.attrs.order || 1;\n    const maxW = `${start + node.childCount - 1}`.length;\n    const space = state.repeat(\" \", maxW + 2);\n\n    state.renderList(node, space, i => {\n      const nStr = `${start + i}`;\n      return state.repeat(\" \", maxW - nStr.length) + nStr + \". \";\n    });\n  }\n\n  parseMarkdown() {\n    return { block: \"ordered_list\" };\n  }\n}\n","import { Plugin } from \"prosemirror-state\";\nimport copy from \"copy-to-clipboard\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\nimport { textblockTypeInputRule } from \"prosemirror-inputrules\";\nimport { setBlockType } from \"prosemirror-commands\";\nimport backspaceToParagraph from \"../commands/backspaceToParagraph\";\nimport headingToSlug from \"../lib/headingToSlug\";\nimport Node from \"./Node\";\n\nexport default class Paragraph extends Node {\n  className = \"normal-text\";\n\n  get name() {\n    return \"paragraph\";\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        level: {\n          default: 1,\n        },\n      },\n      content: \"inline*\",\n      group: \"block\",\n      defining: true,\n      draggable: true,\n      parseDOM: [{ tag: \"h4\" }],\n      toDOM: () => [\"h4\",0]\n  }\n}\n\n  \n\n  toMarkdown(state, node) {\n    // render empty paragraphs as hard breaks to ensure that newlines are\n    // persisted between reloads (this breaks from markdown tradition)\n    if (\n      node.textContent.trim() === \"\" &&\n      node.childCount === 0 &&\n      !state.inTable\n    ) {\n      state.write(\"\\\\\\n\");\n    } else {\n      state.renderInline(node);\n      state.closeBlock(node);\n    }\n  }\n \n keys({ type }) {\n    return {\n      \"Shift-Ctrl-0\": setBlockType(type),\n    };\n  }\n\n  commands({ type }) {\n    return () => setBlockType(type);\n  }\n\n  parseMarkdown() {\n    return { block: \"paragraph\" };\n  }\n\n  get plugins() {\n    const getAnchors = doc => {\n      const decorations: Decoration[] = [];\n      const previouslySeen = {};\n\n      doc.descendants((node, pos) => {\n        if (node.type.name !== this.name) return;\n\n        // calculate the optimal id\n        const slug = headingToSlug(node);\n        let id = slug;\n\n        // check if we've already used it, and if so how many times?\n        // Make the new id based on that number ensuring that we have\n        // unique ID's even when headings are identical\n        if (previouslySeen[slug] > 0) {\n          id = headingToSlug(node, previouslySeen[slug]);\n        }\n\n        // record that we've seen this slug for the next loop\n        previouslySeen[slug] =\n          previouslySeen[slug] !== undefined ? previouslySeen[slug] + 1 : 1;\n\n        decorations.push(\n          Decoration.widget(\n            pos,\n            () => {\n              const anchor = document.createElement(\"a\");\n              anchor.id = id;\n              anchor.className = this.className;\n              return anchor;\n            },\n            {\n              side: -1,\n              key: id,\n            }\n          )\n        );\n      });\n\n      return DecorationSet.create(doc, decorations);\n    };\n\n    const plugin = new Plugin({\n      state: {\n        init: (config, state) => {\n          return getAnchors(state.doc);\n        },\n        apply: (tr, oldState) => {\n          return tr.docChanged ? getAnchors(tr.doc) : oldState;\n        },\n      },\n      props: {\n        decorations: state => plugin.getState(state),\n      },\n    });\n\n    return [plugin];\n  }\n\n}\n","import Node from \"./Node\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\nimport {\n  addColumnAfter,\n  addColumnBefore,\n  deleteColumn,\n  deleteRow,\n  deleteTable,\n  fixTables,\n  goToNextCell,\n  isInTable,\n  setCellAttr,\n  tableEditing,\n  toggleHeaderCell,\n  toggleHeaderColumn,\n  toggleHeaderRow,\n} from \"prosemirror-tables\";\nimport {\n  addRowAt,\n  createTable,\n  getCellsInColumn,\n  moveRow,\n} from \"prosemirror-utils\";\nimport { Plugin, TextSelection } from \"prosemirror-state\";\n\nexport default class Table extends Node {\n  get name() {\n    return \"table\";\n  }\n\n  get schema() {\n    return {\n      content: \"tr+\",\n      tableRole: \"table\",\n      isolating: true,\n      draggable: true,\n      group: \"block\",\n      parseDOM: [{ tag: \"table\" }],\n      toDOM() {\n        return [\n          \"div\",\n          { class: \"scrollable-wrapper\" },\n          [\n            \"div\",\n            { class: \"scrollable\" },\n            [\"table\", { class: \"rme-table\" }, [\"tbody\", 0]],\n          ],\n        ];\n      },\n    };\n  }\n\n  commands({ schema }) {\n    return {\n      createTable: ({ rowsCount, colsCount }) => (state, dispatch) => {\n        const offset = state.tr.selection.anchor + 1;\n        const nodes = createTable(schema, rowsCount, colsCount);\n        const tr = state.tr.replaceSelectionWith(nodes).scrollIntoView();\n        const resolvedPos = tr.doc.resolve(offset);\n\n        tr.setSelection(TextSelection.near(resolvedPos));\n        dispatch(tr);\n      },\n      setColumnAttr: ({ index, alignment }) => (state, dispatch) => {\n        const cells = getCellsInColumn(index)(state.selection) || [];\n        let transaction = state.tr;\n        cells.forEach(({ pos }) => {\n          transaction = transaction.setNodeMarkup(pos, null, {\n            alignment,\n          });\n        });\n        dispatch(transaction);\n      },\n      addColumnBefore: () => addColumnBefore,\n      addColumnAfter: () => addColumnAfter,\n      deleteColumn: () => deleteColumn,\n      addRowAfter: ({ index }) => (state, dispatch) => {\n        if (index === 0) {\n          // A little hack to avoid cloning the heading row by cloning the row\n          // beneath and then moving it to the right index.\n          const tr = addRowAt(index + 2, true)(state.tr);\n          dispatch(moveRow(index + 2, index + 1)(tr));\n        } else {\n          dispatch(addRowAt(index + 1, true)(state.tr));\n        }\n      },\n      deleteRow: () => deleteRow,\n      deleteTable: () => deleteTable,\n      toggleHeaderColumn: () => toggleHeaderColumn,\n      toggleHeaderRow: () => toggleHeaderRow,\n      toggleHeaderCell: () => toggleHeaderCell,\n      setCellAttr: () => setCellAttr,\n      fixTables: () => fixTables,\n    };\n  }\n\n  keys() {\n    return {\n      Tab: goToNextCell(1),\n      \"Shift-Tab\": goToNextCell(-1),\n      Enter: (state, dispatch) => {\n        if (!isInTable(state)) return false;\n\n        // TODO: Adding row at the end for now, can we find the current cell\n        // row index and add the row below that?\n        const cells = getCellsInColumn(0)(state.selection) || [];\n\n        dispatch(addRowAt(cells.length, true)(state.tr));\n        return true;\n      },\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.renderTable(node);\n    state.closeBlock(node);\n  }\n\n  parseMarkdown() {\n    return { block: \"table\" };\n  }\n\n  get plugins() {\n    return [\n      tableEditing(),\n      new Plugin({\n        props: {\n          decorations: state => {\n            const { doc } = state;\n            const decorations: Decoration[] = [];\n            let index = 0;\n\n            doc.descendants((node, pos) => {\n              if (node.type.name !== this.name) return;\n\n              const elements = document.getElementsByClassName(\"rme-table\");\n              const table = elements[index];\n              if (!table) return;\n\n              const element = table.parentElement;\n              const shadowRight = !!(\n                element && element.scrollWidth > element.clientWidth\n              );\n\n              if (shadowRight) {\n                decorations.push(\n                  Decoration.widget(pos + 1, () => {\n                    const shadow = document.createElement(\"div\");\n                    shadow.className = \"scrollable-shadow right\";\n                    return shadow;\n                  })\n                );\n              }\n              index++;\n            });\n\n            return DecorationSet.create(doc, decorations);\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { DecorationSet, Decoration } from \"prosemirror-view\";\nimport { Plugin } from \"prosemirror-state\";\nimport {\n  isTableSelected,\n  isRowSelected,\n  getCellsInColumn,\n} from \"prosemirror-utils\";\nimport Node from \"./Node\";\n\nexport default class TableCell extends Node {\n  get name() {\n    return \"td\";\n  }\n\n  get schema() {\n    return {\n      content: \"paragraph+\",\n      tableRole: \"cell\",\n      isolating: true,\n      parseDOM: [{ tag: \"td\" }],\n      toDOM(node) {\n        return [\n          \"td\",\n          node.attrs.alignment\n            ? { style: `text-align: ${node.attrs.alignment}` }\n            : {},\n          0,\n        ];\n      },\n      attrs: {\n        colspan: { default: 1 },\n        rowspan: { default: 1 },\n        alignment: { default: null },\n      },\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.renderContent(node);\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"td\",\n      getAttrs: tok => ({ alignment: tok.info }),\n    };\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          decorations: state => {\n            const { doc, selection } = state;\n            const decorations: Decoration[] = [];\n            const cells = getCellsInColumn(0)(selection);\n\n            if (cells) {\n              cells.forEach(({ pos }, index) => {\n                if (index === 0) {\n                  decorations.push(\n                    Decoration.widget(pos + 1, () => {\n                      let className = \"grip-table\";\n                      const selected = isTableSelected(selection);\n                      if (selected) {\n                        className += \" selected\";\n                      }\n                      const grip = document.createElement(\"a\");\n                      grip.className = className;\n                      grip.addEventListener(\"mousedown\", event => {\n                        event.preventDefault();\n                        this.options.onSelectTable(state);\n                      });\n                      return grip;\n                    })\n                  );\n                }\n                decorations.push(\n                  Decoration.widget(pos + 1, () => {\n                    const rowSelected = isRowSelected(index)(selection);\n\n                    let className = \"grip-row\";\n                    if (rowSelected) {\n                      className += \" selected\";\n                    }\n                    if (index === 0) {\n                      className += \" first\";\n                    } else if (index === cells.length - 1) {\n                      className += \" last\";\n                    }\n                    const grip = document.createElement(\"a\");\n                    grip.className = className;\n                    grip.addEventListener(\"mousedown\", event => {\n                      event.preventDefault();\n                      this.options.onSelectRow(index, state);\n                    });\n                    return grip;\n                  })\n                );\n              });\n            }\n\n            return DecorationSet.create(doc, decorations);\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { DecorationSet, Decoration } from \"prosemirror-view\";\nimport { Plugin } from \"prosemirror-state\";\nimport { isColumnSelected, getCellsInRow } from \"prosemirror-utils\";\nimport Node from \"./Node\";\n\nexport default class TableHeadCell extends Node {\n  get name() {\n    return \"th\";\n  }\n\n  get schema() {\n    return {\n      content: \"paragraph+\",\n      tableRole: \"header_cell\",\n      isolating: true,\n      parseDOM: [{ tag: \"th\" }],\n      toDOM(node) {\n        return [\n          \"th\",\n          node.attrs.alignment\n            ? { style: `text-align: ${node.attrs.alignment}` }\n            : {},\n          0,\n        ];\n      },\n      attrs: {\n        colspan: { default: 1 },\n        rowspan: { default: 1 },\n        alignment: { default: null },\n      },\n    };\n  }\n\n  toMarkdown(state, node) {\n    state.renderContent(node);\n  }\n\n  parseMarkdown() {\n    return {\n      block: \"th\",\n      getAttrs: tok => ({ alignment: tok.info }),\n    };\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          decorations: state => {\n            const { doc, selection } = state;\n            const decorations: Decoration[] = [];\n            const cells = getCellsInRow(0)(selection);\n\n            if (cells) {\n              cells.forEach(({ pos }, index) => {\n                decorations.push(\n                  Decoration.widget(pos + 1, () => {\n                    const colSelected = isColumnSelected(index)(selection);\n                    let className = \"grip-column\";\n                    if (colSelected) {\n                      className += \" selected\";\n                    }\n                    if (index === 0) {\n                      className += \" first\";\n                    } else if (index === cells.length - 1) {\n                      className += \" last\";\n                    }\n                    const grip = document.createElement(\"a\");\n                    grip.className = className;\n                    grip.addEventListener(\"mousedown\", event => {\n                      event.preventDefault();\n                      this.options.onSelectColumn(index, state);\n                    });\n                    return grip;\n                  })\n                );\n              });\n            }\n\n            return DecorationSet.create(doc, decorations);\n          },\n        },\n      }),\n    ];\n  }\n}\n","import Node from \"./Node\";\n\nexport default class TableRow extends Node {\n  get name() {\n    return \"tr\";\n  }\n\n  get schema() {\n    return {\n      content: \"(th | td)*\",\n      tableRole: \"row\",\n      parseDOM: [{ tag: \"tr\" }],\n      toDOM() {\n        return [\"tr\", 0];\n      },\n    };\n  }\n\n  parseMarkdown() {\n    return { block: \"tr\" };\n  }\n}\n","import { MarkType, Mark } from \"prosemirror-model\";\nimport { InputRule } from \"prosemirror-inputrules\";\nimport { EditorState } from \"prosemirror-state\";\n\nfunction getMarksBetween(start: number, end: number, state: EditorState) {\n  let marks: { start: number; end: number; mark: Mark }[] = [];\n\n  state.doc.nodesBetween(start, end, (node, pos) => {\n    marks = [\n      ...marks,\n      ...node.marks.map(mark => ({\n        start: pos,\n        end: pos + node.nodeSize,\n        mark,\n      })),\n    ];\n  });\n\n  return marks;\n}\n\nexport default function(\n  regexp: RegExp,\n  markType: MarkType,\n  getAttrs?: (match) => Record<string, unknown>\n): InputRule {\n  return new InputRule(\n    regexp,\n    (state: EditorState, match: string[], start: number, end: number) => {\n      const attrs = getAttrs instanceof Function ? getAttrs(match) : getAttrs;\n      const { tr } = state;\n      const m = match.length - 1;\n      let markEnd = end;\n      let markStart = start;\n\n      if (match[m]) {\n        const matchStart = start + match[0].indexOf(match[m - 1]);\n        const matchEnd = matchStart + match[m - 1].length - 1;\n        const textStart = matchStart + match[m - 1].lastIndexOf(match[m]);\n        const textEnd = textStart + match[m].length;\n\n        const excludedMarks = getMarksBetween(start, end, state)\n          .filter(item => item.mark.type.excludes(markType))\n          .filter(item => item.end > matchStart);\n\n        if (excludedMarks.length) {\n          return null;\n        }\n\n        if (textEnd < matchEnd) {\n          tr.delete(textEnd, matchEnd);\n        }\n        if (textStart > matchStart) {\n          tr.delete(matchStart, textStart);\n        }\n        markStart = matchStart;\n        markEnd = markStart + match[m].length;\n      }\n\n      tr.addMark(markStart, markEnd, markType.create(attrs));\n      tr.removeStoredMark(markType);\n      return tr;\n    }\n  );\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport Extension from \"../lib/Extension\";\n\nexport default abstract class Mark extends Extension {\n  get type() {\n    return \"mark\";\n  }\n\n  abstract get schema();\n\n  get markdownToken(): string {\n    return \"\";\n  }\n\n  get toMarkdown(): Record<string, any> {\n    return {};\n  }\n\n  parseMarkdown() {\n    return {};\n  }\n\n  commands({ type }) {\n    return () => toggleMark(type);\n  }\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport markInputRule from \"../lib/markInputRule\";\nimport Mark from \"./Mark\";\n\nexport default class Bold extends Mark {\n  get name() {\n    return \"strong\";\n  }\n\n  get schema() {\n    return {\n      parseDOM: [\n        { tag: \"b\" },\n        { tag: \"strong\" },\n        { style: \"font-style\", getAttrs: value => value === \"bold\" },\n      ],\n      toDOM: () => [\"strong\"],\n    };\n  }\n\n  inputRules({ type }) {\n    return [markInputRule(/(?:\\*\\*)([^*]+)(?:\\*\\*)$/, type)];\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-b\": toggleMark(type),\n      \"Mod-B\": toggleMark(type),\n    };\n  }\n\n  get toMarkdown() {\n    return {\n      open: \"**\",\n      close: \"**\",\n      mixable: true,\n      expelEnclosingWhitespace: true,\n    };\n  }\n\n  parseMarkdown() {\n    return { mark: \"strong\" };\n  }\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport markInputRule from \"../lib/markInputRule\";\nimport Mark from \"./Mark\";\n\nfunction backticksFor(node, side) {\n  const ticks = /`+/g;\n  let match: RegExpMatchArray | null;\n  let len = 0;\n\n  if (node.isText) {\n    while ((match = ticks.exec(node.text))) {\n      len = Math.max(len, match[0].length);\n    }\n  }\n\n  let result = len > 0 && side > 0 ? \" `\" : \"`\";\n  for (let i = 0; i < len; i++) {\n    result += \"`\";\n  }\n  if (len > 0 && side < 0) {\n    result += \" \";\n  }\n  return result;\n}\n\nexport default class Code extends Mark {\n  get name() {\n    return \"code_inline\";\n  }\n\n  get schema() {\n    return {\n      excludes: \"_\",\n      parseDOM: [{ tag: \"code\" }],\n      toDOM: () => [\"code\", { spellCheck: false }],\n    };\n  }\n\n  inputRules({ type }) {\n    return [markInputRule(/(?:^|[^`])(`([^`]+)`)$/, type)];\n  }\n\n  keys({ type }) {\n    // Note: This key binding only works on non-Mac platforms\n    // https://github.com/ProseMirror/prosemirror/issues/515\n    return {\n      \"Mod`\": toggleMark(type),\n    };\n  }\n\n  get toMarkdown() {\n    return {\n      open(_state, _mark, parent, index) {\n        return backticksFor(parent.child(index), -1);\n      },\n      close(_state, _mark, parent, index) {\n        return backticksFor(parent.child(index - 1), 1);\n      },\n      escape: false,\n    };\n  }\n\n  parseMarkdown() {\n    return { mark: \"code_inline\" };\n  }\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport markInputRule from \"../lib/markInputRule\";\nimport Mark from \"./Mark\";\n\nexport default class Highlight extends Mark {\n  get name() {\n    return \"highlight\";\n  }\n\n  get schema() {\n    return {\n      parseDOM: [{ tag: \"mark\" }],\n      toDOM: () => [\"mark\"],\n    };\n  }\n\n  inputRules({ type }) {\n    return [markInputRule(/(?:==)([^=]+)(?:==)$/, type)];\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-Ctrl-h\": toggleMark(type),\n    };\n  }\n\n  get toMarkdown() {\n    return {\n      open: \"==\",\n      close: \"==\",\n      mixable: true,\n      expelEnclosingWhitespace: true,\n    };\n  }\n\n  parseMarkdown() {\n    return { mark: \"highlight\" };\n  }\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport markInputRule from \"../lib/markInputRule\";\nimport Mark from \"./Mark\";\n\nexport default class Italic extends Mark {\n  get name() {\n    return \"em\";\n  }\n\n  get schema() {\n    return {\n      parseDOM: [\n        { tag: \"i\" },\n        { tag: \"em\" },\n        { style: \"font-style\", getAttrs: value => value === \"italic\" },\n      ],\n      toDOM: () => [\"em\"],\n    };\n  }\n\n  inputRules({ type }) {\n    return [\n      markInputRule(/(?:^|[^_])(_([^_]+)_)$/, type),\n      markInputRule(/(?:^|[^*])(\\*([^*]+)\\*)$/, type),\n    ];\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-i\": toggleMark(type),\n      \"Mod-I\": toggleMark(type),\n    };\n  }\n\n  get toMarkdown() {\n    return {\n      open: \"*\",\n      close: \"*\",\n      mixable: true,\n      expelEnclosingWhitespace: true,\n    };\n  }\n\n  parseMarkdown() {\n    return { mark: \"em\" };\n  }\n}\n","const SSR = typeof window === \"undefined\";\nconst isMac = !SSR && window.navigator.platform === \"MacIntel\";\n\nexport default function isModKey(event: KeyboardEvent): boolean {\n  return isMac ? event.metaKey : event.ctrlKey;\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Plugin } from \"prosemirror-state\";\nimport { InputRule } from \"prosemirror-inputrules\";\nimport Mark from \"./Mark\";\nimport isModKey from \"../lib/isModKey\";\n\nconst LINK_INPUT_REGEX = /\\[(.+)]\\((\\S+)\\)/;\n\nfunction isPlainURL(link, parent, index, side) {\n  if (link.attrs.title || !/^\\w+:/.test(link.attrs.href)) {\n    return false;\n  }\n\n  const content = parent.child(index + (side < 0 ? -1 : 0));\n  if (\n    !content.isText ||\n    content.text !== link.attrs.href ||\n    content.marks[content.marks.length - 1] !== link\n  ) {\n    return false;\n  }\n\n  if (index === (side < 0 ? 1 : parent.childCount - 1)) {\n    return true;\n  }\n\n  const next = parent.child(index + (side < 0 ? -2 : 1));\n  return !link.isInSet(next.marks);\n}\n\nexport default class Link extends Mark {\n  get name() {\n    return \"link\";\n  }\n\n  get schema() {\n    return {\n      attrs: {\n        href: {\n          default: \"\",\n        },\n      },\n      inclusive: false,\n      parseDOM: [\n        {\n          tag: \"a[href]\",\n          getAttrs: (dom: HTMLElement) => ({\n            href: dom.getAttribute(\"href\"),\n          }),\n        },\n      ],\n      toDOM: node => [\n        \"a\",\n        {\n          ...node.attrs,\n          rel: \"noopener noreferrer nofollow\",\n        },\n        0,\n      ],\n    };\n  }\n\n  inputRules({ type }) {\n    return [\n      new InputRule(LINK_INPUT_REGEX, (state, match, start, end) => {\n        const [okay, alt, href] = match;\n        const { tr } = state;\n\n        if (okay) {\n          tr.replaceWith(start, end, this.editor.schema.text(alt)).addMark(\n            start,\n            start + alt.length,\n            type.create({ href })\n          );\n        }\n\n        return tr;\n      }),\n    ];\n  }\n\n  commands({ type }) {\n    return ({ href } = { href: \"\" }) => toggleMark(type, { href });\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-k\": (state, dispatch) => {\n        if (state.selection.empty) {\n          this.options.onKeyboardShortcut();\n          return true;\n        }\n\n        return toggleMark(type, { href: \"\" })(state, dispatch);\n      },\n    };\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          handleDOMEvents: {\n            mouseover: (view, event: MouseEvent) => {\n              if (\n                event.target instanceof HTMLAnchorElement &&\n                !event.target.className.includes(\"ProseMirror-widget\")\n              ) {\n                if (this.options.onHoverLink) {\n                  return this.options.onHoverLink(event);\n                }\n              }\n              return false;\n            },\n            click: (view, event: any) => {\n              // allow opening links in editing mode with the meta/cmd key\n              if (\n                view.props.editable &&\n                view.props.editable(view.state) &&\n                !isModKey(event)\n              ) {\n                return false;\n              }\n\n              if (event.target instanceof HTMLAnchorElement) {\n                const href =\n                  event.target.href ||\n                  (event.target.parentNode instanceof HTMLAnchorElement\n                    ? event.target.parentNode.href\n                    : \"\");\n\n                const isHashtag = href.startsWith(\"#\");\n                if (isHashtag && this.options.onClickHashtag) {\n                  event.stopPropagation();\n                  event.preventDefault();\n                  this.options.onClickHashtag(href, event);\n                  return true;\n                }\n\n                if (this.options.onClickLink) {\n                  event.stopPropagation();\n                  event.preventDefault();\n                  this.options.onClickLink(href, event);\n                  return true;\n                }\n              }\n\n              return false;\n            },\n          },\n        },\n      }),\n    ];\n  }\n\n  get toMarkdown() {\n    return {\n      open(_state, mark, parent, index) {\n        return isPlainURL(mark, parent, index, 1) ? \"<\" : \"[\";\n      },\n      close(state, mark, parent, index) {\n        return isPlainURL(mark, parent, index, -1)\n          ? \">\"\n          : \"](\" +\n              state.esc(mark.attrs.href) +\n              (mark.attrs.title ? \" \" + state.quote(mark.attrs.title) : \"\") +\n              \")\";\n      },\n    };\n  }\n\n  parseMarkdown() {\n    return {\n      mark: \"link\",\n      getAttrs: tok => ({\n        href: tok.attrGet(\"href\"),\n        title: tok.attrGet(\"title\") || null,\n      }),\n    };\n  }\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport markInputRule from \"../lib/markInputRule\";\nimport Mark from \"./Mark\";\n\nexport default class Strikethrough extends Mark {\n  get name() {\n    return \"strikethrough\";\n  }\n\n  get schema() {\n    return {\n      parseDOM: [\n        {\n          tag: \"s\",\n        },\n        {\n          tag: \"del\",\n        },\n        {\n          tag: \"strike\",\n        },\n      ],\n      toDOM: () => [\"del\", 0],\n    };\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-d\": toggleMark(type),\n    };\n  }\n\n  inputRules({ type }) {\n    return [markInputRule(/~([^~]+)~$/, type)];\n  }\n\n  get toMarkdown() {\n    return {\n      open: \"~~\",\n      close: \"~~\",\n      mixable: true,\n      expelEnclosingWhitespace: true,\n    };\n  }\n\n  get markdownToken() {\n    return \"s\";\n  }\n\n  parseMarkdown() {\n    return { mark: \"strikethrough\" };\n  }\n}\n","import { ResolvedPos, MarkType } from \"prosemirror-model\";\n\nexport default function getMarkRange($pos?: ResolvedPos, type?: MarkType) {\n  if (!$pos || !type) {\n    return false;\n  }\n\n  const start = $pos.parent.childAfter($pos.parentOffset);\n  if (!start.node) {\n    return false;\n  }\n\n  const mark = start.node.marks.find(mark => mark.type === type);\n  if (!mark) {\n    return false;\n  }\n\n  let startIndex = $pos.index();\n  let startPos = $pos.start() + start.offset;\n  let endIndex = startIndex + 1;\n  let endPos = startPos + start.node.nodeSize;\n\n  while (\n    startIndex > 0 &&\n    mark.isInSet($pos.parent.child(startIndex - 1).marks)\n  ) {\n    startIndex -= 1;\n    startPos -= $pos.parent.child(startIndex).nodeSize;\n  }\n\n  while (\n    endIndex < $pos.parent.childCount &&\n    mark.isInSet($pos.parent.child(endIndex).marks)\n  ) {\n    endPos += $pos.parent.child(endIndex).nodeSize;\n    endIndex += 1;\n  }\n\n  return { from: startPos, to: endPos, mark };\n}\n","import { Plugin, TextSelection } from \"prosemirror-state\";\nimport getMarkRange from \"../queries/getMarkRange\";\nimport Mark from \"./Mark\";\n\nexport default class Placeholder extends Mark {\n  get name() {\n    return \"placeholder\";\n  }\n\n  get schema() {\n    return {\n      parseDOM: [{ tag: \"span.template-placeholder\" }],\n      toDOM: () => [\"span\", { class: \"template-placeholder\" }],\n    };\n  }\n\n  get toMarkdown() {\n    return {\n      open: \"!!\",\n      close: \"!!\",\n      mixable: true,\n      expelEnclosingWhitespace: true,\n    };\n  }\n\n  parseMarkdown() {\n    return { mark: \"placeholder\" };\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          handleTextInput: (view, from, to, text) => {\n            if (this.editor.props.template) {\n              return false;\n            }\n\n            const { state, dispatch } = view;\n            const $from = state.doc.resolve(from);\n\n            const range = getMarkRange($from, state.schema.marks.placeholder);\n            if (!range) return false;\n\n            const selectionStart = Math.min(from, range.from);\n            const selectionEnd = Math.max(to, range.to);\n\n            dispatch(\n              state.tr\n                .removeMark(\n                  range.from,\n                  range.to,\n                  state.schema.marks.placeholder\n                )\n                .insertText(text, selectionStart, selectionEnd)\n            );\n\n            const $to = view.state.doc.resolve(selectionStart + text.length);\n            dispatch(view.state.tr.setSelection(TextSelection.near($to)));\n\n            return true;\n          },\n          handleKeyDown: (view, event: KeyboardEvent) => {\n            if (!view.props.editable || !view.props.editable(view.state)) {\n              return false;\n            }\n            if (this.editor.props.template) {\n              return false;\n            }\n            if (\n              event.key !== \"ArrowLeft\" &&\n              event.key !== \"ArrowRight\" &&\n              event.key !== \"Backspace\"\n            ) {\n              return false;\n            }\n\n            const { state, dispatch } = view;\n\n            if (event.key === \"Backspace\") {\n              const range = getMarkRange(\n                state.doc.resolve(Math.max(0, state.selection.from - 1)),\n                state.schema.marks.placeholder\n              );\n              if (!range) return false;\n\n              dispatch(\n                state.tr\n                  .removeMark(\n                    range.from,\n                    range.to,\n                    state.schema.marks.placeholder\n                  )\n                  .insertText(\"\", range.from, range.to)\n              );\n              return true;\n            }\n\n            if (event.key === \"ArrowLeft\") {\n              const range = getMarkRange(\n                state.doc.resolve(Math.max(0, state.selection.from - 1)),\n                state.schema.marks.placeholder\n              );\n              if (!range) return false;\n\n              const startOfMark = state.doc.resolve(range.from);\n              dispatch(state.tr.setSelection(TextSelection.near(startOfMark)));\n              return true;\n            }\n\n            if (event.key === \"ArrowRight\") {\n              const range = getMarkRange(\n                state.selection.$from,\n                state.schema.marks.placeholder\n              );\n              if (!range) return false;\n\n              const endOfMark = state.doc.resolve(range.to);\n              dispatch(state.tr.setSelection(TextSelection.near(endOfMark)));\n              return true;\n            }\n\n            return false;\n          },\n          handleClick: (view, pos, event: MouseEvent) => {\n            if (!view.props.editable || !view.props.editable(view.state)) {\n              return false;\n            }\n            if (this.editor.props.template) {\n              return false;\n            }\n\n            if (\n              event.target instanceof HTMLSpanElement &&\n              event.target.className.includes(\"template-placeholder\")\n            ) {\n              const { state, dispatch } = view;\n              const range = getMarkRange(\n                state.selection.$from,\n                state.schema.marks.placeholder\n              );\n              if (!range) return false;\n\n              event.stopPropagation();\n              event.preventDefault();\n              const startOfMark = state.doc.resolve(range.from);\n              dispatch(state.tr.setSelection(TextSelection.near(startOfMark)));\n\n              return true;\n            }\n            return false;\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { toggleMark } from \"prosemirror-commands\";\nimport markInputRule from \"../lib/markInputRule\";\nimport Mark from \"./Mark\";\n\nexport default class Underline extends Mark {\n  get name() {\n    return \"underline\";\n  }\n\n  get schema() {\n    return {\n      parseDOM: [\n        { tag: \"u\" },\n        {\n          style: \"text-decoration\",\n          getAttrs: value => value === \"underline\",\n        },\n      ],\n      toDOM: () => [\"u\", 0],\n    };\n  }\n\n  inputRules({ type }) {\n    return [markInputRule(/(?:__)([^_]+)(?:__)$/, type)];\n  }\n\n  keys({ type }) {\n    return {\n      \"Mod-u\": toggleMark(type),\n    };\n  }\n\n  get toMarkdown() {\n    return {\n      open: \"__\",\n      close: \"__\",\n      mixable: true,\n      expelEnclosingWhitespace: true,\n    };\n  }\n\n  parseMarkdown() {\n    return { mark: \"underline\" };\n  }\n}\n","import { InputRule } from \"prosemirror-inputrules\";\nimport ReactDOM from \"react-dom\";\nimport * as React from \"react\";\nimport { Plugin } from \"prosemirror-state\";\nimport { isInTable } from \"prosemirror-tables\";\nimport { findParentNode } from \"prosemirror-utils\";\nimport { PlusIcon } from \"outline-icons\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\nimport Extension from \"../lib/Extension\";\n\nconst MAX_MATCH = 500;\nconst OPEN_REGEX = /^\\/(\\w+)?$/;\nconst CLOSE_REGEX = /(^(?!\\/(\\w+)?)(.*)$|^\\/((\\w+)\\s.*|\\s)$)/;\n\n// based on the input rules code in Prosemirror, here:\n// https://github.com/ProseMirror/prosemirror-inputrules/blob/master/src/inputrules.js\nfunction run(view, from, to, regex, handler) {\n  if (view.composing) {\n    return false;\n  }\n  const state = view.state;\n  const $from = state.doc.resolve(from);\n  if ($from.parent.type.spec.code) {\n    return false;\n  }\n\n  const textBefore = $from.parent.textBetween(\n    Math.max(0, $from.parentOffset - MAX_MATCH),\n    $from.parentOffset,\n    null,\n    \"\\ufffc\"\n  );\n\n  const match = regex.exec(textBefore);\n  const tr = handler(state, match, match ? from - match[0].length : from, to);\n  if (!tr) return false;\n  return true;\n}\n\nexport default class BlockMenuTrigger extends Extension {\n  get name() {\n    return \"blockmenu\";\n  }\n\n  get plugins() {\n    const button = document.createElement(\"button\");\n    button.className = \"block-menu-trigger\";\n    button.type = \"button\";\n    ReactDOM.render(<PlusIcon fill=\"currentColor\" />, button);\n\n    return [\n      new Plugin({\n        props: {\n          handleClick: () => {\n            this.options.onClose();\n            return false;\n          },\n          handleKeyDown: (view, event) => {\n            // Prosemirror input rules are not triggered on backspace, however\n            // we need them to be evaluted for the filter trigger to work\n            // correctly. This additional handler adds inputrules-like handling.\n            if (event.key === \"Backspace\") {\n              // timeout ensures that the delete has been handled by prosemirror\n              // and any characters removed, before we evaluate the rule.\n              setTimeout(() => {\n                const { pos } = view.state.selection.$from;\n                return run(view, pos, pos, OPEN_REGEX, (state, match) => {\n                  if (match) {\n                    this.options.onOpen(match[1]);\n                  } else {\n                    this.options.onClose();\n                  }\n                  return null;\n                });\n              });\n            }\n\n            // If the query is active and we're navigating the block menu then\n            // just ignore the key events in the editor itself until we're done\n            if (\n              event.key === \"Enter\" ||\n              event.key === \"ArrowUp\" ||\n              event.key === \"ArrowDown\" ||\n              event.key === \"Tab\"\n            ) {\n              const { pos } = view.state.selection.$from;\n\n              return run(view, pos, pos, OPEN_REGEX, (state, match) => {\n                // just tell Prosemirror we handled it and not to do anything\n                return match ? true : null;\n              });\n            }\n\n            return false;\n          },\n          decorations: state => {\n            const parent = findParentNode(\n              node => node.type.name === \"paragraph\"\n            )(state.selection);\n\n            if (!parent) {\n              return;\n            }\n\n            const decorations: Decoration[] = [];\n            const isEmpty = parent && parent.node.content.size === 0;\n            const isSlash = parent && parent.node.textContent === \"/\";\n            const isTopLevel = state.selection.$from.depth === 1;\n\n            if (isTopLevel) {\n              if (isEmpty) {\n                decorations.push(\n                  Decoration.widget(parent.pos, () => {\n                    button.addEventListener(\"click\", () => {\n                      this.options.onOpen(\"\");\n                    });\n                    return button;\n                  })\n                );\n\n                decorations.push(\n                  Decoration.node(\n                    parent.pos,\n                    parent.pos + parent.node.nodeSize,\n                    {\n                      class: \"placeholder\",\n                      \"data-empty-text\": this.options.dictionary.newLineEmpty,\n                    }\n                  )\n                );\n              }\n\n              if (isSlash) {\n                decorations.push(\n                  Decoration.node(\n                    parent.pos,\n                    parent.pos + parent.node.nodeSize,\n                    {\n                      class: \"placeholder\",\n                      \"data-empty-text\": `  ${this.options.dictionary.newLineWithSlash}`,\n                    }\n                  )\n                );\n              }\n\n              return DecorationSet.create(state.doc, decorations);\n            }\n\n            return;\n          },\n        },\n      }),\n    ];\n  }\n\n  inputRules() {\n    return [\n      // main regex should match only:\n      // /word\n      new InputRule(OPEN_REGEX, (state, match) => {\n        if (\n          match &&\n          state.selection.$from.parent.type.name === \"paragraph\" &&\n          !isInTable(state)\n        ) {\n          this.options.onOpen(match[1]);\n        }\n        return null;\n      }),\n      // invert regex should match some of these scenarios:\n      // /<space>word\n      // /<space>\n      // /word<space>\n      new InputRule(CLOSE_REGEX, (state, match) => {\n        if (match) {\n          this.options.onClose();\n        }\n        return null;\n      }),\n    ];\n  }\n}\n","import { undoInputRule } from \"prosemirror-inputrules\";\nimport { history, undo, redo } from \"prosemirror-history\";\nimport Extension from \"../lib/Extension\";\n\nexport default class History extends Extension {\n  get name() {\n    return \"history\";\n  }\n\n  keys() {\n    return {\n      \"Mod-z\": undo,\n      \"Mod-y\": redo,\n      \"Shift-Mod-z\": redo,\n      Backspace: undoInputRule,\n    };\n  }\n\n  get plugins() {\n    return [history()];\n  }\n}\n","import { Plugin, Selection, AllSelection } from \"prosemirror-state\";\nimport Extension from \"../lib/Extension\";\nimport isModKey from \"../lib/isModKey\";\nexport default class Keys extends Extension {\n  get name() {\n    return \"keys\";\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          handleDOMEvents: {\n            blur: this.options.onBlur,\n            focus: this.options.onFocus,\n          },\n          // we can't use the keys bindings for this as we want to preventDefault\n          // on the original keyboard event when handled\n          handleKeyDown: (view, event) => {\n            if (view.state.selection instanceof AllSelection) {\n              if (event.key === \"ArrowUp\") {\n                const selection = Selection.atStart(view.state.doc);\n                view.dispatch(view.state.tr.setSelection(selection));\n                return true;\n              }\n              if (event.key === \"ArrowDown\") {\n                const selection = Selection.atEnd(view.state.doc);\n                view.dispatch(view.state.tr.setSelection(selection));\n                return true;\n              }\n            }\n\n            // All the following keys require mod to be down\n            if (!isModKey(event)) {\n              return false;\n            }\n\n            if (event.key === \"s\") {\n              event.preventDefault();\n              this.options.onSave();\n              return true;\n            }\n\n            if (event.key === \"Enter\") {\n              event.preventDefault();\n              this.options.onSaveAndExit();\n              return true;\n            }\n\n            if (event.key === \"Escape\") {\n              event.preventDefault();\n              this.options.onCancel();\n              return true;\n            }\n\n            return false;\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { Plugin, Transaction } from \"prosemirror-state\";\nimport Extension from \"../lib/Extension\";\n\nexport default class MaxLength extends Extension {\n  get name() {\n    return \"maxlength\";\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        filterTransaction: (tr: Transaction) => {\n          if (this.options.maxLength) {\n            const result = tr.doc && tr.doc.nodeSize > this.options.maxLength;\n            return !result;\n          }\n\n          return true;\n        },\n      }),\n    ];\n  }\n}\n","import { Plugin } from \"prosemirror-state\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\nimport Extension from \"../lib/Extension\";\n\nexport default class Placeholder extends Extension {\n  get name() {\n    return \"empty-placeholder\";\n  }\n\n  get defaultOptions() {\n    return {\n      emptyNodeClass: \"placeholder\",\n      placeholder: \"\",\n    };\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          decorations: state => {\n            const { doc } = state;\n            const decorations: Decoration[] = [];\n            const completelyEmpty =\n              doc.textContent === \"\" &&\n              doc.childCount <= 1 &&\n              doc.content.size <= 2;\n\n            doc.descendants((node, pos) => {\n              if (!completelyEmpty) {\n                return;\n              }\n              if (pos !== 0 || node.type.name !== \"paragraph\") {\n                return;\n              }\n\n              const decoration = Decoration.node(pos, pos + node.nodeSize, {\n                class: this.options.emptyNodeClass,\n                \"data-empty-text\": this.options.placeholder,\n              });\n              decorations.push(decoration);\n            });\n\n            return DecorationSet.create(doc, decorations);\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { ellipsis, smartQuotes, InputRule } from \"prosemirror-inputrules\";\nimport Extension from \"../lib/Extension\";\n\nconst rightArrow = new InputRule(/->$/, \"→\");\n\nexport default class SmartText extends Extension {\n  get name() {\n    return \"smart_text\";\n  }\n\n  inputRules() {\n    return [rightArrow, ellipsis, ...smartQuotes];\n  }\n}\n","import { Plugin, PluginKey } from \"prosemirror-state\";\nimport Extension from \"../lib/Extension\";\n\nexport default class TrailingNode extends Extension {\n  get name() {\n    return \"trailing_node\";\n  }\n\n  get defaultOptions() {\n    return {\n      node: \"paragraph\",\n      notAfter: [\"paragraph\", \"heading\"],\n    };\n  }\n\n  get plugins() {\n    const plugin = new PluginKey(this.name);\n    const disabledNodes = Object.entries(this.editor.schema.nodes)\n      .map(([, value]) => value)\n      .filter(node => this.options.notAfter.includes(node.name));\n\n    return [\n      new Plugin({\n        key: plugin,\n        view: () => ({\n          update: view => {\n            const { state } = view;\n            const insertNodeAtEnd = plugin.getState(state);\n\n            if (!insertNodeAtEnd) {\n              return;\n            }\n\n            const { doc, schema, tr } = state;\n            const type = schema.nodes[this.options.node];\n            const transaction = tr.insert(doc.content.size, type.create());\n            view.dispatch(transaction);\n          },\n        }),\n        state: {\n          init: (_, state) => {\n            const lastNode = state.tr.doc.lastChild;\n            return lastNode ? !disabledNodes.includes(lastNode.type) : false;\n          },\n          apply: (tr, value) => {\n            if (!tr.docChanged) {\n              return value;\n            }\n\n            const lastNode = tr.doc.lastChild;\n            return lastNode ? !disabledNodes.includes(lastNode.type) : false;\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { Plugin } from \"prosemirror-state\";\nimport { toggleMark } from \"prosemirror-commands\";\nimport Extension from \"../lib/Extension\";\nimport isUrl from \"../lib/isUrl\";\nimport isInCode from \"../queries/isInCode\";\n\nexport default class MarkdownPaste extends Extension {\n  get name() {\n    return \"markdown-paste\";\n  }\n\n  get plugins() {\n    return [\n      new Plugin({\n        props: {\n          handlePaste: (view, event: ClipboardEvent) => {\n            if (view.props.editable && !view.props.editable(view.state)) {\n              return false;\n            }\n            if (!event.clipboardData) return false;\n\n            const text = event.clipboardData.getData(\"text/plain\");\n            const html = event.clipboardData.getData(\"text/html\");\n            const { state, dispatch } = view;\n\n            // first check if the clipboard contents can be parsed as a single\n            // url, this is mainly for allowing pasted urls to become embeds\n            if (isUrl(text)) {\n              // just paste the link mark directly onto the selected text\n              if (!state.selection.empty) {\n                toggleMark(this.editor.schema.marks.link, { href: text })(\n                  state,\n                  dispatch\n                );\n                return true;\n              }\n\n              // Is this link embeddable? Create an embed!\n              const { embeds } = this.editor.props;\n\n              if (embeds) {\n                for (const embed of embeds) {\n                  const matches = embed.matcher(text);\n                  if (matches) {\n                    this.editor.commands.embed({\n                      href: text,\n                      component: embed.component,\n                      matches,\n                    });\n                    return true;\n                  }\n                }\n              }\n\n              // well, it's not an embed and there is no text selected – so just\n              // go ahead and insert the link directly\n              const transaction = view.state.tr\n                .insertText(text, state.selection.from, state.selection.to)\n                .addMark(\n                  state.selection.from,\n                  state.selection.to + text.length,\n                  state.schema.marks.link.create({ href: text })\n                );\n              view.dispatch(transaction);\n              return true;\n            }\n\n            // otherwise, if we have html on the clipboard that looks like it\n            // came from Prosemirror then use the default HTML parser behavior\n            if (text.length === 0 || (html && html.includes(\"data-pm-slice\"))) {\n              return false;\n            }\n\n            event.preventDefault();\n\n            // If the users selection is currently in a code block then paste\n            // as plain text, ignore all formatting.\n            if (isInCode(view.state)) {\n              view.dispatch(view.state.tr.insertText(text));\n              return true;\n            }\n\n            // If we've gotten this far then treat the plain text content of the\n            // clipboard as possible markdown and use the parser\n            const paste = this.editor.parser.parse(text);\n            const slice = paste.slice(0);\n\n            const transaction = view.state.tr.replaceSelection(slice);\n            view.dispatch(transaction);\n            return true;\n          },\n        },\n      }),\n    ];\n  }\n}\n","import { Schema } from \"prosemirror-model\";\nimport ExtensionManager from \"./lib/ExtensionManager\";\nimport render from \"./lib/renderToHtml\";\n\n// nodes\nimport Doc from \"./nodes/Doc\";\nimport Text from \"./nodes/Text\";\nimport Blockquote from \"./nodes/Blockquote\";\nimport BulletList from \"./nodes/BulletList\";\nimport CodeBlock from \"./nodes/CodeBlock\";\nimport CodeFence from \"./nodes/CodeFence\";\nimport CheckboxList from \"./nodes/CheckboxList\";\nimport CheckboxItem from \"./nodes/CheckboxItem\";\nimport Embed from \"./nodes/Embed\";\nimport HardBreak from \"./nodes/HardBreak\";\nimport Heading from \"./nodes/Heading\";\nimport HorizontalRule from \"./nodes/HorizontalRule\";\nimport Image from \"./nodes/Image\";\nimport ListItem from \"./nodes/ListItem\";\nimport Notice from \"./nodes/Notice\";\nimport OrderedList from \"./nodes/OrderedList\";\nimport Paragraph from \"./nodes/Paragraph\";\nimport Table from \"./nodes/Table\";\nimport TableCell from \"./nodes/TableCell\";\nimport TableHeadCell from \"./nodes/TableHeadCell\";\nimport TableRow from \"./nodes/TableRow\";\n\n// marks\nimport Bold from \"./marks/Bold\";\nimport Code from \"./marks/Code\";\nimport Highlight from \"./marks/Highlight\";\nimport Italic from \"./marks/Italic\";\nimport Link from \"./marks/Link\";\nimport Strikethrough from \"./marks/Strikethrough\";\nimport TemplatePlaceholder from \"./marks/Placeholder\";\nimport Underline from \"./marks/Underline\";\n\nconst extensions = new ExtensionManager([\n  new Doc(),\n  new Text(),\n  new HardBreak(),\n  new Paragraph(),\n  new Blockquote(),\n  new BulletList(),\n  new CodeBlock(),\n  new CodeFence(),\n  new CheckboxList(),\n  new CheckboxItem(),\n  new Embed(),\n  new ListItem(),\n  new Notice(),\n  new Heading(),\n  new HorizontalRule(),\n  new Image(),\n  new Table(),\n  new TableCell(),\n  new TableHeadCell(),\n  new TableRow(),\n  new Bold(),\n  new Code(),\n  new Highlight(),\n  new Italic(),\n  new Link(),\n  new Strikethrough(),\n  new TemplatePlaceholder(),\n  new Underline(),\n  new OrderedList(),\n]);\n\nexport const schema = new Schema({\n  nodes: extensions.nodes,\n  marks: extensions.marks,\n});\n\nexport const parser = extensions.parser({\n  schema,\n});\n\nexport const serializer = extensions.serializer();\n\nexport const renderToHtml = render;\n","/* global window File Promise */\nimport * as React from \"react\";\nimport memoize from \"lodash/memoize\";\nimport { EditorState, Selection, Plugin } from \"prosemirror-state\";\nimport { dropCursor } from \"prosemirror-dropcursor\";\nimport { gapCursor } from \"prosemirror-gapcursor\";\nimport { MarkdownParser, MarkdownSerializer } from \"prosemirror-markdown\";\nimport { EditorView } from \"prosemirror-view\";\nimport { Schema, NodeSpec, MarkSpec, Slice } from \"prosemirror-model\";\nimport { inputRules, InputRule } from \"prosemirror-inputrules\";\nimport { keymap } from \"prosemirror-keymap\";\nimport { baseKeymap } from \"prosemirror-commands\";\nimport { selectColumn, selectRow, selectTable } from \"prosemirror-utils\";\nimport styled, { ThemeProvider } from \"styled-components\";\nimport { light as lightTheme, dark as darkTheme } from \"./theme\";\nimport baseDictionary from \"./dictionary\";\nimport Flex from \"./components/Flex\";\nimport { SearchResult } from \"./components/LinkEditor\";\nimport { EmbedDescriptor, ToastType } from \"./types\";\nimport SelectionToolbar from \"./components/SelectionToolbar\";\nimport BlockMenu from \"./components/BlockMenu\";\nimport LinkToolbar from \"./components/LinkToolbar\";\nimport Tooltip from \"./components/Tooltip\";\nimport Extension from \"./lib/Extension\";\nimport ExtensionManager from \"./lib/ExtensionManager\";\nimport ComponentView from \"./lib/ComponentView\";\nimport headingToSlug from \"./lib/headingToSlug\";\n\n// nodes\nimport ReactNode from \"./nodes/ReactNode\";\nimport Doc from \"./nodes/Doc\";\nimport Text from \"./nodes/Text\";\nimport Blockquote from \"./nodes/Blockquote\";\nimport BulletList from \"./nodes/BulletList\";\nimport CodeBlock from \"./nodes/CodeBlock\";\nimport CodeFence from \"./nodes/CodeFence\";\nimport CheckboxList from \"./nodes/CheckboxList\";\nimport CheckboxItem from \"./nodes/CheckboxItem\";\nimport Embed from \"./nodes/Embed\";\nimport HardBreak from \"./nodes/HardBreak\";\nimport Heading from \"./nodes/Heading\";\nimport HorizontalRule from \"./nodes/HorizontalRule\";\nimport Image from \"./nodes/Image\";\nimport ListItem from \"./nodes/ListItem\";\nimport Notice from \"./nodes/Notice\";\nimport OrderedList from \"./nodes/OrderedList\";\nimport Paragraph from \"./nodes/Paragraph\";\nimport Table from \"./nodes/Table\";\nimport TableCell from \"./nodes/TableCell\";\nimport TableHeadCell from \"./nodes/TableHeadCell\";\nimport TableRow from \"./nodes/TableRow\";\n\n// marks\nimport Bold from \"./marks/Bold\";\nimport Code from \"./marks/Code\";\nimport Highlight from \"./marks/Highlight\";\nimport Italic from \"./marks/Italic\";\nimport Link from \"./marks/Link\";\nimport Strikethrough from \"./marks/Strikethrough\";\nimport TemplatePlaceholder from \"./marks/Placeholder\";\nimport Underline from \"./marks/Underline\";\n\n// plugins\nimport BlockMenuTrigger from \"./plugins/BlockMenuTrigger\";\nimport History from \"./plugins/History\";\nimport Keys from \"./plugins/Keys\";\nimport MaxLength from \"./plugins/MaxLength\";\nimport Placeholder from \"./plugins/Placeholder\";\nimport SmartText from \"./plugins/SmartText\";\nimport TrailingNode from \"./plugins/TrailingNode\";\nimport MarkdownPaste from \"./plugins/MarkdownPaste\";\n\nexport { schema, parser, serializer, renderToHtml } from \"./server\";\n\nexport { default as Extension } from \"./lib/Extension\";\n\nexport const theme = lightTheme;\n\nexport type Props = {\n  id?: string;\n  value?: string;\n  defaultValue: string;\n  placeholder: string;\n  extensions: Extension[];\n  autoFocus?: boolean;\n  readOnly?: boolean;\n  readOnlyWriteCheckboxes?: boolean;\n  dictionary?: Partial<typeof baseDictionary>;\n  dark?: boolean;\n  theme?: typeof theme;\n  template?: boolean;\n  headingsOffset?: number;\n  maxLength?: number;\n  scrollTo?: string;\n  handleDOMEvents?: {\n    [name: string]: (view: EditorView, event: Event) => boolean;\n  };\n  uploadImage?: (file: File) => Promise<string>;\n  onBlur?: () => void;\n  onFocus?: () => void;\n  onSave?: ({ done: boolean }) => void;\n  onCancel?: () => void;\n  onChange?: (value: () => string) => void;\n  onImageUploadStart?: () => void;\n  onImageUploadStop?: () => void;\n  onCreateLink?: (title: string) => Promise<string>;\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  onClickLink: (href: string, event: MouseEvent) => void;\n  onHoverLink?: (event: MouseEvent) => boolean;\n  onClickHashtag?: (tag: string, event: MouseEvent) => void;\n  onKeyDown?: (event: React.KeyboardEvent<HTMLDivElement>) => void;\n  embeds: EmbedDescriptor[];\n  onShowToast?: (message: string, code: ToastType) => void;\n  tooltip: typeof React.Component | React.FC<any>;\n  className?: string;\n  style?: Record<string, string>,\n  dragging?: {slice: Slice; move: boolean } | null ;\n};\n\ntype State = {\n  isEditorFocused: boolean;\n  selectionMenuOpen: boolean;\n  blockMenuOpen: boolean;\n  linkMenuOpen: boolean;\n  blockMenuSearch: string;\n};\n\ntype Step = {\n  slice?: Slice;\n};\n\nclass RichMarkdownEditor extends React.PureComponent<Props, State> {\n  static defaultProps = {\n    defaultValue: \"\",\n    placeholder: \"Write something nice…\",\n    onImageUploadStart: () => {\n      // no default behavior\n    },\n    onImageUploadStop: () => {\n      // no default behavior\n    },\n    onClickLink: (href) => {\n      window.open(href, \"_blank\");\n    },\n    embeds: [],\n    extensions: [],\n    tooltip: Tooltip,\n  };\n\n  state = {\n    isEditorFocused: false,\n    selectionMenuOpen: false,\n    blockMenuOpen: false,\n    linkMenuOpen: false,\n    blockMenuSearch: \"\",\n  };\n\n  isBlurred: boolean;\n  extensions: ExtensionManager;\n  element?: HTMLElement | null;\n  view: EditorView;\n  schema: Schema;\n  serializer: MarkdownSerializer;\n  parser: MarkdownParser;\n  plugins: Plugin[];\n  keymaps: Plugin[];\n  inputRules: InputRule[];\n  nodeViews: {\n    [name: string]: (node, view, getPos, decorations) => ComponentView;\n  };\n  nodes: { [name: string]: NodeSpec };\n  marks: { [name: string]: MarkSpec };\n  commands: Record<string, any>;\n\n  componentDidMount() {\n    this.init();\n    if (this.props.scrollTo) {\n      this.scrollToAnchor(this.props.scrollTo);\n    }\n\n    if (this.props.readOnly) return;\n\n    if (this.props.autoFocus) {\n      this.focusAtEnd();\n    }\n    //for making the element to drag only on dragging the icon\n    document?.addEventListener(\"dragstart\", this.resetDrag, true);\n  }\n\n  resetDrag(e) {\n    e.target.parentNode.setAttribute(\"draggable\", \"false\");\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    // Allow changes to the 'value' prop to update the editor from outside\n    if (this.props.value && prevProps.value !== this.props.value) {\n      const newState = this.createState(this.props.value);\n      this.view.updateState(newState);\n    }\n\n    // pass readOnly changes through to underlying editor instance\n    if (prevProps.readOnly !== this.props.readOnly) {\n      this.view.update({\n        ...this.view.props,\n        editable: () => !this.props.readOnly,\n      });\n    }\n\n    if (this.props.scrollTo && this.props.scrollTo !== prevProps.scrollTo) {\n      this.scrollToAnchor(this.props.scrollTo);\n    }\n\n    // Focus at the end of the document if switching from readOnly and autoFocus\n    // is set to true\n    if (prevProps.readOnly && !this.props.readOnly && this.props.autoFocus) {\n      this.focusAtEnd();\n    }\n\n    if (\n      !this.isBlurred &&\n      !this.state.isEditorFocused &&\n      !this.state.blockMenuOpen &&\n      !this.state.linkMenuOpen &&\n      !this.state.selectionMenuOpen\n    ) {\n      this.isBlurred = true;\n      if (this.props.onBlur) {\n        this.props.onBlur();\n      }\n    }\n\n    if (\n      this.isBlurred &&\n      (this.state.isEditorFocused ||\n        this.state.blockMenuOpen ||\n        this.state.linkMenuOpen ||\n        this.state.selectionMenuOpen)\n    ) {\n      this.isBlurred = false;\n      if (this.props.onFocus) {\n        this.props.onFocus();\n      }\n    }\n  }\n\n  init() {\n    this.extensions = this.createExtensions();\n    this.nodes = this.createNodes();\n    this.marks = this.createMarks();\n    this.schema = this.createSchema();\n    this.plugins = this.createPlugins();\n    this.keymaps = this.createKeymaps();\n    this.serializer = this.createSerializer();\n    this.parser = this.createParser();\n    this.inputRules = this.createInputRules();\n    this.nodeViews = this.createNodeViews();\n    this.view = this.createView();\n    this.commands = this.createCommands();\n  }\n\n  createExtensions() {\n    const dictionary = this.dictionary(this.props.dictionary);\n\n    // adding nodes here? Update schema.ts for serialization on the server\n    return new ExtensionManager(\n      [\n        new Doc(),\n        new Text(),\n        new HardBreak(),\n        new Paragraph(),\n        new Blockquote(),\n        new CodeBlock({\n          dictionary,\n          onShowToast: this.props.onShowToast,\n        }),\n        new CodeFence({\n          dictionary,\n          onShowToast: this.props.onShowToast,\n        }),\n        new CheckboxList(),\n        new CheckboxItem(),\n        new BulletList(),\n        new Embed(),\n        new ListItem(),\n        new Notice({\n          dictionary,\n        }),\n        new Heading({\n          dictionary,\n          onShowToast: this.props.onShowToast,\n          offset: this.props.headingsOffset,\n        }),\n        new HorizontalRule(),\n        new Image({\n          dictionary,\n          uploadImage: this.props.uploadImage,\n          onImageUploadStart: this.props.onImageUploadStart,\n          onImageUploadStop: this.props.onImageUploadStop,\n          onShowToast: this.props.onShowToast,\n        }),\n        new Table(),\n        new TableCell({\n          onSelectTable: this.handleSelectTable,\n          onSelectRow: this.handleSelectRow,\n        }),\n        new TableHeadCell({\n          onSelectColumn: this.handleSelectColumn,\n        }),\n        new TableRow(),\n        new Bold(),\n        new Code(),\n        new Highlight(),\n        new Italic(),\n        new TemplatePlaceholder(),\n        new Underline(),\n        new Link({\n          onKeyboardShortcut: this.handleOpenLinkMenu,\n          onClickLink: this.props.onClickLink,\n          onClickHashtag: this.props.onClickHashtag,\n          onHoverLink: this.props.onHoverLink,\n        }),\n        new Strikethrough(),\n        new OrderedList(),\n        new History(),\n        new SmartText(),\n        new TrailingNode(),\n        new MarkdownPaste(),\n        new Keys({\n          onBlur: this.handleEditorBlur,\n          onFocus: this.handleEditorFocus,\n          onSave: this.handleSave,\n          onSaveAndExit: this.handleSaveAndExit,\n          onCancel: this.props.onCancel,\n        }),\n        new BlockMenuTrigger({\n          dictionary,\n          onOpen: this.handleOpenBlockMenu,\n          onClose: this.handleCloseBlockMenu,\n        }),\n        new Placeholder({\n          placeholder: this.props.placeholder,\n        }),\n        new MaxLength({\n          maxLength: this.props.maxLength,\n        }),\n        ...this.props.extensions,\n      ],\n      this\n    );\n  }\n\n  createPlugins() {\n    return this.extensions.plugins;\n  }\n\n  createKeymaps() {\n    return this.extensions.keymaps({\n      schema: this.schema,\n    });\n  }\n\n  createInputRules() {\n    return this.extensions.inputRules({\n      schema: this.schema,\n    });\n  }\n\n  createNodeViews() {\n    return this.extensions.extensions\n      .filter((extension: ReactNode) => extension.component)\n      .reduce((nodeViews, extension: ReactNode) => {\n        const nodeView = (node, view, getPos, decorations) => {\n          return new ComponentView(extension.component, {\n            editor: this,\n            extension,\n            node,\n            view,\n            getPos,\n            decorations,\n          });\n        };\n\n        return {\n          ...nodeViews,\n          [extension.name]: nodeView,\n        };\n      }, {});\n  }\n\n  createCommands() {\n    return this.extensions.commands({\n      schema: this.schema,\n      view: this.view,\n    });\n  }\n\n  createNodes() {\n    return this.extensions.nodes;\n  }\n\n  createMarks() {\n    return this.extensions.marks;\n  }\n\n  createSchema() {\n    return new Schema({\n      nodes: this.nodes,\n      marks: this.marks,\n    });\n  }\n\n  createSerializer() {\n    return this.extensions.serializer();\n  }\n\n  createParser() {\n    return this.extensions.parser({\n      schema: this.schema,\n    });\n  }\n\n  createState(value?: string) {\n    const doc = this.createDocument(value || this.props.defaultValue);\n\n    return EditorState.create({\n      schema: this.schema,\n      doc,\n      plugins: [\n        ...this.plugins,\n        ...this.keymaps,\n        dropCursor({ color: this.theme().cursor }),\n        gapCursor(),\n        inputRules({\n          rules: this.inputRules,\n        }),\n        keymap(baseKeymap),\n      ],\n    });\n  }\n\n  createDocument(content: string) {\n    return this.parser.parse(content);\n  }\n\n  createView() {\n    if (!this.element) {\n      throw new Error(\"createView called before ref available\");\n    }\n\n    const isEditingCheckbox = (tr) => {\n      return tr.steps.some(\n        (step: Step) =>\n          step.slice?.content?.firstChild?.type.name ===\n          this.schema.nodes.checkbox_item.name\n      );\n    };\n\n    const view = new EditorView(this.element, {\n      state: this.createState(),\n      editable: () => !this.props.readOnly,\n      nodeViews: this.nodeViews,\n      handleDOMEvents: this.props.handleDOMEvents,\n      dispatchTransaction: (transaction) => {\n        const { state, transactions } = this.view.state.applyTransaction(\n          transaction\n        );\n\n        this.view.updateState(state);\n\n        // If any of the transactions being dispatched resulted in the doc\n        // changing then call our own change handler to let the outside world\n        // know\n        if (\n          transactions.some((tr) => tr.docChanged) &&\n          (!this.props.readOnly ||\n            (this.props.readOnlyWriteCheckboxes &&\n              transactions.some(isEditingCheckbox)))\n        ) {\n          this.handleChange();\n        }\n\n        // Because Prosemirror and React are not linked we must tell React that\n        // a render is needed whenever the Prosemirror state changes.\n        this.forceUpdate();\n      },\n    });\n\n    // Tell third-party libraries and screen-readers that this is an input\n    view.dom.setAttribute(\"role\", \"textbox\");\n\n    return view;\n  }\n\n  handleDragging(state: any) {\n    console.log(\"asdfasdfd\");\n  }\n\n  scrollToAnchor(hash: string) {\n    if (!hash) return;\n\n    try {\n      const element = document.querySelector(hash);\n      if (element) element.scrollIntoView({ behavior: \"smooth\" });\n    } catch (err) {\n      // querySelector will throw an error if the hash begins with a number\n      // or contains a period. This is protected against now by safeSlugify\n      // however previous links may be in the wild.\n      console.warn(`Attempted to scroll to invalid hash: ${hash}`, err);\n    }\n  }\n\n  value = (): string => {\n    return this.serializer.serialize(this.view.state.doc);\n  };\n\n  handleChange = () => {\n    if (!this.props.onChange) return;\n\n    this.props.onChange(() => {\n      return this.value();\n    });\n  };\n\n  handleSave = () => {\n    const { onSave } = this.props;\n    if (onSave) {\n      onSave({ done: false });\n    }\n  };\n\n  handleSaveAndExit = () => {\n    const { onSave } = this.props;\n    if (onSave) {\n      onSave({ done: true });\n    }\n  };\n\n  handleEditorBlur = () => {\n    this.setState({ isEditorFocused: false });\n  };\n\n  handleDragEnd = () => {\n    console.log(\"zzzzzzzzz\");\n  };\n\n  handleEditorFocus = () => {\n    this.setState({ isEditorFocused: true });\n  };\n\n  handleOpenSelectionMenu = () => {\n    this.setState({ blockMenuOpen: false, selectionMenuOpen: true });\n  };\n\n  handleCloseSelectionMenu = () => {\n    this.setState({ selectionMenuOpen: false });\n  };\n\n  handleOpenLinkMenu = () => {\n    this.setState({ blockMenuOpen: false, linkMenuOpen: true });\n  };\n\n  handleCloseLinkMenu = () => {\n    this.setState({ linkMenuOpen: false });\n  };\n\n  handleOpenBlockMenu = (search: string) => {\n    this.setState({ blockMenuOpen: true, blockMenuSearch: search });\n  };\n\n  handleCloseBlockMenu = () => {\n    if (!this.state.blockMenuOpen) return;\n    this.setState({ blockMenuOpen: false });\n  };\n\n  handleSelectRow = (index: number, state: EditorState) => {\n    this.view.dispatch(selectRow(index)(state.tr));\n  };\n\n  handleSelectColumn = (index: number, state: EditorState) => {\n    this.view.dispatch(selectColumn(index)(state.tr));\n  };\n\n  handleSelectTable = (state: EditorState) => {\n    this.view.dispatch(selectTable(state.tr));\n  };\n\n  // 'public' methods\n  focusAtStart = () => {\n    const selection = Selection.atStart(this.view.state.doc);\n    const transaction = this.view.state.tr.setSelection(selection);\n    this.view.dispatch(transaction);\n    this.view.focus();\n  };\n\n  focusAtEnd = () => {\n    const selection = Selection.atEnd(this.view.state.doc);\n    const transaction = this.view.state.tr.setSelection(selection);\n    this.view.dispatch(transaction);\n    this.view.focus();\n  };\n\n  getHeadings = () => {\n    const headings: { title: string; level: number; id: string }[] = [];\n    const previouslySeen = {};\n\n    this.view.state.doc.forEach((node) => {\n      if (node.type.name === \"heading\") {\n        // calculate the optimal slug\n        const slug = headingToSlug(node);\n        let id = slug;\n\n        // check if we've already used it, and if so how many times?\n        // Make the new id based on that number ensuring that we have\n        // unique ID's even when headings are identical\n        if (previouslySeen[slug] > 0) {\n          id = headingToSlug(node, previouslySeen[slug]);\n        }\n\n        // record that we've seen this slug for the next loop\n        previouslySeen[slug] =\n          previouslySeen[slug] !== undefined ? previouslySeen[slug] + 1 : 1;\n\n        headings.push({\n          title: node.textContent,\n          level: node.attrs.level,\n          id,\n        });\n      }\n    });\n    return headings;\n  };\n\n  theme = () => {\n    return this.props.theme || (this.props.dark ? darkTheme : lightTheme);\n  };\n\n  dictionary = memoize(\n    (providedDictionary?: Partial<typeof baseDictionary>) => {\n      return { ...baseDictionary, ...providedDictionary };\n    }\n  );\n\n  render = () => {\n    const {\n      readOnly,\n      readOnlyWriteCheckboxes,\n      style,\n      tooltip,\n      className,\n      onKeyDown,\n    } = this.props;\n    const dictionary = this.dictionary(this.props.dictionary);\n\n    return (\n      <Flex\n        onKeyDown={onKeyDown}\n        style={style}\n        className={className}\n        align=\"flex-start\"\n        justify=\"center\"\n        column\n      >\n        <ThemeProvider theme={this.theme()}>\n          <React.Fragment>\n            <StyledEditor\n              readOnly={readOnly}\n              readOnlyWriteCheckboxes={readOnlyWriteCheckboxes}\n              ref={(ref) => (this.element = ref)}\n            />\n            {!readOnly && this.view && (\n              <React.Fragment>\n                {/* <SelectionToolbar\n                  view={this.view}\n                  dictionary={dictionary}\n                  commands={this.commands}\n                  isTemplate={this.props.template === true}\n                  onOpen={this.handleOpenSelectionMenu}\n                  onClose={this.handleCloseSelectionMenu}\n                  onSearchLink={this.props.onSearchLink}\n                  onClickLink={this.props.onClickLink}\n                  onCreateLink={this.props.onCreateLink}\n                  tooltip={tooltip}\n                /> */}\n                <LinkToolbar\n                  view={this.view}\n                  dictionary={dictionary}\n                  isActive={this.state.linkMenuOpen}\n                  onCreateLink={this.props.onCreateLink}\n                  onSearchLink={this.props.onSearchLink}\n                  onClickLink={this.props.onClickLink}\n                  onShowToast={this.props.onShowToast}\n                  onClose={this.handleCloseLinkMenu}\n                  tooltip={tooltip}\n                />\n                <BlockMenu\n                  view={this.view}\n                  commands={this.commands}\n                  dictionary={dictionary}\n                  isActive={this.state.blockMenuOpen}\n                  search={this.state.blockMenuSearch}\n                  onClose={this.handleCloseBlockMenu}\n                  uploadImage={this.props.uploadImage}\n                  onLinkToolbarOpen={this.handleOpenLinkMenu}\n                  onImageUploadStart={this.props.onImageUploadStart}\n                  onImageUploadStop={this.props.onImageUploadStop}\n                  onShowToast={this.props.onShowToast}\n                  embeds={this.props.embeds}\n                />\n              </React.Fragment>\n            )}\n          </React.Fragment>\n        </ThemeProvider>\n      </Flex>\n    );\n  };\n}\n\nconst StyledEditor = styled(\"div\")<{\n  readOnly?: boolean;\n  readOnlyWriteCheckboxes?: boolean;\n}>`\n  color: ${(props) => props.theme.text};\n  background: ${(props) => props.theme.background};\n  font-family: ${(props) => props.theme.fontFamily};\n  font-weight: ${(props) => props.theme.fontWeight};\n  font-size: 1em;\n  line-height: 1.7em;\n  width: 100%;\n\n  .ProseMirror {\n    width: 500px;\n    position: relative;\n    outline: none;\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    white-space: break-spaces;\n    -webkit-font-variant-ligatures: none;\n    font-variant-ligatures: none;\n\n    font-feature-settings: \"liga\" 0; /* the above doesn't seem to work in Edge */\n  }\n\n  .move-div{\n    position: absolute;\n    top: 0px;\n    left: -29px\n  }\n\n  pre {\n    white-space: pre-wrap;\n  }\n\n  li {\n    position: relative;\n  }\n\n  .image {\n    text-align: center;\n    max-width: 100%;\n    clear: both;\n\n    img {\n      pointer-events: ${(props) => (props.readOnly ? \"initial\" : \"none\")};\n      display: inline-block;\n      max-width: 100%;\n      max-height: 75vh;\n    }\n  }\n\n  .image.placeholder {\n    position: relative;\n    background: ${(props) => props.theme.background};\n    img {\n      opacity: 0.5;\n    }\n  }\n\n  .image-right-50 {\n    float: right;\n    width: 50%;\n    margin-left: 2em;\n    margin-bottom: 1em;\n    clear: initial;\n  }\n\n  .image-left-50 {\n    float: left;\n    width: 50%;\n    margin-right: 2em;\n    margin-bottom: 1em;\n    clear: initial;\n  }\n\n  .ProseMirror-hideselection *::selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection *::-moz-selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection {\n    caret-color: transparent;\n  }\n\n  .ProseMirror-selectednode {\n    outline: 0px solid\n      ${(props) => (props.readOnly ? \"transparent\" : props.theme.selected)};\n  }\n\n  /* Make sure li selections wrap around markers */\n\n  li.ProseMirror-selectednode {\n    outline: none;\n  }\n\n  li.ProseMirror-selectednode:after {\n    content: \"\";\n    position: absolute;\n    left: -32px;\n    right: -2px;\n    top: -2px;\n    bottom: -2px;\n    border: 2px solid ${(props) => props.theme.selected};\n    pointer-events: none;\n  }\n\n  .ProseMirror[contenteditable=\"false\"] {\n    .caption {\n      pointer-events: none;\n    }\n    .caption:empty {\n      visibility: hidden;\n    }\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    margin: 1em 0 0.5em;\n    font-weight: 500;\n    cursor: default;\n    position: relative;\n\n    &:not(.placeholder):before {\n      display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n      font-family: ${(props) => props.theme.fontFamilyMono};\n      color: ${(props) => props.theme.textSecondary};\n      font-size: 13px;\n      line-height: 0;\n      margin-left: -24px;\n      width: 24px;\n    }\n\n    &:hover {\n      .heading-anchor {\n        opacity: 1;\n      }\n    }\n  }\n  .heading-content {\n    &:before {\n      content: \"​\";\n      display: inline;\n    }\n  }\n\n  .move-icon {\n    background: blue;\n    width: 10px;\n  }\n  .heading-name {\n    color: ${(props) => props.theme.text};\n\n    &:hover {\n      text-decoration: none;\n    }\n  }\n\n  a:first-child {\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-top: 0;\n    }\n  }\n\n  h4{\n    font-weight:400;\n    margin: 0;\n  }\n\n  h1:not(.placeholder)::before,\n  h2:not(.placeholder)::before,\n  h3:not(.placeholder)::before,\n  h4:not(.placeholder)::before,\n  hr::before,\n  p:not(.placeholder)::before {\n    content: \"\";\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n    cursor: move;\n    width: 24px;\n    height: 24px;\n    left: -8px;\n    position: absolute;\n    top: 4px;\n    opacity: 0;\n    transition: opacity 200ms ease-in-out;\n    background: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iOCIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iOCIgeT0iMTEiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+CjxyZWN0IHg9IjgiIHk9IjE1IiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iMTMiIHk9IjExIiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iMTUiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+Cjwvc3ZnPgo=\");\n  }\n\n  h1:not(.placeholder):hover::before,\n  h2:not(.placeholder):hover::before,\n  h3:not(.placeholder):hover::before,\n  h4:not(.placeholder):hover::before,\n  hr:hover::before {\n    opacity: 1;\n  }\n\n  pre::before,\n  blockquote::before {\n    content: \"\";\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n    cursor: move;\n    width: 24px;\n    height: 24px;\n    left: -8px;\n    position: absolute;\n    top: 5px;\n    opacity: 0;\n    transition: opacity 200ms ease-in-out;\n    background: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iOCIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iOCIgeT0iMTEiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+CjxyZWN0IHg9IjgiIHk9IjE1IiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iMTMiIHk9IjExIiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iMTUiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+Cjwvc3ZnPgo=\");\n  }\n\n  pre:hover::before,\n  blockquote:hover::before {\n    opacity: 1;\n  }\n\n  table::before,\n  .notice-block::before{\n    content: \"\";\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n    cursor: move;\n    width: 24px;\n    height: 24px;\n    left: -23px;\n    position: absolute;\n    top: 0px;\n    opacity: 0;\n    transition: opacity 200ms ease-in-out;\n    background: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iOCIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iOCIgeT0iMTEiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+CjxyZWN0IHg9IjgiIHk9IjE1IiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iMTMiIHk9IjExIiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iMTUiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+Cjwvc3ZnPgo=\");\n  }\n\n  table:hover::before,\n  p:not(.placeholder):hover::before,\n  .notice-block:hover::before {\n    opacity: 1;\n  }\n\n  .with-emoji {\n    margin-left: -1em;\n  }\n\n  .heading-anchor {\n    opacity: 0;\n    display: ${(props) => (props.readOnly ? \"inline-block\" : \"none\")};\n    color: ${(props) => props.theme.textSecondary};\n    cursor: pointer;\n    background: none;\n    border: 0;\n    outline: none;\n    padding: 2px 12px 2px 4px;\n    margin: 0;\n    transition: opacity 100ms ease-in-out;\n    font-family: ${(props) => props.theme.fontFamilyMono};\n    font-size: 22px;\n    line-height: 0;\n    margin-left: -24px;\n    width: 24px;\n\n    &:focus,\n    &:hover {\n      color: ${(props) => props.theme.text};\n    }\n  }\n\n  .placeholder {\n    &:before {\n      display: block;\n      content: ${(props) => (props.readOnly ? \"\" : \"attr(data-empty-text)\")};\n      pointer-events: none;\n      height: 0;\n      color: ${(props) => props.theme.placeholder};\n    }\n  }\n\n  @media print {\n    .placeholder {\n      display: none;\n    }\n  }\n\n  .notice-block {\n    display: flex;\n    align-items: center;\n    background: ${(props) => props.theme.noticeInfoBackground};\n    color: ${(props) => props.theme.noticeInfoText};\n    border-radius: 4px;\n    padding: 8px 16px;\n    margin: 8px 0;\n\n    a {\n      color: ${(props) => props.theme.noticeInfoText};\n    }\n\n    a:not(.heading-name) {\n      text-decoration: underline;\n    }\n  }\n\n  .notice-block .content {\n    flex-grow: 1;\n  }\n\n  .notice-block .icon {\n    width: 24px;\n    height: 24px;\n    align-self: flex-start;\n    margin-right: 4px;\n    position: relative;\n    top: 1px;\n  }\n\n  .notice-block.tip {\n    background: ${(props) => props.theme.noticeTipBackground};\n    color: ${(props) => props.theme.noticeTipText};\n\n    a {\n      color: ${(props) => props.theme.noticeTipText};\n    }\n  }\n\n  .notice-block.warning {\n    background: ${(props) => props.theme.noticeWarningBackground};\n    color: ${(props) => props.theme.noticeWarningText};\n\n    a {\n      color: ${(props) => props.theme.noticeWarningText};\n    }\n  }\n\n  blockquote {\n    margin: 0;\n    padding-left: 1em;\n    font-style: italic;\n    overflow: hidden;\n    position: relative;\n  }\n\n  .blockquote-icon {\n    background: blue;\n    width: 10px;\n    &:before {\n      content: \"\";\n      display: inline-block;\n      width: 3px;\n      border-radius: 1px;\n      position: absolute;\n      margin-left: -5px;\n      top: 0;\n      bottom: 0;\n      background: ${(props) => props.theme.quote};\n    }\n  }\n\n  b,\n  strong {\n    font-weight: 600;\n  }\n\n  .template-placeholder {\n    color: ${(props) => props.theme.placeholder};\n    border-bottom: 1px dotted ${(props) => props.theme.placeholder};\n    border-radius: 2px;\n    cursor: text;\n\n    &:hover {\n      border-bottom: 1px dotted\n        ${(props) =>\n          props.readOnly ? props.theme.placeholder : props.theme.textSecondary};\n    }\n  }\n\n  p {\n    margin: 0;\n  }\n\n  a {\n    color: ${(props) => props.theme.link};\n  }\n\n  a:hover {\n    text-decoration: ${(props) => (props.readOnly ? \"underline\" : \"none\")};\n  }\n\n  ul,\n  ol {\n    margin: 0 0.1em 0 -26px;\n    padding: 0 0 0 44px;\n\n    ul,\n    ol {\n      margin-right: -24px;\n    }\n  }\n\n  ol ol {\n    list-style: lower-alpha;\n  }\n\n  ol ol ol {\n    list-style: lower-roman;\n  }\n\n  ul.checkbox_list {\n    list-style: none;\n    padding: 0;\n    margin: 0 0 0 -24px;\n  }\n\n  ul li,\n  ol li {\n    position: relative;\n    white-space: initial;\n\n    p {\n      white-space: pre-wrap;\n    }\n\n    > div {\n      width: 100%;\n    }\n  }\n\n  ul.checkbox_list li {\n    display: flex;\n    padding-left: 24px;\n  }\n\n  ul.checkbox_list li.checked > div > p {\n    color: ${(props) => props.theme.textSecondary};\n    text-decoration: line-through;\n  }\n\n  ul li::before,\n  ol li::before {\n    background: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iOCIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iOCIgeT0iMTEiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+CjxyZWN0IHg9IjgiIHk9IjE1IiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iMTMiIHk9IjExIiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iMTUiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+Cjwvc3ZnPgo=\");\n    content: \"\";\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n    cursor: move;\n    width: 24px;\n    height: 24px;\n    position: absolute;\n    left: -40px;\n    top: 2px;\n    opacity: 0;\n    transition: opacity 200ms ease-in-out;\n  }\n\n  ul > li.hovering::before,\n  ol li.hovering::before {\n    opacity: 0.5;\n  }\n\n  ul li.ProseMirror-selectednode::after,\n  ol li.ProseMirror-selectednode::after {\n    display: none;\n  }\n\n  ul.checkbox_list li::before {\n    left: 0;\n  }\n\n  ul.checkbox_list li input {\n    pointer-events: ${(props) =>\n      props.readOnly && !props.readOnlyWriteCheckboxes ? \"none\" : \"initial\"};\n    opacity: ${(props) =>\n      props.readOnly && !props.readOnlyWriteCheckboxes ? 0.75 : 1};\n    margin: 0.5em 0.5em 0 0;\n    width: 14px;\n    height: 14px;\n  }\n\n  li p:first-child {\n    margin: 0;\n    word-break: break-word;\n  }\n\n  hr {\n    height: 0;\n    border: 0;\n    border-top: 1px solid ${(props) => props.theme.horizontalRule};\n  }\n\n  code {\n    border-radius: 4px;\n    border: 1px solid ${(props) => props.theme.codeBorder};\n    padding: 3px 4px;\n    font-family: ${(props) => props.theme.fontFamilyMono};\n    font-size: 85%;\n  }\n\n  mark {\n    border-radius: 1px;\n    color: ${(props) => props.theme.textHighlightForeground};\n    background: ${(props) => props.theme.textHighlight};\n\n    a {\n      color: ${(props) => props.theme.textHighlightForeground};\n    }\n  }\n\n  .code-block,\n  .notice-block {\n    position: relative;\n\n    select,\n    button {\n      background: ${(props) => props.theme.blockToolbarBackground};\n      color: ${(props) => props.theme.blockToolbarItem};\n      border-width: 1px;\n      font-size: 13px;\n      display: none;\n      position: absolute;\n      border-radius: 4px;\n      padding: 2px;\n      z-index: 1;\n      top: 4px;\n      right: 4px;\n    }\n\n    button {\n      padding: 2px 4px;\n    }\n\n    &:hover {\n      select {\n        display: ${(props) => (props.readOnly ? \"none\" : \"inline\")};\n      }\n\n      button {\n        display: ${(props) => (props.readOnly ? \"inline\" : \"none\")};\n      }\n    }\n\n    select:focus,\n    select:active {\n      display: inline;\n    }\n  }\n\n  pre {\n    display: block;\n    overflow-x: auto;\n    padding: 0.75em 1em;\n    line-height: 1.4em;\n    position: relative;\n    background: ${(props) => props.theme.codeBackground};\n    border-radius: 4px;\n    border: 1px solid ${(props) => props.theme.codeBorder};\n\n    -webkit-font-smoothing: initial;\n    font-family: ${(props) => props.theme.fontFamilyMono};\n    font-size: 13px;\n    direction: ltr;\n    text-align: left;\n    white-space: pre;\n    word-spacing: normal;\n    word-break: normal;\n    -moz-tab-size: 4;\n    -o-tab-size: 4;\n    tab-size: 4;\n    -webkit-hyphens: none;\n    -moz-hyphens: none;\n    -ms-hyphens: none;\n    hyphens: none;\n    color: ${(props) => props.theme.code};\n    margin: 0;\n\n    code {\n      font-size: 13px;\n      background: none;\n      padding: 0;\n      border: 0;\n    }\n  }\n\n  .token.comment,\n  .token.prolog,\n  .token.doctype,\n  .token.cdata {\n    color: ${(props) => props.theme.codeComment};\n  }\n\n  .token.punctuation {\n    color: ${(props) => props.theme.codePunctuation};\n  }\n\n  .token.namespace {\n    opacity: 0.7;\n  }\n\n  .token.operator,\n  .token.boolean,\n  .token.number {\n    color: ${(props) => props.theme.codeNumber};\n  }\n\n  .token.property {\n    color: ${(props) => props.theme.codeProperty};\n  }\n\n  .token.tag {\n    color: ${(props) => props.theme.codeTag};\n  }\n\n  .token.string {\n    color: ${(props) => props.theme.codeString};\n  }\n\n  .token.selector {\n    color: ${(props) => props.theme.codeSelector};\n  }\n\n  .token.attr-name {\n    color: ${(props) => props.theme.codeAttr};\n  }\n\n  .token.entity,\n  .token.url,\n  .language-css .token.string,\n  .style .token.string {\n    color: ${(props) => props.theme.codeEntity};\n  }\n\n  .token.attr-value,\n  .token.keyword,\n  .token.control,\n  .token.directive,\n  .token.unit {\n    color: ${(props) => props.theme.codeKeyword};\n  }\n\n  .token.function {\n    color: ${(props) => props.theme.codeFunction};\n  }\n\n  .token.statement,\n  .token.regex,\n  .token.atrule {\n    color: ${(props) => props.theme.codeStatement};\n  }\n\n  .token.placeholder,\n  .token.variable {\n    color: ${(props) => props.theme.codePlaceholder};\n  }\n\n  .token.deleted {\n    text-decoration: line-through;\n  }\n\n  .token.inserted {\n    border-bottom: 1px dotted ${(props) => props.theme.codeInserted};\n    text-decoration: none;\n  }\n\n  .token.italic {\n    font-style: italic;\n  }\n\n  .token.important,\n  .token.bold {\n    font-weight: bold;\n  }\n\n  .token.important {\n    color: ${(props) => props.theme.codeImportant};\n  }\n\n  .token.entity {\n    cursor: help;\n  }\n\n  table {\n    width: 100%;\n    border-collapse: collapse;\n    border-radius: 4px;\n    margin-top: 1em;\n    box-sizing: border-box;\n    position: relative;\n\n    * {\n      box-sizing: border-box;\n    }\n\n    tr {\n      position: relative;\n      border-bottom: 1px solid ${(props) => props.theme.tableDivider};\n    }\n\n    th {\n      background: ${(props) => props.theme.tableHeaderBackground};\n    }\n\n    td,\n    th {\n      position: relative;\n      vertical-align: top;\n      border: 1px solid ${(props) => props.theme.tableDivider};\n      position: relative;\n      padding: 4px 8px;\n      text-align: left;\n      min-width: 100px;\n    }\n\n    .selectedCell {\n      background: ${(props) =>\n        props.readOnly ? \"inherit\" : props.theme.tableSelectedBackground};\n\n      /* fixes Firefox background color painting over border:\n       * https://bugzilla.mozilla.org/show_bug.cgi?id=688556 */\n      background-clip: padding-box;\n    }\n\n    .grip-column {\n      /* usage of ::after for all of the table grips works around a bug in\n       * prosemirror-tables that causes Safari to hang when selecting a cell\n       * in an empty table:\n       * https://github.com/ProseMirror/prosemirror/issues/947 */\n      // &::after {\n      //   content: \"\";\n      //   cursor: pointer;\n      //   position: absolute;\n      //   top: -16px;\n      //   left: 0;\n      //   width: 100%;\n      //   height: 12px;\n      //   background: ${(props) => props.theme.tableDivider};\n      //   border-bottom: 3px solid ${(props) => props.theme.background};\n      //   display: ${(props) => (props.readOnly ? \"none\" : \"block\")};\n      // }\n\n      // &:hover::after {\n      //   background: ${(props) => props.theme.text};\n      // }\n      // &.first::after {\n      //   border-top-left-radius: 3px;\n      // }\n      // &.last::after {\n      //   border-top-right-radius: 3px;\n      // }\n      // &.selected::after {\n      //   background: ${(props) => props.theme.tableSelected};\n      // }\n    }\n\n    .grip-row {\n      &::after {\n        // content: \"\";\n        // cursor: pointer;\n        // position: absolute;\n        // left: -16px;\n        // top: 0;\n        // height: 100%;\n        // width: 12px;\n        // background: ${(props) => props.theme.tableDivider};\n        // border-right: 3px solid ${(props) => props.theme.background};\n        // display: ${(props) => (props.readOnly ? \"none\" : \"block\")};\n      }\n\n      &:hover::after {\n        background: ${(props) => props.theme.text};\n      }\n      &.first::after {\n        border-top-left-radius: 3px;\n      }\n      &.last::after {\n        border-bottom-left-radius: 3px;\n      }\n      &.selected::after {\n        background: ${(props) => props.theme.tableSelected};\n      }\n    }\n\n    .grip-table {\n      // &::after {\n      //   content: \"\";\n      //   cursor: pointer;\n      //   background: ${(props) => props.theme.tableDivider};\n      //   width: 13px;\n      //   height: 13px;\n      //   border-radius: 13px;\n      //   border: 2px solid ${(props) => props.theme.background};\n      //   position: absolute;\n      //   top: -18px;\n      //   left: -18px;\n      //   display: ${(props) => (props.readOnly ? \"none\" : \"block\")};\n      // }\n\n      // &:hover::after {\n      //   background: ${(props) => props.theme.text};\n      // }\n      // &.selected::after {\n      //   background: ${(props) => props.theme.tableSelected};\n      // }\n    }\n  }\n\n  .scrollable-wrapper {\n    position: relative;\n    margin: 0.5em 0px;\n    scrollbar-width: thin;\n    scrollbar-color: transparent transparent;\n\n    &:hover {\n      scrollbar-color: ${(props) => props.theme.scrollbarThumb}\n        ${(props) => props.theme.scrollbarBackground};\n    }\n\n    & ::-webkit-scrollbar {\n      height: 14px;\n      background-color: transparent;\n    }\n\n    &:hover ::-webkit-scrollbar {\n      background-color: ${(props) => props.theme.scrollbarBackground};\n    }\n\n    & ::-webkit-scrollbar-thumb {\n      background-color: transparent;\n      border: 3px solid transparent;\n      border-radius: 7px;\n    }\n\n    &:hover ::-webkit-scrollbar-thumb {\n      background-color: ${(props) => props.theme.scrollbarThumb};\n      border-color: ${(props) => props.theme.scrollbarBackground};\n    }\n  }\n\n  .scrollable {\n    overflow-y: hidden;\n    overflow-x: auto;\n    padding-left: 1em;\n    margin-left: -1em;\n    border-left: 1px solid transparent;\n    border-right: 1px solid transparent;\n    transition: border 250ms ease-in-out 0s;\n  }\n\n  .scrollable-shadow {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: -1em;\n    width: 16px;\n    transition: box-shadow 250ms ease-in-out;\n    border: 0px solid transparent;\n    border-left-width: 1em;\n    pointer-events: none;\n\n    &.left {\n      box-shadow: 16px 0 16px -16px inset rgba(0, 0, 0, 0.25);\n      border-left: 1em solid ${(props) => props.theme.background};\n    }\n\n    &.right {\n      right: 0;\n      left: auto;\n      box-shadow: -16px 0 16px -16px inset rgba(0, 0, 0, 0.25);\n    }\n  }\n\n  .block-menu-trigger {\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline\")};\n    width: 24px;\n    height: 24px;\n    color: ${(props) => props.theme.textSecondary};\n    background: none;\n    position: absolute;\n    transition: color 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275),\n      transform 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    outline: none;\n    border: 0;\n    padding: 0;\n    margin-top: 1px;\n    margin-left: -24px;\n\n    &:hover,\n    &:focus {\n      cursor: pointer;\n      transform: scale(1.2);\n      color: ${(props) => props.theme.text};\n    }\n  }\n\n  @media print {\n    .block-menu-trigger {\n      display: none;\n    }\n  }\n\n  .ProseMirror-gapcursor {\n    display: none;\n    pointer-events: none;\n    position: absolute;\n  }\n\n  .ProseMirror-gapcursor:after {\n    content: \"\";\n    display: block;\n    position: absolute;\n    top: -2px;\n    width: 20px;\n    border-top: 1px solid ${(props) => props.theme.cursor};\n    animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n  }\n\n  @keyframes ProseMirror-cursor-blink {\n    to {\n      visibility: hidden;\n    }\n  }\n\n  .ProseMirror-focused .ProseMirror-gapcursor {\n    display: block;\n  }\n\n  @media print {\n    em,\n    blockquote {\n      font-family: \"SF Pro Text\", ${(props) => props.theme.fontFamily};\n    }\n  }\n`;\n\nexport default RichMarkdownEditor;\n","import * as React from \"react\";\n\ntype Props = {\n  tooltip: string;\n  children: React.ReactNode;\n};\n\nexport default function Tooltip({ tooltip, children }: Props) {\n  return <span title={tooltip}>{children}</span>;\n}\n","import React from \"react\";\nimport Editor from \"./apps\";\n\nconst EditorRender = () => {\n  const handleOnChange = () => {\n    console.log(\"hello\");\n  };\n\n  return (\n   <Editor  />\n  )\n}\n\nexport default EditorRender;","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport EditorRender from \"./main\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <div style={{\"maxWidth\":\"400px\" , margin:\"0 auto\", padding:\"40px\"}}>\n    <EditorRender/>\n   </div>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n"],"sourceRoot":""}